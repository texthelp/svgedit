const jquery = require('jquery'); const jQuery = jquery; const $ = jquery; (function() { var svgedit={NS:{HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}};svgedit.getReverseNS=function(){var g={};$.each(this.NS,function(s,q){g[q]=s.toLowerCase()});return g};(function(){var g=jQuery.fn.attr;jQuery.fn.attr=function(s,q){var j,c=this.length;if(!c)return g.apply(this,arguments);for(j=0;j<c;++j){var k=this[j];if(k.namespaceURI==="http://www.w3.org/2000/svg"){if(q!==undefined)k.setAttribute(s,q);else if($.isArray(s)){c=s.length;for(var i={};c--;){var w=s[c];if((j=k.getAttribute(w))||j==="0")j=isNaN(j)?j:j-0;i[w]=j}return i}if(typeof s==="object")for(i in s)k.setAttribute(i,s[i]);else{if((j=k.getAttribute(s))||j==="0")j=isNaN(j)?j:j-0;return j}}else return g.apply(this,
arguments)}return this}})();(function(){if(!window.SVGPathSeg){window.SVGPathSeg=function(g,s,q){this.pathSegType=g;this.pathSegTypeAsLetter=s;this._owningPathSegList=q};SVGPathSeg.PATHSEG_UNKNOWN=0;SVGPathSeg.PATHSEG_CLOSEPATH=1;SVGPathSeg.PATHSEG_MOVETO_ABS=2;SVGPathSeg.PATHSEG_MOVETO_REL=3;SVGPathSeg.PATHSEG_LINETO_ABS=4;SVGPathSeg.PATHSEG_LINETO_REL=5;SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6;SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9;SVGPathSeg.PATHSEG_ARC_ABS=
10;SVGPathSeg.PATHSEG_ARC_REL=11;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13;SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14;SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19;SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)};
window.SVGPathSegClosePath=function(g){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CLOSEPATH,"z",g)};SVGPathSegClosePath.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"};SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter};SVGPathSegClosePath.prototype.clone=function(){return new SVGPathSegClosePath(undefined)};window.SVGPathSegMovetoAbs=function(g,s,q){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_ABS,
"M",g);this._x=s;this._y=q};SVGPathSegMovetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"};SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoAbs.prototype.clone=function(){return new SVGPathSegMovetoAbs(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoAbs.prototype,"x",{get:function(){return this._x},set:function(g){this._x=
g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegMovetoAbs.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});window.SVGPathSegMovetoRel=function(g,s,q){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_REL,"m",g);this._x=s;this._y=q};SVGPathSegMovetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"};SVGPathSegMovetoRel.prototype._asPathString=
function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoRel.prototype.clone=function(){return new SVGPathSegMovetoRel(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoRel.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegMovetoRel.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoAbs=
function(g,s,q){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_ABS,"L",g);this._x=s;this._y=q};SVGPathSegLinetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"};SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoAbs.prototype.clone=function(){return new SVGPathSegLinetoAbs(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoAbs.prototype,
"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegLinetoAbs.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoRel=function(g,s,q){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_REL,"l",g);this._x=s;this._y=q};SVGPathSegLinetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"};
SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoRel.prototype.clone=function(){return new SVGPathSegLinetoRel(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoRel.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegLinetoRel.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},
enumerable:true});window.SVGPathSegCurvetoCubicAbs=function(g,s,q,j,c,k,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",g);this._x=s;this._y=q;this._x1=j;this._y1=c;this._x2=k;this._y2=i};SVGPathSegCurvetoCubicAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"};SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+
" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicAbs(undefined,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});
Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function(){return this._x1},set:function(g){this._x1=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function(){return this._y1},set:function(g){this._y1=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function(){return this._x2},set:function(g){this._x2=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,
"y2",{get:function(){return this._y2},set:function(g){this._y2=g;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoCubicRel=function(g,s,q,j,c,k,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",g);this._x=s;this._y=q;this._x1=j;this._y1=c;this._x2=k;this._y2=i};SVGPathSegCurvetoCubicRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"};SVGPathSegCurvetoCubicRel.prototype._asPathString=
function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicRel(undefined,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y",{get:function(){return this._y},
set:function(g){this._y=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function(){return this._x1},set:function(g){this._x1=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function(){return this._y1},set:function(g){this._y1=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function(){return this._x2},set:function(g){this._x2=
g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function(){return this._y2},set:function(g){this._y2=g;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoQuadraticAbs=function(g,s,q,j,c){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",g);this._x=s;this._y=q;this._x1=j;this._y1=c};SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticAbs.prototype.toString=
function(){return"[object SVGPathSegCurvetoQuadraticAbs]"};SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticAbs(undefined,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});
Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function(){return this._x1},set:function(g){this._x1=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function(){return this._y1},set:function(g){this._y1=g;this._segmentChanged()},enumerable:true});
window.SVGPathSegCurvetoQuadraticRel=function(g,s,q,j,c){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",g);this._x=s;this._y=q;this._x1=j;this._y1=c};SVGPathSegCurvetoQuadraticRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"};SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};
SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticRel(undefined,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,
"x1",{get:function(){return this._x1},set:function(g){this._x1=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function(){return this._y1},set:function(g){this._y1=g;this._segmentChanged()},enumerable:true});window.SVGPathSegArcAbs=function(g,s,q,j,c,k,i,w){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_ABS,"A",g);this._x=s;this._y=q;this._r1=j;this._r2=c;this._angle=k;this._largeArcFlag=i;this._sweepFlag=w};SVGPathSegArcAbs.prototype=
Object.create(SVGPathSeg.prototype);SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"};SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcAbs.prototype.clone=function(){return new SVGPathSegArcAbs(undefined,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcAbs.prototype,
"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"r1",{get:function(){return this._r1},set:function(g){this._r1=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"r2",{get:function(){return this._r2},set:function(g){this._r2=
g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"angle",{get:function(){return this._angle},set:function(g){this._angle=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(g){this._largeArcFlag=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(g){this._sweepFlag=
g;this._segmentChanged()},enumerable:true});window.SVGPathSegArcRel=function(g,s,q,j,c,k,i,w){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_REL,"a",g);this._x=s;this._y=q;this._r1=j;this._r2=c;this._angle=k;this._largeArcFlag=i;this._sweepFlag=w};SVGPathSegArcRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"};SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+
this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcRel.prototype.clone=function(){return new SVGPathSegArcRel(undefined,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcRel.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"y",{get:function(){return this._y},
set:function(g){this._y=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"r1",{get:function(){return this._r1},set:function(g){this._r1=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"r2",{get:function(){return this._r2},set:function(g){this._r2=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"angle",{get:function(){return this._angle},set:function(g){this._angle=
g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(g){this._largeArcFlag=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(g){this._sweepFlag=g;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoHorizontalAbs=function(g,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,
"H",g);this._x=s};SVGPathSegLinetoHorizontalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"};SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x};SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new SVGPathSegLinetoHorizontalAbs(undefined,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function(){return this._x},
set:function(g){this._x=g;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoHorizontalRel=function(g,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",g);this._x=s};SVGPathSegLinetoHorizontalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"};SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x};SVGPathSegLinetoHorizontalRel.prototype.clone=
function(){return new SVGPathSegLinetoHorizontalRel(undefined,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoVerticalAbs=function(g,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",g);this._y=s};SVGPathSegLinetoVerticalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"};
SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new SVGPathSegLinetoVerticalAbs(undefined,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoVerticalRel=function(g,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",g);
this._y=s};SVGPathSegLinetoVerticalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"};SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new SVGPathSegLinetoVerticalRel(undefined,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype,"y",{get:function(){return this._y},
set:function(g){this._y=g;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoCubicSmoothAbs=function(g,s,q,j,c){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",g);this._x=s;this._y=q;this._x2=j;this._y2=c};SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"};SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+
" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothAbs(undefined,this._x,this._y,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},
enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function(){return this._x2},set:function(g){this._x2=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function(){return this._y2},set:function(g){this._y2=g;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoCubicSmoothRel=function(g,s,q,j,c){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",g);this._x=s;
this._y=q;this._x2=j;this._y2=c};SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"};SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothRel(undefined,this._x,this._y,
this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function(){return this._x2},set:function(g){this._x2=g;this._segmentChanged()},
enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function(){return this._y2},set:function(g){this._y2=g;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoQuadraticSmoothAbs=function(g,s,q){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",g);this._x=s;this._y=q};SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"};
SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,
"y",{get:function(){return this._y},set:function(g){this._y=g;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoQuadraticSmoothRel=function(g,s,q){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",g);this._x=s;this._y=q};SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"};SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=
function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothRel(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function(){return this._x},set:function(g){this._x=g;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function(){return this._y},set:function(g){this._y=
g;this._segmentChanged()},enumerable:true});SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new SVGPathSegClosePath(undefined)};SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(g,s){return new SVGPathSegMovetoAbs(undefined,g,s)};SVGPathElement.prototype.createSVGPathSegMovetoRel=function(g,s){return new SVGPathSegMovetoRel(undefined,g,s)};SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(g,s){return new SVGPathSegLinetoAbs(undefined,g,s)};SVGPathElement.prototype.createSVGPathSegLinetoRel=
function(g,s){return new SVGPathSegLinetoRel(undefined,g,s)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(g,s,q,j,c,k){return new SVGPathSegCurvetoCubicAbs(undefined,g,s,q,j,c,k)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(g,s,q,j,c,k){return new SVGPathSegCurvetoCubicRel(undefined,g,s,q,j,c,k)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(g,s,q,j){return new SVGPathSegCurvetoQuadraticAbs(undefined,g,s,q,j)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=
function(g,s,q,j){return new SVGPathSegCurvetoQuadraticRel(undefined,g,s,q,j)};SVGPathElement.prototype.createSVGPathSegArcAbs=function(g,s,q,j,c,k,i){return new SVGPathSegArcAbs(undefined,g,s,q,j,c,k,i)};SVGPathElement.prototype.createSVGPathSegArcRel=function(g,s,q,j,c,k,i){return new SVGPathSegArcRel(undefined,g,s,q,j,c,k,i)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(g){return new SVGPathSegLinetoHorizontalAbs(undefined,g)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=
function(g){return new SVGPathSegLinetoHorizontalRel(undefined,g)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(g){return new SVGPathSegLinetoVerticalAbs(undefined,g)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(g){return new SVGPathSegLinetoVerticalRel(undefined,g)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(g,s,q,j){return new SVGPathSegCurvetoCubicSmoothAbs(undefined,g,s,q,j)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=
function(g,s,q,j){return new SVGPathSegCurvetoCubicSmoothRel(undefined,g,s,q,j)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(g,s){return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined,g,s)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(g,s){return new SVGPathSegCurvetoQuadraticSmoothRel(undefined,g,s)}}if(!window.SVGPathSegList){window.SVGPathSegList=function(g){this._pathElement=g;this._list=this._parsePath(this._pathElement.getAttribute("d"));
this._mutationObserverConfig={attributes:true,attributeFilter:["d"]};this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};Object.defineProperty(SVGPathSegList.prototype,"numberOfItems",{get:function(){this._checkPathSynchronizedToList();return this._list.length}});SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())};
SVGPathSegList.prototype._updateListFromPathMutations=function(g){if(this._pathElement){var s=false;g.forEach(function(q){if(q.attributeName=="d")s=true});if(s)this._list=this._parsePath(this._pathElement.getAttribute("d"))}};SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect();this._pathElement.setAttribute("d",SVGPathSegList._pathSegArrayAsString(this._list));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};
SVGPathSegList.prototype.segmentChanged=function(){this._writeListToPath()};SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList();this._list.forEach(function(g){g._owningPathSegList=null});this._list=[];this._writeListToPath()};SVGPathSegList.prototype.initialize=function(g){this._checkPathSynchronizedToList();this._list=[g];g._owningPathSegList=this;this._writeListToPath();return g};SVGPathSegList.prototype._checkValidIndex=function(g){if(isNaN(g)||g<0||g>=this.numberOfItems)throw"INDEX_SIZE_ERR";
};SVGPathSegList.prototype.getItem=function(g){this._checkPathSynchronizedToList();this._checkValidIndex(g);return this._list[g]};SVGPathSegList.prototype.insertItemBefore=function(g,s){this._checkPathSynchronizedToList();if(s>this.numberOfItems)s=this.numberOfItems;if(g._owningPathSegList)g=g.clone();this._list.splice(s,0,g);g._owningPathSegList=this;this._writeListToPath();return g};SVGPathSegList.prototype.replaceItem=function(g,s){this._checkPathSynchronizedToList();if(g._owningPathSegList)g=
g.clone();this._checkValidIndex(s);this._list[s]=g;g._owningPathSegList=this;this._writeListToPath();return g};SVGPathSegList.prototype.removeItem=function(g){this._checkPathSynchronizedToList();this._checkValidIndex(g);var s=this._list[g];this._list.splice(g,1);this._writeListToPath();return s};SVGPathSegList.prototype.appendItem=function(g){this._checkPathSynchronizedToList();if(g._owningPathSegList)g=g.clone();this._list.push(g);g._owningPathSegList=this;this._writeListToPath();return g};SVGPathSegList._pathSegArrayAsString=
function(g){var s="",q=true;g.forEach(function(j){if(q){q=false;s+=j._asPathString()}else s+=" "+j._asPathString()});return s};SVGPathSegList.prototype._parsePath=function(g){if(!g||g.length==0)return[];var s=this,q=function(){this.pathSegList=[]};q.prototype.appendSegment=function(c){this.pathSegList.push(c)};var j=function(c){this._string=c;this._currentIndex=0;this._endIndex=this._string.length;this._previousCommand=SVGPathSeg.PATHSEG_UNKNOWN;this._skipOptionalSpaces()};j.prototype._isCurrentSpace=
function(){var c=this._string[this._currentIndex];return c<=" "&&(c==" "||c=="\n"||c=="\t"||c=="\r"||c=="\u000c")};j.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex};j.prototype._skipOptionalSpacesOrDelimiter=function(){if(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&this._string.charAt(this._currentIndex)!=",")return false;if(this._skipOptionalSpaces())if(this._currentIndex<
this._endIndex&&this._string.charAt(this._currentIndex)==","){this._currentIndex++;this._skipOptionalSpaces()}return this._currentIndex<this._endIndex};j.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex};j.prototype.peekSegmentType=function(){return this._pathSegTypeFromChar(this._string[this._currentIndex])};j.prototype._pathSegTypeFromChar=function(c){switch(c){case "Z":case "z":return SVGPathSeg.PATHSEG_CLOSEPATH;case "M":return SVGPathSeg.PATHSEG_MOVETO_ABS;case "m":return SVGPathSeg.PATHSEG_MOVETO_REL;
case "L":return SVGPathSeg.PATHSEG_LINETO_ABS;case "l":return SVGPathSeg.PATHSEG_LINETO_REL;case "C":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case "c":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case "Q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case "q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case "A":return SVGPathSeg.PATHSEG_ARC_ABS;case "a":return SVGPathSeg.PATHSEG_ARC_REL;case "H":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case "h":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;
case "V":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case "v":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case "S":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case "s":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case "T":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case "t":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return SVGPathSeg.PATHSEG_UNKNOWN}};j.prototype._nextCommandHelper=function(c,k){if((c=="+"||c=="-"||c=="."||c>="0"&&c<="9")&&k!=SVGPathSeg.PATHSEG_CLOSEPATH){if(k==
SVGPathSeg.PATHSEG_MOVETO_ABS)return SVGPathSeg.PATHSEG_LINETO_ABS;if(k==SVGPathSeg.PATHSEG_MOVETO_REL)return SVGPathSeg.PATHSEG_LINETO_REL;return k}return SVGPathSeg.PATHSEG_UNKNOWN};j.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return true;var c=this.peekSegmentType();return c==SVGPathSeg.PATHSEG_MOVETO_ABS||c==SVGPathSeg.PATHSEG_MOVETO_REL};j.prototype._parseNumber=function(){var c=0,k=0,i=1,w=0,u=1,K=1,B=this._currentIndex;this._skipOptionalSpaces();if(this._currentIndex<
this._endIndex&&this._string.charAt(this._currentIndex)=="+")this._currentIndex++;else if(this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)=="-"){this._currentIndex++;u=-1}if(!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&this._string.charAt(this._currentIndex)!=".")){for(var d=this._currentIndex;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<=
"9";)this._currentIndex++;if(this._currentIndex!=d)for(var n=this._currentIndex-1,f=1;n>=d;){k+=f*(this._string.charAt(n--)-"0");f*=10}if(this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)=="."){this._currentIndex++;if(this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<=
"9";)w+=(this._string.charAt(this._currentIndex++)-"0")*(i*=0.1)}if(this._currentIndex!=B&&this._currentIndex+1<this._endIndex&&(this._string.charAt(this._currentIndex)=="e"||this._string.charAt(this._currentIndex)=="E")&&this._string.charAt(this._currentIndex+1)!="x"&&this._string.charAt(this._currentIndex+1)!="m"){this._currentIndex++;if(this._string.charAt(this._currentIndex)=="+")this._currentIndex++;else if(this._string.charAt(this._currentIndex)=="-"){this._currentIndex++;K=-1}if(this._currentIndex>=
this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";){c*=10;c+=this._string.charAt(this._currentIndex)-"0";this._currentIndex++}}k=k+w;k*=u;if(c)k*=Math.pow(10,K*c);if(B!=this._currentIndex){this._skipOptionalSpacesOrDelimiter();return k}}};j.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var c=
false;c=this._string.charAt(this._currentIndex++);if(c=="0")c=false;else if(c=="1")c=true;else return;this._skipOptionalSpacesOrDelimiter();return c}};j.prototype.parseSegment=function(){var c=this._string[this._currentIndex],k=this._pathSegTypeFromChar(c);if(k==SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==SVGPathSeg.PATHSEG_UNKNOWN)return null;k=this._nextCommandHelper(c,this._previousCommand);if(k==SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;this._previousCommand=k;
switch(k){case SVGPathSeg.PATHSEG_MOVETO_REL:return new SVGPathSegMovetoRel(s,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_MOVETO_ABS:return new SVGPathSegMovetoAbs(s,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_REL:return new SVGPathSegLinetoRel(s,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_ABS:return new SVGPathSegLinetoAbs(s,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new SVGPathSegLinetoHorizontalRel(s,
this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new SVGPathSegLinetoHorizontalAbs(s,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new SVGPathSegLinetoVerticalRel(s,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new SVGPathSegLinetoVerticalAbs(s,this._parseNumber());case SVGPathSeg.PATHSEG_CLOSEPATH:this._skipOptionalSpaces();return new SVGPathSegClosePath(s);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:c={x1:this._parseNumber(),
y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicRel(s,c.x,c.y,c.x1,c.y1,c.x2,c.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:c={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicAbs(s,c.x,c.y,c.x1,c.y1,c.x2,c.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:c={x2:this._parseNumber(),
y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothRel(s,c.x,c.y,c.x2,c.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:c={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothAbs(s,c.x,c.y,c.x2,c.y2);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:c={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticRel(s,
c.x,c.y,c.x1,c.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:c={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticAbs(s,c.x,c.y,c.x1,c.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new SVGPathSegCurvetoQuadraticSmoothRel(s,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new SVGPathSegCurvetoQuadraticSmoothAbs(s,this._parseNumber(),this._parseNumber());
case SVGPathSeg.PATHSEG_ARC_REL:c={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcRel(s,c.x,c.y,c.x1,c.y1,c.arcAngle,c.arcLarge,c.arcSweep);case SVGPathSeg.PATHSEG_ARC_ABS:c={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};
return new SVGPathSegArcAbs(s,c.x,c.y,c.x1,c.y1,c.arcAngle,c.arcLarge,c.arcSweep);default:throw"Unknown path seg type.";}};q=new q;g=new j(g);if(!g.initialCommandIsMoveTo())return[];for(;g.hasMoreData();){j=g.parseSegment();if(!j)return[];q.appendSegment(j)}return q.pathSegList};Object.defineProperty(SVGPathElement.prototype,"pathSegList",{get:function(){if(!this._pathSegList)this._pathSegList=new SVGPathSegList(this);return this._pathSegList},enumerable:true});Object.defineProperty(SVGPathElement.prototype,
"normalizedPathSegList",{get:function(){return this.pathSegList},enumerable:true});Object.defineProperty(SVGPathElement.prototype,"animatedPathSegList",{get:function(){return this.pathSegList},enumerable:true});Object.defineProperty(SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function(){return this.pathSegList},enumerable:true})}})();(function(){if(!svgedit.browser)svgedit.browser={};var g=svgedit.NS,s=!!document.createElementNS&&!!document.createElementNS(g.SVG,"svg").createSVGRect;svgedit.browser.supportsSvg=function(){return s};if(svgedit.browser.supportsSvg()){var q=navigator.userAgent,j=document.createElementNS(g.SVG,"svg"),c=!!window.opera,k=q.indexOf("AppleWebKit")>=0,i=q.indexOf("Gecko/")>=0,w=q.indexOf("MSIE")>=0,u=q.indexOf("Chrome/")>=0,K=q.indexOf("Windows")>=0,B=q.indexOf("Macintosh")>=0,d="ontouchstart"in window,
n=!!j.querySelector,f=!!document.evaluate,e=function(){var N=document.createElementNS(g.SVG,"path");N.setAttribute("d","M0,0 10,10");var T=N.pathSegList;N=N.createSVGPathSegLinetoAbs(5,5);try{T.replaceItem(N,1);return true}catch(ga){}return false}(),m=function(){var N=document.createElementNS(g.SVG,"path");N.setAttribute("d","M0,0 10,10");var T=N.pathSegList;N=N.createSVGPathSegLinetoAbs(5,5);try{T.insertItemBefore(N,1);return true}catch(ga){}return false}(),r=function(){var N=document.createElementNS(g.SVG,
"svg"),T=document.createElementNS(g.SVG,"svg");document.documentElement.appendChild(N);T.setAttribute("x",5);N.appendChild(T);var ga=document.createElementNS(g.SVG,"text");ga.textContent="a";T.appendChild(ga);T=ga.getStartPositionOfChar(0).x;document.documentElement.removeChild(N);return T===0}(),v=function(){var N=document.createElementNS(g.SVG,"svg");document.documentElement.appendChild(N);var T=document.createElementNS(g.SVG,"path");T.setAttribute("d","M0,0 C0,0 10,10 10,0");N.appendChild(T);T=
T.getBBox();document.documentElement.removeChild(N);return T.height>4&&T.height<5}(),t=function(){var N=document.createElementNS(g.SVG,"svg");document.documentElement.appendChild(N);var T=document.createElementNS(g.SVG,"path");T.setAttribute("d","M0,0 10,0");var ga=document.createElementNS(g.SVG,"path");ga.setAttribute("d","M5,0 15,0");var ba=document.createElementNS(g.SVG,"g");ba.appendChild(T);ba.appendChild(ga);N.appendChild(ba);T=ba.getBBox();document.documentElement.removeChild(N);return T.width==
15}(),O=function(){var N=document.createElementNS(g.SVG,"rect");N.setAttribute("x",0.1);(N=N.cloneNode(false).getAttribute("x").indexOf(",")==-1)||$.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\nPlease upgrade to the <a href="http://opera.com">latest version</a> in which the problems have been fixed.');return N}(),Q=function(){var N=document.createElementNS(g.SVG,"rect");N.setAttribute("style","vector-effect:non-scaling-stroke");return N.style.vectorEffect==="non-scaling-stroke"}(),
L=function(){var N=document.createElementNS(g.SVG,"rect").transform.baseVal,T=j.createSVGTransform();N.appendItem(T);return N.getItem(0)==T}();svgedit.browser.isOpera=function(){return c};svgedit.browser.isWebkit=function(){return k};svgedit.browser.isGecko=function(){return i};svgedit.browser.isIE=function(){return w};svgedit.browser.isChrome=function(){return u};svgedit.browser.isWindows=function(){return K};svgedit.browser.isMac=function(){return B};svgedit.browser.isTouch=function(){return d};
svgedit.browser.supportsSelectors=function(){return n};svgedit.browser.supportsXpath=function(){return f};svgedit.browser.supportsPathReplaceItem=function(){return e};svgedit.browser.supportsPathInsertItemBefore=function(){return m};svgedit.browser.supportsPathBBox=function(){return v};svgedit.browser.supportsHVLineContainerBBox=function(){return t};svgedit.browser.supportsGoodTextCharPos=function(){return r};svgedit.browser.supportsEditableText=function(){return c};svgedit.browser.supportsGoodDecimals=
function(){return O};svgedit.browser.supportsNonScalingStroke=function(){return Q};svgedit.browser.supportsNativeTransformLists=function(){return L}}else window.location="browser-not-supported.html"})();(function(){if(!svgedit.transformlist)svgedit.transformlist={};var g=document.createElementNS(svgedit.NS.SVG,"svg"),s={};svgedit.transformlist.SVGTransformList=function(q){this._elem=q||null;this._xforms=[];this._update=function(){var j="";g.createSVGMatrix();var c;for(c=0;c<this.numberOfItems;++c){var k=this._list.getItem(c);j=j;k=k;var i=k.matrix,w="";switch(k.type){case 1:w="matrix("+[i.a,i.b,i.c,i.d,i.e,i.f].join(",")+")";break;case 2:w="translate("+i.e+","+i.f+")";break;case 3:w=i.a==i.d?"scale("+
i.a+")":"scale("+i.a+","+i.d+")";break;case 4:var u=0;w=0;if(k.angle!=0){u=1-i.a;w=(u*i.f+i.b*i.e)/(u*u+i.b*i.b);u=(i.e-i.b*w)/u}w="rotate("+k.angle+" "+u+","+w+")"}j=j+(w+" ")}this._elem.setAttribute("transform",j)};this._list=this;this._init=function(){var j=this._elem.getAttribute("transform");if(j)for(var c=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/,k=true;k;){k=j.match(c);j=j.replace(c,"");if(k&&k[1]){var i=k[1].split(/\s*\(/),w=i[0];i=i[1].match(/\s*(.*?)\s*\)/);i[1]=i[1].replace(/(\d)-/g,
"$1 -");var u=i[1].split(/[, ]+/),K="abcdef".split(""),B=g.createSVGMatrix();$.each(u,function(f,e){u[f]=parseFloat(e);if(w=="matrix")B[K[f]]=u[f]});i=g.createSVGTransform();var d="set"+w.charAt(0).toUpperCase()+w.slice(1),n=w=="matrix"?[B]:u;if(w=="scale"&&n.length==1)n.push(n[0]);else if(w=="translate"&&n.length==1)n.push(0);else w=="rotate"&&n.length==1&&n.push(0,0);i[d].apply(i,n);this._list.appendItem(i)}}};this._removeFromOtherLists=function(j){if(j){var c=false,k;for(k in s){var i=s[k],w,u;
w=0;for(u=i._xforms.length;w<u;++w)if(i._xforms[w]==j){c=true;i.removeItem(w);break}if(c)break}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(j){this.numberOfItems=1;this._removeFromOtherLists(j);this._xforms=[j]};this.getItem=function(j){if(j<this.numberOfItems&&j>=0)return this._xforms[j];throw{code:1};};this.insertItemBefore=function(j,c){var k=null;if(c>=0)if(c<this.numberOfItems){this._removeFromOtherLists(j);k=Array(this.numberOfItems+
1);var i;for(i=0;i<c;++i)k[i]=this._xforms[i];k[i]=j;var w;for(w=i+1;i<this.numberOfItems;++w,++i)k[w]=this._xforms[i];this.numberOfItems++;this._xforms=k;k=j;this._list._update()}else k=this._list.appendItem(j);return k};this.replaceItem=function(j,c){var k=null;if(c<this.numberOfItems&&c>=0){this._removeFromOtherLists(j);k=this._xforms[c]=j;this._list._update()}return k};this.removeItem=function(j){if(j<this.numberOfItems&&j>=0){var c=this._xforms[j],k=Array(this.numberOfItems-1),i;for(i=0;i<j;++i)k[i]=
this._xforms[i];for(j=i;j<this.numberOfItems-1;++j,++i)k[j]=this._xforms[i+1];this.numberOfItems--;this._xforms=k;this._list._update();return c}throw{code:1};};this.appendItem=function(j){this._removeFromOtherLists(j);this._xforms.push(j);this.numberOfItems++;this._list._update();return j}};svgedit.transformlist.resetListMap=function(){s={}};svgedit.transformlist.removeElementFromListMap=function(q){q.id&&s[q.id]&&delete s[q.id]};svgedit.transformlist.getTransformList=function(q){if(!svgedit.browser.supportsNativeTransformLists()){var j=
q.id||"temp",c=s[j];if(!c||j==="temp"){s[j]=new svgedit.transformlist.SVGTransformList(q);s[j]._init();c=s[j]}return c}if(q.transform)return q.transform.baseVal;if(q.gradientTransform)return q.gradientTransform.baseVal;if(q.patternTransform)return q.patternTransform.baseVal;return null}})();(function(){if(!svgedit.math)svgedit.math={};var g=document.createElementNS(svgedit.NS.SVG,"svg");svgedit.math.transformPoint=function(s,q,j){return{x:j.a*s+j.c*q+j.e,y:j.b*s+j.d*q+j.f}};svgedit.math.isIdentity=function(s){return s.a===1&&s.b===0&&s.c===0&&s.d===1&&s.e===0&&s.f===0};svgedit.math.matrixMultiply=function(){for(var s=arguments,q=s.length,j=s[q-1];q-- >1;)j=s[q-1].multiply(j);if(Math.abs(j.a)<1.0E-14)j.a=0;if(Math.abs(j.b)<1.0E-14)j.b=0;if(Math.abs(j.c)<1.0E-14)j.c=0;if(Math.abs(j.d)<
1.0E-14)j.d=0;if(Math.abs(j.e)<1.0E-14)j.e=0;if(Math.abs(j.f)<1.0E-14)j.f=0;return j};svgedit.math.hasMatrixTransform=function(s){if(!s)return false;for(var q=s.numberOfItems;q--;){var j=s.getItem(q);if(j.type==1&&!svgedit.math.isIdentity(j.matrix))return true}return false};svgedit.math.transformBox=function(s,q,j,c,k){var i=svgedit.math.transformPoint,w=i(s,q,k),u=i(s+j,q,k),K=i(s,q+c,k);s=i(s+j,q+c,k);q=Math.min(w.x,u.x,K.x,s.x);j=Math.min(w.y,u.y,K.y,s.y);return{tl:w,tr:u,bl:K,br:s,aabox:{x:q,
y:j,width:Math.max(w.x,u.x,K.x,s.x)-q,height:Math.max(w.y,u.y,K.y,s.y)-j}}};svgedit.math.transformListToTransform=function(s,q,j){if(s==null)return g.createSVGTransformFromMatrix(g.createSVGMatrix());q=q||0;j=j||s.numberOfItems-1;q=parseInt(q,10);j=parseInt(j,10);if(q>j){var c=j;j=q;q=c}c=g.createSVGMatrix();for(q=q;q<=j;++q){var k=q>=0&&q<s.numberOfItems?s.getItem(q).matrix:g.createSVGMatrix();c=svgedit.math.matrixMultiply(c,k)}return g.createSVGTransformFromMatrix(c)};svgedit.math.getMatrix=function(s){s=
svgedit.transformlist.getTransformList(s);return svgedit.math.transformListToTransform(s).matrix};svgedit.math.snapToAngle=function(s,q,j,c){var k=Math.PI/4;j=j-s;var i=c-q;c=Math.sqrt(j*j+i*i);k=Math.round(Math.atan2(i,j)/k)*k;return{x:s+c*Math.cos(k),y:q+c*Math.sin(k),a:k}};svgedit.math.rectsIntersect=function(s,q){return q.x<s.x+s.width&&q.x+q.width>s.x&&q.y<s.y+s.height&&q.y+q.height>s.y}})();(function(){if(!svgedit.units)svgedit.units={};var g=svgedit.NS,s=["x","x1","cx","rx","width"],q=["y","y1","cy","ry","height"],j=["r","radius"].concat(s,q),c,k={};svgedit.units.init=function(w){c=w;w=document.createElementNS(g.SVG,"svg");document.body.appendChild(w);var u=document.createElementNS(g.SVG,"rect");u.setAttribute("width","1em");u.setAttribute("height","1ex");u.setAttribute("x","1in");w.appendChild(u);u=u.getBBox();document.body.removeChild(w);w=u.x;k={em:u.width,ex:u.height,"in":w,cm:w/
2.54,mm:w/25.4,pt:w/72,pc:w/6,px:1,"%":0}};svgedit.units.getTypeMap=function(){return k};svgedit.units.shortFloat=function(w){var u=c.getRoundDigits();if(!isNaN(w))return+(+w).toFixed(u);if($.isArray(w))return svgedit.units.shortFloat(w[0])+","+svgedit.units.shortFloat(w[1]);return parseFloat(w).toFixed(u)-0};svgedit.units.convertUnit=function(w,u){u=u||c.getBaseUnit();return svgedit.units.shortFloat(w/k[u])};svgedit.units.setUnitAttr=function(w,u,K){w.setAttribute(u,K)};var i={line:["x1","x2","y1",
"y2"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],foreignObject:["x","y","width","height"],rect:["x","y","width","height"],image:["x","y","width","height"],use:["x","y","width","height"],text:["x","y"]};svgedit.units.convertAttrs=function(w){var u=w.tagName,K=c.getBaseUnit();if(u=i[u]){var B=u.length,d;for(d=0;d<B;d++){var n=u[d],f=w.getAttribute(n);if(f)isNaN(f)||w.setAttribute(n,f/k[K]+K)}}};svgedit.units.convertToNum=function(w,u){if(!isNaN(u))return u-0;var K;if(u.substr(-1)==="%"){K=
u.substr(0,u.length-1)/100;var B=c.getWidth(),d=c.getHeight();if(s.indexOf(w)>=0)return K*B;if(q.indexOf(w)>=0)return K*d;return K*Math.sqrt(B*B+d*d)/Math.sqrt(2)}B=u.substr(-2);K=u.substr(0,u.length-2);return K*k[B]};svgedit.units.isValidUnit=function(w,u,K){var B=false;if(j.indexOf(w)>=0)if(isNaN(u)){u=u.toLowerCase();$.each(k,function(f){if(!B)if(RegExp("^-?[\\d\\.]+"+f+"$").test(u))B=true})}else B=true;else if(w=="id"){w=false;try{var d=c.getElement(u);w=d==null||d===K}catch(n){}return w}return B=
true}})();(function(g){function s(d){if(svgedit.browser.supportsHVLineContainerBBox())try{return d.getBBox()}catch(n){}var f=$.data(d,"ref"),e=null,m;if(f){m=$(f).children().clone().attr("visibility","hidden");$(K).append(m);e=m.filter("line, path")}else e=$(d).find("line, path");var r=false;if(e.length){e.each(function(){var v=this.getBBox();if(!v.width||!v.height)r=true});if(r){d=f?m:$(d).children();d=getStrokedBBox(d)}else d=d.getBBox()}else d=d.getBBox();f&&m.remove();return d}function q(d){var n=d.getAttribute("stroke-width");
return!isNaN(n)&&d.getAttribute("stroke")!="none"?n/2:0}function j(d,n,f,e){$.each(n,function(m,r){n[m]=svgedit.units.shortFloat(r)});d=d+n.join(" ");if(f)d+=" "+f.join(" ");if(e)d+=" "+svgedit.units.shortFloat(e);return d}if(!svgedit.utilities)svgedit.utilities={};var c=svgedit.NS,k="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),i=null,w=null,u=null,K=null;svgedit.utilities.init=function(d){i=d;w=d.getDOMDocument();u=d.getDOMContainer();K=d.getSVGRoot()};
svgedit.utilities.toXml=function(d){return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/,"&#x27;")};svgedit.utilities.fromXml=function(d){return $("<p/>").html(d).text()};svgedit.utilities.encode64=function(d){d=svgedit.utilities.encodeUTF8(d);if(window.btoa)return window.btoa(d);var n=[];n.length=Math.floor((d.length+2)/3)*4;var f,e,m,r,v,t,O=0,Q=0;do{f=d.charCodeAt(O++);e=d.charCodeAt(O++);m=d.charCodeAt(O++);r=f>>2;f=(f&3)<<4|e>>4;v=(e&15)<<
2|m>>6;t=m&63;if(isNaN(e))v=t=64;else if(isNaN(m))t=64;n[Q++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r);n[Q++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f);n[Q++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(v);n[Q++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t)}while(O<d.length);return n.join("")};svgedit.utilities.decode64=function(d){if(window.atob)return svgedit.utilities.decodeUTF8(window.atob(d));
var n="",f,e,m="",r,v="",t=0;d=d.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(t++));e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(t++));r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(t++));v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(t++));f=f<<2|e>>4;e=(e&15)<<4|r>>2;m=(r&3)<<6|v;n+=String.fromCharCode(f);
if(r!=64)n+=String.fromCharCode(e);if(v!=64)n+=String.fromCharCode(m)}while(t<d.length);return svgedit.utilities.decodeUTF8(n)};svgedit.utilities.decodeUTF8=function(d){return decodeURIComponent(escape(d))};svgedit.utilities.encodeUTF8=function(d){return unescape(encodeURIComponent(d))};svgedit.utilities.convertToXMLReferences=function(d){var n,f="";for(n=0;n<d.length;n++){var e=d.charCodeAt(n);if(e<128)f+=d[n];else if(e>127)f+="&#"+e+";"}return f};svgedit.utilities.text2xml=function(d){if(d.indexOf("<svg:svg")>=
0)d=d.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns");var n,f;try{f=window.DOMParser?new DOMParser:new ActiveXObject("Microsoft.XMLDOM");f.async=false}catch(e){throw Error("XML Parser could not be instantiated");}try{n=f.loadXML?f.loadXML(d)?f:false:f.parseFromString(d,"text/xml")}catch(m){throw Error("Error parsing XML string");}return n};svgedit.utilities.bboxToObj=function(d){return{x:d.x,y:d.y,width:d.width,height:d.height}};svgedit.utilities.walkTree=function(d,n){if(d&&d.nodeType==
1){n(d);for(var f=d.childNodes.length;f--;)svgedit.utilities.walkTree(d.childNodes.item(f),n)}};svgedit.utilities.walkTreePost=function(d,n){if(d&&d.nodeType==1){for(var f=d.childNodes.length;f--;)svgedit.utilities.walkTree(d.childNodes.item(f),n);n(d)}};svgedit.utilities.getUrlFromAttr=function(d){if(d){if(d.indexOf('url("')===0)return d.substring(5,d.indexOf('"',6));if(d.indexOf("url('")===0)return d.substring(5,d.indexOf("'",6));if(d.indexOf("url(")===0)return d.substring(4,d.indexOf(")"))}return null};
svgedit.utilities.getHref=function(d){return d.getAttributeNS(c.XLINK,"href")};svgedit.utilities.setHref=function(d,n){d.setAttributeNS(c.XLINK,"xlink:href",n)};svgedit.utilities.findDefs=function(){var d=i.getSVGContent(),n=d.getElementsByTagNameNS(c.SVG,"defs");if(n.length>0)n=n[0];else{n=d.ownerDocument.createElementNS(c.SVG,"defs");d.firstChild?d.insertBefore(n,d.firstChild.nextSibling):d.appendChild(n)}return n};svgedit.utilities.getPathBBox=function(d){var n=d.pathSegList,f=n.numberOfItems;
d=[[],[]];var e=n.getItem(0),m=[e.x,e.y];for(e=0;e<f;e++){var r=n.getItem(e);if(r.x!==g){d[0].push(m[0]);d[1].push(m[1]);if(r.x1){var v=[r.x1,r.y1],t=[r.x2,r.y2],O=[r.x,r.y],Q;for(Q=0;Q<2;Q++){r=function(ba){return Math.pow(1-ba,3)*m[Q]+3*Math.pow(1-ba,2)*ba*v[Q]+3*(1-ba)*Math.pow(ba,2)*t[Q]+Math.pow(ba,3)*O[Q]};var L=6*m[Q]-12*v[Q]+6*t[Q],N=-3*m[Q]+9*v[Q]-9*t[Q]+3*O[Q],T=3*v[Q]-3*m[Q];if(N==0){if(L!=0){L=-T/L;0<L&&L<1&&d[Q].push(r(L))}}else{T=Math.pow(L,2)-4*T*N;if(!(T<0)){var ga=(-L+Math.sqrt(T))/
(2*N);0<ga&&ga<1&&d[Q].push(r(ga));L=(-L-Math.sqrt(T))/(2*N);0<L&&L<1&&d[Q].push(r(L))}}}m=O}else{d[0].push(r.x);d[1].push(r.y)}}}n=Math.min.apply(null,d[0]);f=Math.max.apply(null,d[0])-n;e=Math.min.apply(null,d[1]);d=Math.max.apply(null,d[1])-e;return{x:n,y:e,width:f,height:d}};svgedit.utilities.getBBox=function(d){var n=d||i.geSelectedElements()[0];if(d.nodeType!=1)return null;d=null;var f=n.nodeName;switch(f){case "text":if(n.textContent===""){n.textContent="a";d=n.getBBox();n.textContent=""}else if(n.getBBox)d=
n.getBBox();break;case "path":if(svgedit.browser.supportsPathBBox()){if(n.getBBox)d=n.getBBox()}else d=svgedit.utilities.getPathBBox(n);break;case "g":case "a":d=s(n);break;default:if(f==="use")d=s(n,true);if(f==="use"||f==="foreignObject"&&svgedit.browser.isWebkit()){d||(d=n.getBBox());if(!svgedit.browser.isWebkit()){f={};f.width=d.width;f.height=d.height;f.x=d.x+parseFloat(n.getAttribute("x")||0);f.y=d.y+parseFloat(n.getAttribute("y")||0);d=f}}else if(~k.indexOf(f))if(n)d=n.getBBox();else{n=$(n).closest("foreignObject");
if(n.length)if(n[0].getBBox)d=n[0].getBBox()}}if(d)d=svgedit.utilities.bboxToObj(d);return d};svgedit.utilities.getPathDFromSegments=function(d){var n="";$.each(d,function(f,e){var m,r=e[1];n+=e[0];for(m=0;m<r.length;m+=2)n+=r[m]+","+r[m+1]+" "});return n};svgedit.utilities.getPathDFromElement=function(d){var n=1.81,f,e;switch(d.tagName){case "ellipse":case "circle":e=$(d).attr(["rx","ry","cx","cy"]);var m=e.cx,r=e.cy;f=e.rx;e=e.ry;if(d.tagName=="circle")f=e=$(d).attr("r");f=svgedit.utilities.getPathDFromSegments([["M",
[m-f,r]],["C",[m-f,r-e/n,m-f/n,r-e,m,r-e]],["C",[m+f/n,r-e,m+f,r-e/n,m+f,r]],["C",[m+f,r+e/n,m+f/n,r+e,m,r+e]],["C",[m-f/n,r+e,m-f,r+e/n,m-f,r]],["Z",[]]]);break;case "path":f=d.getAttribute("d");break;case "line":e=$(d).attr(["x1","y1","x2","y2"]);f="M"+e.x1+","+e.y1+"L"+e.x2+","+e.y2;break;case "polyline":f="M"+d.getAttribute("points");break;case "polygon":f="M"+d.getAttribute("points")+" Z";break;case "rect":e=$(d).attr(["rx","ry"]);f=e.rx;e=e.ry;var v=d.getBBox();d=v.x;m=v.y;r=v.width;v=v.height;
n=4-n;f=!f&&!e?svgedit.utilities.getPathDFromSegments([["M",[d,m]],["L",[d+r,m]],["L",[d+r,m+v]],["L",[d,m+v]],["L",[d,m]],["Z",[]]]):svgedit.utilities.getPathDFromSegments([["M",[d,m+e]],["C",[d,m+e/n,d+f/n,m,d+f,m]],["L",[d+r-f,m]],["C",[d+r-f/n,m,d+r,m+e/n,d+r,m+e]],["L",[d+r,m+v-e]],["C",[d+r,m+v-e/n,d+r-f/n,m+v,d+r-f,m+v]],["L",[d+f,m+v]],["C",[d+f/n,m+v,d,m+v-e/n,d,m+v-e]],["L",[d,m+e]],["Z",[]]])}return f};svgedit.utilities.getExtraAttributesForConvertToPath=function(d){var n={};$.each(["marker-start",
"marker-end","marker-mid","filter","clip-path"],function(){var f=d.getAttribute(this);if(f)n[this]=f});return n};svgedit.utilities.getBBoxOfElementAsPath=function(d,n,f){n=n({element:"path",attr:svgedit.utilities.getExtraAttributesForConvertToPath(d)});var e=d.getAttribute("transform");e&&n.setAttribute("transform",e);e=d.parentNode;d.nextSibling?e.insertBefore(n,d):e.appendChild(n);(d=svgedit.utilities.getPathDFromElement(d))?n.setAttribute("d",d):n.parentNode.removeChild(n);f.resetOrientation(n);
f=false;try{f=n.getBBox()}catch(m){}n.parentNode.removeChild(n);return f};svgedit.utilities.convertToPath=function(d,n,f,e,m,r,v,t){var O=new v.BatchCommand("Convert element to Path");n=$.extend({},n,svgedit.utilities.getExtraAttributesForConvertToPath(d));n=f({element:"path",attr:n});var Q=d.getAttribute("transform");Q&&n.setAttribute("transform",Q);f=d.id;var L=d.parentNode;d.nextSibling?L.insertBefore(n,d):L.appendChild(n);var N=svgedit.utilities.getPathDFromElement(d);if(N){n.setAttribute("d",
N);if(Q){Q=svgedit.transformlist.getTransformList(n);svgedit.math.hasMatrixTransform(Q)&&e.resetOrientation(n)}O.addSubCommand(new v.RemoveElementCommand(d,d.nextSibling,L));O.addSubCommand(new v.InsertElementCommand(n));m();d.parentNode.removeChild(d);n.setAttribute("id",f);n.removeAttribute("visibility");r([n],true);t(O);return n}else{n.parentNode.removeChild(n);return null}};svgedit.utilities.getBBoxWithTransform=function(d,n,f){var e=svgedit.utilities.getBBox(d);if(!e)return null;var m=svgedit.transformlist.getTransformList(d),
r=svgedit.utilities.getRotationAngleFromTransformList(m),v=svgedit.math.hasMatrixTransform(m);if(r||v){var t=false,O=r%90;r=O<-89.99||O>89.99;O=O>-0.001&&O<0.001;if(v||!(O||r))if(["ellipse","path","line","polyline","polygon"].indexOf(d.tagName)>=0)e=t=svgedit.utilities.getBBoxOfElementAsPath(d,n,f);else if(d.tagName=="rect"){v=d.getAttribute("rx");r=d.getAttribute("ry");if(v||r)e=t=svgedit.utilities.getBBoxOfElementAsPath(d,n,f)}if(!t){d=svgedit.math.transformListToTransform(m).matrix;e=svgedit.math.transformBox(e.x,
e.y,e.width,e.height,d).aabox}}return e};svgedit.utilities.getStrokedBBox=function(d,n,f){if(!d||!d.length)return false;var e;$.each(d,function(){if(!e)if(this.parentNode)e=svgedit.utilities.getBBoxWithTransform(this,n,f)});if(e===undefined)return null;var m=e.x+e.width,r=e.y+e.height,v=e.x,t=e.y;if(d.length===1){d=q(d[0]);v-=d;t-=d;m+=d;r+=d}else $.each(d,function(O,Q){var L=svgedit.utilities.getBBoxWithTransform(Q,n,f);if(L){var N=q(Q);v=Math.min(v,L.x-N);t=Math.min(t,L.y-N);if(Q.nodeType==1){m=
Math.max(m,L.x+L.width+N);r=Math.max(r,L.y+L.height+N)}}});e.x=v;e.y=t;e.width=m-v;e.height=r-t;return e};svgedit.utilities.getRotationAngleFromTransformList=function(d,n){if(!d)return 0;var f=d.numberOfItems,e;for(e=0;e<f;++e){var m=d.getItem(e);if(m.type==4)return n?m.angle*Math.PI/180:m.angle}return 0};svgedit.utilities.getRotationAngle=function(d,n){var f=d||i.getSelectedElements()[0];f=svgedit.transformlist.getTransformList(f);return svgedit.utilities.getRotationAngleFromTransformList(f,n)};
svgedit.utilities.getRefElem=function(d){return svgedit.utilities.getElem(svgedit.utilities.getUrlFromAttr(d).substr(1))};svgedit.utilities.getElem=svgedit.browser.supportsSelectors()?function(d){return K.querySelector("#"+d)}:svgedit.browser.supportsXpath()?function(d){return w.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+d+'"]',u,function(){return svgedit.NS.SVG},9,null).singleNodeValue}:function(d){return $(K).find("[id="+d+"]")[0]};svgedit.utilities.assignAttributes=function(d,n,f,e){for(var m in n)if(f=
m.substr(0,4)==="xml:"?c.XML:m.substr(0,6)==="xlink:"?c.XLINK:null)d.setAttributeNS(f,m,n[m]);else e?svgedit.units.setUnitAttr(d,m,n[m]):d.setAttribute(m,n[m])};svgedit.utilities.cleanupElement=function(d){var n={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0};if(d.nodeName==="ellipse"){delete n.rx;delete n.ry}for(var f in n){var e=n[f];d.getAttribute(f)==e&&d.removeAttribute(f)}};
svgedit.utilities.snapToGrid=function(d){var n=i.getSnappingStep(),f=i.getBaseUnit();if(f!=="px")n*=svgedit.units.getTypeMap()[f];return d=Math.round(d/n)*n};svgedit.utilities.preg_quote=function(d,n){return String(d).replace(RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(n||"")+"-]","g"),"\\$&")};svgedit.utilities.executeAfterLoads=function(d,n,f){return function(){function e(){f.apply(null,m)}var m=arguments;window[d]?e():n.reduceRight(function(r,v){return function(){$.getScript(v,r)}},e)()}};svgedit.utilities.buildCanvgCallback=
function(d){return svgedit.utilities.executeAfterLoads("canvg",["canvg/rgbcolor.js","canvg/canvg.js"],d)};svgedit.utilities.buildJSPDFCallback=function(d){return svgedit.utilities.executeAfterLoads("RGBColor",["canvg/rgbcolor.js"],function(){var n=[];if(!RGBColor||RGBColor.ok===g)n.push("canvg/rgbcolor.js");svgedit.utilities.executeAfterLoads("jsPDF",n.concat("jspdf/underscore-min.js","jspdf/jspdf.min.js","jspdf/jspdf.plugin.svgToPdf.js"),d)()})};svgedit.utilities.preventClickDefault=function(d){$(d).click(function(n){n.preventDefault()})};
svgedit.utilities.copyElem=function(d,n){var f=document.createElementNS(d.namespaceURI,d.nodeName);$.each(d.attributes,function(m,r){r.localName!="-moz-math-font-style"&&f.setAttributeNS(r.namespaceURI,r.nodeName,r.value)});f.removeAttribute("id");f.id=n();if(svgedit.browser.isWebkit()&&d.nodeName=="path"){var e=svgedit.utilities.convertPath(d);f.setAttribute("d",e)}$.each(d.childNodes,function(m,r){switch(r.nodeType){case 1:f.appendChild(svgedit.utilities.copyElem(r,n));break;case 3:f.appendChild(document.createTextNode(r.textContent))}});
if($(d).data("gsvg"))$(f).data("gsvg",f.firstChild);else if($(d).data("symbol")){e=$(d).data("symbol");$(f).data("ref",e).data("symbol",e)}else f.tagName=="image"&&preventClickDefault(f);return f};var B=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"];svgedit.utilities.convertPath=function(d,n){var f,e=d.pathSegList,m=e.numberOfItems,r=0,v=0,t="",O=null;for(f=0;f<m;++f){var Q=e.getItem(f),L=Q.x||0,N=Q.y||0,T=Q.x1||0,ga=Q.y1||0,ba=Q.x2||0,pa=Q.y2||0,ta=Q.pathSegType,
qa=B[ta]["to"+(n?"Lower":"Upper")+"Case"]();switch(ta){case 1:t+="z";break;case 12:L-=r;case 13:if(n){r+=L;qa="l"}else{L+=r;r=L;qa="L"}t+=j(qa,[[L,v]]);break;case 14:N-=v;case 15:if(n){v+=N;qa="l"}else{N+=v;v=N;qa="L"}t+=j(qa,[[r,N]]);break;case 2:case 4:case 18:L-=r;N-=v;case 5:case 3:if(O&&e.getItem(f-1).pathSegType===1&&!n){r=O[0];v=O[1]}case 19:if(n){r+=L;v+=N}else{L+=r;N+=v;r=L;v=N}if(ta===3)O=[r,v];t+=j(qa,[[L,N]]);break;case 6:L-=r;T-=r;ba-=r;N-=v;ga-=v;pa-=v;case 7:if(n){r+=L;v+=N}else{L+=
r;T+=r;ba+=r;N+=v;ga+=v;pa+=v;r=L;v=N}t+=j(qa,[[T,ga],[ba,pa],[L,N]]);break;case 8:L-=r;T-=r;N-=v;ga-=v;case 9:if(n){r+=L;v+=N}else{L+=r;T+=r;N+=v;ga+=v;r=L;v=N}t+=j(qa,[[T,ga],[L,N]]);break;case 10:L-=r;N-=v;case 11:if(n){r+=L;v+=N}else{L+=r;N+=v;r=L;v=N}t+=j(qa,[[Q.r1,Q.r2]],[Q.angle,Q.largeArcFlag?1:0,Q.sweepFlag?1:0],[L,N]);break;case 16:L-=r;ba-=r;N-=v;pa-=v;case 17:if(n){r+=L;v+=N}else{L+=r;ba+=r;N+=v;pa+=v;r=L;v=N}t+=j(qa,[[ba,pa],[L,N]])}}return t}})();(function(){if(!svgedit.sanitize)svgedit.sanitize={};var g=svgedit.NS,s=svgedit.getReverseNS(),q={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask",
"opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin",
"stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display",
"fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id",
"class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity",
"stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id",
"r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class",
"clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures",
"spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],
mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing",
"width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},j={};$.each(q,function(c,k){var i={};$.each(k,function(w,u){if(u.indexOf(":")>=0){var K=u.split(":");i[K[1]]=g[K[0].toUpperCase()]}else i[u]=u=="xmlns"?g.XMLNS:null});j[c]=i});svgedit.sanitize.sanitizeSvg=function(c){if(c.nodeType==3){c.nodeValue=c.nodeValue.replace(/^\s+|\s+$/g,"");c.nodeValue.length===0&&c.parentNode.removeChild(c)}if(c.nodeType==1){var k=
c.parentNode;if(c.ownerDocument&&k){var i=q[c.nodeName],w=j[c.nodeName],u;if(typeof i!=="undefined"){var K=[];for(u=c.attributes.length;u--;){var B=c.attributes.item(u),d=B.nodeName,n=B.localName,f=B.namespaceURI;if(!(w.hasOwnProperty(n)&&f==w[n]&&f!=g.XMLNS)&&!(f==g.XMLNS&&s[B.value])){d.indexOf("se:")===0&&K.push([d,B.value]);c.removeAttributeNS(f,n)}if(svgedit.browser.isGecko())switch(d){case "transform":case "gradientTransform":case "patternTransform":n=B.value.replace(/(\d)-/g,"$1 -");c.setAttribute(d,
n)}if(d=="style"){B=B.value.split(";");for(d=B.length;d--;){f=B[d].split(":");n=$.trim(f[0]);f=$.trim(f[1]);i.indexOf(n)>=0&&c.setAttribute(n,f)}c.removeAttribute("style")}}$.each(K,function(e,m){c.setAttributeNS(g.SE,m[0],m[1])});if((u=svgedit.utilities.getHref(c))&&["filter","linearGradient","pattern","radialGradient","textPath","use"].indexOf(c.nodeName)>=0)if(u[0]!="#"){svgedit.utilities.setHref(c,"");c.removeAttributeNS(g.XLINK,"href")}if(c.nodeName=="use"&&!svgedit.utilities.getHref(c))k.removeChild(c);
else{$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(e,m){var r=c.getAttribute(m);if(r)if((r=svgedit.utilities.getUrlFromAttr(r))&&r[0]!=="#"){c.setAttribute(m,"");c.removeAttribute(m)}});for(u=c.childNodes.length;u--;)svgedit.sanitize.sanitizeSvg(c.childNodes.item(u))}}else{for(i=[];c.hasChildNodes();)i.push(k.insertBefore(c.firstChild,c));k.removeChild(c);for(u=i.length;u--;)svgedit.sanitize.sanitizeSvg(i[u])}}}}})();(function(){if(!svgedit.history)svgedit.history={};svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};svgedit.history.MoveElementCommand=function(g,s,q,j){this.elem=g;this.text=j?"Move "+g.tagName+" to "+j:"Move "+g.tagName;this.oldNextSibling=s;this.oldParent=q;this.newNextSibling=g.nextSibling;this.newParent=g.parentNode};svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"};
svgedit.history.MoveElementCommand.prototype.type=svgedit.history.MoveElementCommand.type;svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.MoveElementCommand.prototype.apply=function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling);g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.MoveElementCommand.prototype.unapply=
function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling);g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.InsertElementCommand=function(g,s){this.elem=g;this.text=s||"Create "+g.tagName;this.parent=g.parentNode;this.nextSibling=this.elem.nextSibling};svgedit.history.InsertElementCommand.type=
function(){return"svgedit.history.InsertElementCommand"};svgedit.history.InsertElementCommand.prototype.type=svgedit.history.InsertElementCommand.type;svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text};svgedit.history.InsertElementCommand.prototype.apply=function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.parent.insertBefore(this.elem,this.nextSibling);g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.InsertElementCommand.prototype.unapply=function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem);g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.RemoveElementCommand=function(g,s,q,j){this.elem=g;this.text=j||"Delete "+g.tagName;
this.nextSibling=s;this.parent=q;svgedit.transformlist.removeElementFromListMap(g)};svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"};svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type;svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.RemoveElementCommand.prototype.apply=function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);
svgedit.transformlist.removeElementFromListMap(this.elem);this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem);g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.RemoveElementCommand.prototype.unapply=function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);svgedit.transformlist.removeElementFromListMap(this.elem);this.nextSibling==null&&window.console&&console.log("Error: reference element was lost");
this.parent.insertBefore(this.elem,this.nextSibling);g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.ChangeElementCommand=function(g,s,q){this.elem=g;this.text=q?"Change "+g.tagName+" "+q:"Change "+g.tagName;this.newValues={};this.oldValues=s;for(var j in s)this.newValues[j]=j=="#text"?g.textContent:j=="#href"?svgedit.utilities.getHref(g):g.getAttribute(j)};svgedit.history.ChangeElementCommand.type=
function(){return"svgedit.history.ChangeElementCommand"};svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type;svgedit.history.ChangeElementCommand.prototype.getText=function(){return this.text};svgedit.history.ChangeElementCommand.prototype.apply=function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var s=false,q;for(q in this.newValues){if(this.newValues[q])if(q=="#text")this.elem.textContent=this.newValues[q];else q=="#href"?
svgedit.utilities.setHref(this.elem,this.newValues[q]):this.elem.setAttribute(q,this.newValues[q]);else if(q=="#text")this.elem.textContent="";else{this.elem.setAttribute(q,"");this.elem.removeAttribute(q)}if(q=="transform")s=true}if(!s)if(s=svgedit.utilities.getRotationAngle(this.elem)){q=elem.getBBox();s=["rotate(",s," ",q.x+q.width/2,",",q.y+q.height/2,")"].join("");s!=elem.getAttribute("transform")&&elem.setAttribute("transform",s)}g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this);return true};svgedit.history.ChangeElementCommand.prototype.unapply=function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var s=false,q;for(q in this.oldValues){if(this.oldValues[q])if(q=="#text")this.elem.textContent=this.oldValues[q];else q=="#href"?svgedit.utilities.setHref(this.elem,this.oldValues[q]):this.elem.setAttribute(q,this.oldValues[q]);else if(q=="#text")this.elem.textContent="";else this.elem.removeAttribute(q);if(q=="transform")s=true}if(!s)if(s=
svgedit.utilities.getRotationAngle(this.elem)){q=elem.getBBox();s=["rotate(",s," ",q.x+q.width/2,",",q.y+q.height/2,")"].join("");s!=elem.getAttribute("transform")&&elem.setAttribute("transform",s)}svgedit.transformlist.removeElementFromListMap(this.elem);g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this);return true};svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.BatchCommand=function(g){this.text=g||"Batch Command";
this.stack=[]};svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"};svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type;svgedit.history.BatchCommand.prototype.getText=function(){return this.text};svgedit.history.BatchCommand.prototype.apply=function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var s,q=this.stack.length;for(s=0;s<q;++s)this.stack[s].apply(g);g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.BatchCommand.prototype.unapply=function(g){g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var s;for(s=this.stack.length-1;s>=0;s--)this.stack[s].unapply(g);g&&g.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.BatchCommand.prototype.elements=function(){for(var g=[],s=this.stack.length;s--;)for(var q=this.stack[s].elements(),j=q.length;j--;)g.indexOf(q[j])==-1&&g.push(q[j]);return g};svgedit.history.BatchCommand.prototype.addSubCommand=
function(g){this.stack.push(g)};svgedit.history.BatchCommand.prototype.isEmpty=function(){return this.stack.length===0};svgedit.history.UndoManager=function(g){this.handler_=g||null;this.undoStackPointer=0;this.undoStack=[];this.undoChangeStackPointer=-1;this.undoableChangeStack=[]};svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[];this.undoStackPointer=0};svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer};svgedit.history.UndoManager.prototype.getRedoStackSize=
function(){return this.undoStack.length-this.undoStackPointer};svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""};svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""};svgedit.history.UndoManager.prototype.undo=function(){this.undoStackPointer>0&&this.undoStack[--this.undoStackPointer].unapply(this.handler_)};
svgedit.history.UndoManager.prototype.redo=function(){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&this.undoStack[this.undoStackPointer++].apply(this.handler_)};svgedit.history.UndoManager.prototype.addCommandToHistory=function(g){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0)this.undoStack=this.undoStack.splice(0,this.undoStackPointer);this.undoStack.push(g);this.undoStackPointer=this.undoStack.length};svgedit.history.UndoManager.prototype.beginUndoableChange=
function(g,s){for(var q=++this.undoChangeStackPointer,j=s.length,c=Array(j),k=Array(j);j--;){var i=s[j];if(i!=null){k[j]=i;c[j]=i.getAttribute(g)}}this.undoableChangeStack[q]={attrName:g,oldValues:c,elements:k}};svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var g=this.undoChangeStackPointer--,s=this.undoableChangeStack[g],q=s.elements.length,j=s.attrName,c=new svgedit.history.BatchCommand("Change "+j);q--;){var k=s.elements[q];if(k!=null){var i={};i[j]=s.oldValues[q];i[j]!=
k.getAttribute(j)&&c.addSubCommand(new svgedit.history.ChangeElementCommand(k,i,j))}}this.undoableChangeStack[g]=null;return c}})();(function(){if(!svgedit.history)svgedit.history={};var g=svgedit.history,s=g.HistoryRecordingService=function(q){this.undoManager_=q;this.currentBatchCommand_=null;this.batchCommandStack_=[]};s.NO_HISTORY=new s;s.prototype.startBatchCommand=function(q){if(!this.undoManager_)return this;this.currentBatchCommand_=new g.BatchCommand(q);this.batchCommandStack_.push(this.currentBatchCommand_);return this};s.prototype.endBatchCommand=function(){if(!this.undoManager_)return this;if(this.currentBatchCommand_){var q=
this.currentBatchCommand_;this.batchCommandStack_.pop();var j=this.batchCommandStack_.length;this.currentBatchCommand_=j?this.batchCommandStack_[j-1]:null;this.addCommand_(q)}return this};s.prototype.moveElement=function(q,j,c,k){if(!this.undoManager_)return this;this.addCommand_(new g.MoveElementCommand(q,j,c,k));return this};s.prototype.insertElement=function(q,j){if(!this.undoManager_)return this;this.addCommand_(new g.InsertElementCommand(q,j));return this};s.prototype.removeElement=function(q,
j,c,k){if(!this.undoManager_)return this;this.addCommand_(new g.RemoveElementCommand(q,j,c,k));return this};s.prototype.changeElement=function(q,j,c){if(!this.undoManager_)return this;this.addCommand_(new g.ChangeElementCommand(q,j,c));return this};s.prototype.addCommand_=function(q){if(!this.undoManager_)return this;this.currentBatchCommand_?this.currentBatchCommand_.addSubCommand(q):this.undoManager_.addCommandToHistory(q)}})();var svgedit=svgedit||{};
(function(){if(!svgedit.coords)svgedit.coords={};var g=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],s=null;svgedit.coords.init=function(q){s=q};svgedit.coords.remapElement=function(q,j,c){var k,i,w=function(e,m){return svgedit.math.transformPoint(e,m,c)},u=s.getGridSnapping()&&q.parentNode.parentNode.localName==="svg",K=function(){var e;if(u)for(e in j)j[e]=svgedit.utilities.snapToGrid(j[e]);svgedit.utilities.assignAttributes(q,j,1E3,true)},B=svgedit.utilities.getBBox(q);
for(k=0;k<2;k++){i=k===0?"fill":"stroke";var d=q.getAttribute(i);if(d&&d.indexOf("url(")===0)if(c.a<0||c.d<0){d=svgedit.utilities.getRefElem(d).cloneNode(true);if(c.a<0){var n=d.getAttribute("x1"),f=d.getAttribute("x2");d.setAttribute("x1",-(n-1));d.setAttribute("x2",-(f-1))}if(c.d<0){n=d.getAttribute("y1");f=d.getAttribute("y2");d.setAttribute("y1",-(n-1));d.setAttribute("y2",-(f-1))}d.id=s.getDrawing().getNextId();svgedit.utilities.findDefs().appendChild(d);q.setAttribute(i,"url(#"+d.id+")")}}k=
q.tagName;if(k==="g"||k==="text"||k=="tspan"||k==="use")if(c.a==1&&c.b==0&&c.c==0&&c.d==1&&(c.e!=0||c.f!=0)){i=svgedit.math.transformListToTransform(q).matrix;i=svgedit.math.matrixMultiply(i.inverse(),c,i);j.x=parseFloat(j.x)+i.e;j.y=parseFloat(j.y)+i.f}else{i=svgedit.transformlist.getTransformList(q);d=svgroot.createSVGTransform();d.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(i).matrix,c));i.clear();i.appendItem(d)}switch(k){case "foreignObject":case "rect":case "image":if(k===
"image"&&(c.a<0||c.d<0)){i=svgedit.transformlist.getTransformList(q);d=svgroot.createSVGTransform();d.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(i).matrix,c));i.clear();i.appendItem(d)}else{d=w(j.x,j.y);j.width=c.a*j.width;j.height=c.d*j.height;j.x=d.x+Math.min(0,j.width);j.y=d.y+Math.min(0,j.height);j.width=Math.abs(j.width);j.height=Math.abs(j.height)}K();break;case "ellipse":w=w(j.cx,j.cy);j.cx=w.x;j.cy=w.y;j.rx=c.a*j.rx;j.ry=c.d*j.ry;j.rx=Math.abs(j.rx);j.ry=Math.abs(j.ry);
K();break;case "circle":w=w(j.cx,j.cy);j.cx=w.x;j.cy=w.y;w=svgedit.math.transformBox(B.x,B.y,B.width,B.height,c);j.r=Math.min((w.tr.x-w.tl.x)/2,(w.bl.y-w.tl.y)/2);if(j.r)j.r=Math.abs(j.r);K();break;case "line":d=w(j.x1,j.y1);n=w(j.x2,j.y2);j.x1=d.x;j.y1=d.y;j.x2=n.x;j.y2=n.y;case "text":case "tspan":case "use":K();break;case "g":(w=$(q).data("gsvg"))&&svgedit.utilities.assignAttributes(w,j,1E3,true);break;case "polyline":case "polygon":K=j.points.length;for(k=0;k<K;++k){i=j.points[k];i=w(i.x,i.y);
j.points[k].x=i.x;j.points[k].y=i.y}K=j.points.length;w="";for(k=0;k<K;++k){i=j.points[k];w+=i.x+","+i.y+" "}q.setAttribute("points",w);break;case "path":i=q.pathSegList;K=i.numberOfItems;j.d=[];for(k=0;k<K;++k){B=i.getItem(k);j.d[k]={type:B.pathSegType,x:B.x,y:B.y,x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,r1:B.r1,r2:B.r2,angle:B.angle,largeArcFlag:B.largeArcFlag,sweepFlag:B.sweepFlag}}K=j.d.length;k=j.d[0];f=w(k.x,k.y);j.d[0].x=f.x;j.d[0].y=f.y;for(k=1;k<K;++k){B=j.d[k];i=B.type;if(i%2==0){i=w(B.x!=undefined?
B.x:f.x,B.y!=undefined?B.y:f.y);d=w(B.x1,B.y1);n=w(B.x2,B.y2);B.x=i.x;B.y=i.y;B.x1=d.x;B.y1=d.y;B.x2=n.x;B.y2=n.y}else{B.x=c.a*B.x;B.y=c.d*B.y;B.x1=c.a*B.x1;B.y1=c.d*B.y1;B.x2=c.a*B.x2;B.y2=c.d*B.y2}B.r1=c.a*B.r1;B.r2=c.d*B.r2}w="";K=j.d.length;for(k=0;k<K;++k){B=j.d[k];i=B.type;w+=g[i];switch(i){case 13:case 12:w+=B.x+" ";break;case 15:case 14:w+=B.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:w+=B.x+","+B.y+" ";break;case 7:case 6:w+=B.x1+","+B.y1+" "+B.x2+","+B.y2+" "+B.x+","+B.y+" ";
break;case 9:case 8:w+=B.x1+","+B.y1+" "+B.x+","+B.y+" ";break;case 11:case 10:w+=B.r1+","+B.r2+" "+B.angle+" "+ +B.largeArcFlag+" "+ +B.sweepFlag+" "+B.x+","+B.y+" ";break;case 17:case 16:w+=B.x2+","+B.y2+" "+B.x+","+B.y+" "}}q.setAttribute("d",w)}}})();svgedit=svgedit||{};
(function(){if(!svgedit.recalculate)svgedit.recalculate={};var g=svgedit.NS,s;svgedit.recalculate.init=function(q){s=q};svgedit.recalculate.updateClipPath=function(q,j,c){q=getRefElem(q).firstChild;var k=svgedit.transformlist.getTransformList(q),i=s.getSVGRoot().createSVGTransform();i.setTranslate(j,c);k.appendItem(i);svgedit.recalculate.recalculateDimensions(q)};svgedit.recalculate.recalculateDimensions=function(q){if(q==null)return null;if(q.nodeName=="svg"&&navigator.userAgent.indexOf("Firefox/20")>=0)return null;
var j=s.getSVGRoot(),c=svgedit.transformlist.getTransformList(q),k;if(c&&c.numberOfItems>0){for(k=c.numberOfItems;k--;){var i=c.getItem(k);if(i.type===0)c.removeItem(k);else if(i.type===1)svgedit.math.isIdentity(i.matrix)&&c.removeItem(k);else i.type===4&&i.angle===0&&c.removeItem(k)}if(c.numberOfItems===1&&svgedit.utilities.getRotationAngle(q))return null}if(!c||c.numberOfItems==0){q.setAttribute("transform","");q.removeAttribute("transform");return null}if(c){k=c.numberOfItems;for(var w=[];k--;){i=
c.getItem(k);if(i.type===1)w.push([i.matrix,k]);else if(w.length)w=[]}if(w.length===2){k=j.createSVGTransformFromMatrix(svgedit.math.matrixMultiply(w[1][0],w[0][0]));c.removeItem(w[0][1]);c.removeItem(w[1][1]);c.insertItemBefore(k,w[1][1])}k=c.numberOfItems;if(k>=2&&c.getItem(k-2).type===1&&c.getItem(k-1).type===2){w=j.createSVGTransform();i=svgedit.math.matrixMultiply(c.getItem(k-2).matrix,c.getItem(k-1).matrix);w.setMatrix(i);c.removeItem(k-2);c.removeItem(k-2);c.appendItem(w)}}switch(q.tagName){case "line":case "polyline":case "polygon":case "path":break;
default:if(c.numberOfItems===1&&c.getItem(0).type===1||c.numberOfItems===2&&c.getItem(0).type===1&&c.getItem(0).type===4)return null}var u=$(q).data("gsvg");k=new svgedit.history.BatchCommand("Transform");var K={},B=null;i=[];switch(q.tagName){case "line":i=["x1","y1","x2","y2"];break;case "circle":i=["cx","cy","r"];break;case "ellipse":i=["cx","cy","rx","ry"];break;case "foreignObject":case "rect":case "image":i=["width","height","x","y"];break;case "use":case "text":case "tspan":i=["x","y"];break;
case "polygon":case "polyline":B={};B.points=q.getAttribute("points");w=q.points;var d=w.numberOfItems;K.points=Array(d);var n;for(n=0;n<d;++n){var f=w.getItem(n);K.points[n]={x:f.x,y:f.y}}break;case "path":B={};B.d=q.getAttribute("d");K.d=q.getAttribute("d")}if(i.length){K=$(q).attr(i);$.each(K,function(Ca,La){K[Ca]=svgedit.units.convertToNum(Ca,La)})}else if(u)K={x:$(u).attr("x")||0,y:$(u).attr("y")||0};if(B==null){B=$.extend(true,{},K);$.each(B,function(Ca,La){B[Ca]=svgedit.units.convertToNum(Ca,
La)})}B.transform=s.getStartTransform()||"";if(q.tagName=="g"&&!u||q.tagName=="a"){w=svgedit.utilities.getBBox(q);var e={x:w.x+w.width/2,y:w.y+w.height/2},m=svgedit.math.transformPoint(w.x+w.width/2,w.y+w.height/2,svgedit.math.transformListToTransform(c).matrix);i=j.createSVGMatrix();if(w=svgedit.utilities.getRotationAngle(q)){n=w*Math.PI/180;d=Math.abs(n)>1.0E-10?Math.sin(n)/(1-Math.cos(n)):2/n;for(n=0;n<c.numberOfItems;++n){i=c.getItem(n);if(i.type==4){i=i.matrix;e.y=(d*i.e+i.f)/2;e.x=(i.e-d*i.f)/
2;c.removeItem(n);break}}}n=i=u=0;var r=c.numberOfItems;if(r)var v=c.getItem(0).matrix;if(r>=3&&c.getItem(r-2).type==3&&c.getItem(r-3).type==2&&c.getItem(r-1).type==2){n=3;var t=c.getItem(r-3).matrix,O=c.getItem(r-2).matrix,Q=c.getItem(r-1).matrix;d=q.childNodes;for(f=d.length;f--;){var L=d.item(f);i=u=0;if(L.nodeType==1){var N=svgedit.transformlist.getTransformList(L);if(N){i=svgedit.math.transformListToTransform(N).matrix;u=svgedit.utilities.getRotationAngle(L);var T=s.getStartTransform(),ga=[];
s.setStartTransform(L.getAttribute("transform"));if(u||svgedit.math.hasMatrixTransform(N)){var ba=j.createSVGTransform();ba.setMatrix(svgedit.math.matrixMultiply(t,O,Q,i));N.clear();N.appendItem(ba);ga.push(ba)}else{u=svgedit.math.matrixMultiply(i.inverse(),Q,i);ba=j.createSVGMatrix();ba.e=-u.e;ba.f=-u.f;i=svgedit.math.matrixMultiply(ba.inverse(),i.inverse(),t,O,Q,i,u.inverse());var pa=j.createSVGTransform(),ta=j.createSVGTransform(),qa=j.createSVGTransform();pa.setTranslate(u.e,u.f);ta.setScale(i.a,
i.d);qa.setTranslate(ba.e,ba.f);N.appendItem(qa);N.appendItem(ta);N.appendItem(pa);ga.push(qa);ga.push(ta);ga.push(pa)}k.addSubCommand(svgedit.recalculate.recalculateDimensions(L));s.setStartTransform(T)}}}c.removeItem(r-1);c.removeItem(r-2);c.removeItem(r-3)}else if(r>=3&&c.getItem(r-1).type==1){n=3;i=svgedit.math.transformListToTransform(c).matrix;ba=j.createSVGTransform();ba.setMatrix(i);c.clear();c.appendItem(ba)}else if((r==1||r>1&&c.getItem(1).type!=3)&&c.getItem(0).type==2){n=2;u=svgedit.math.transformListToTransform(c).matrix;
c.removeItem(0);i=svgedit.math.transformListToTransform(c).matrix.inverse();i=svgedit.math.matrixMultiply(i,u);u=i.e;i=i.f;if(u!=0||i!=0){d=q.childNodes;f=d.length;for(r=[];f--;){L=d.item(f);if(L.nodeType==1){if(L.getAttribute("clip-path")){T=L.getAttribute("clip-path");if(r.indexOf(T)===-1){svgedit.recalculate.updateClipPath(T,u,i);r.push(T)}}T=s.getStartTransform();s.setStartTransform(L.getAttribute("transform"));if(N=svgedit.transformlist.getTransformList(L)){t=j.createSVGTransform();t.setTranslate(u,
i);N.numberOfItems?N.insertItemBefore(t,0):N.appendItem(t);k.addSubCommand(svgedit.recalculate.recalculateDimensions(L));N=q.getElementsByTagNameNS(g.SVG,"use");L="#"+L.id;for(t=N.length;t--;){O=N.item(t);if(L==svgedit.utilities.getHref(O)){Q=j.createSVGTransform();Q.setTranslate(-u,-i);svgedit.transformlist.getTransformList(O).insertItemBefore(Q,0);k.addSubCommand(svgedit.recalculate.recalculateDimensions(O))}}s.setStartTransform(T)}}}r=[];s.setStartTransform(T)}}else if(r==1&&c.getItem(0).type==
1&&!w){n=1;i=c.getItem(0).matrix;d=q.childNodes;for(f=d.length;f--;){L=d.item(f);if(L.nodeType==1){T=s.getStartTransform();s.setStartTransform(L.getAttribute("transform"));if(N=svgedit.transformlist.getTransformList(L)){u=svgedit.math.matrixMultiply(i,svgedit.math.transformListToTransform(N).matrix);r=j.createSVGTransform();r.setMatrix(u);N.clear();N.appendItem(r,0);k.addSubCommand(svgedit.recalculate.recalculateDimensions(L));s.setStartTransform(T);T=L.getAttribute("stroke-width");L.getAttribute("stroke")!==
"none"&&!isNaN(T)&&L.setAttribute("stroke-width",T*((Math.abs(u.a)+Math.abs(u.d))/2))}}}c.clear()}else{if(w){j=j.createSVGTransform();j.setRotate(w,m.x,m.y);c.numberOfItems?c.insertItemBefore(j,0):c.appendItem(j)}c.numberOfItems==0&&q.removeAttribute("transform");return null}if(n==2){if(w){m={x:e.x+v.e,y:e.y+v.f};j=j.createSVGTransform();j.setRotate(w,m.x,m.y);c.numberOfItems?c.insertItemBefore(j,0):c.appendItem(j)}}else if(n==3){i=svgedit.math.transformListToTransform(c).matrix;v=j.createSVGTransform();
v.setRotate(w,e.x,e.y);v=v.matrix;e=j.createSVGTransform();e.setRotate(w,m.x,m.y);m=e.matrix.inverse();T=i.inverse();m=svgedit.math.matrixMultiply(T,m,v,i);u=m.e;i=m.f;if(u!=0||i!=0){d=q.childNodes;for(f=d.length;f--;){L=d.item(f);if(L.nodeType==1){T=s.getStartTransform();s.setStartTransform(L.getAttribute("transform"));N=svgedit.transformlist.getTransformList(L);t=j.createSVGTransform();t.setTranslate(u,i);N.numberOfItems?N.insertItemBefore(t,0):N.appendItem(t);k.addSubCommand(svgedit.recalculate.recalculateDimensions(L));
s.setStartTransform(T)}}}if(w)c.numberOfItems?c.insertItemBefore(e,0):c.appendItem(e)}}else{w=svgedit.utilities.getBBox(q);if(!w&&q.tagName!="path")return null;i=j.createSVGMatrix();if(u=svgedit.utilities.getRotationAngle(q)){e={x:w.x+w.width/2,y:w.y+w.height/2};m=svgedit.math.transformPoint(w.x+w.width/2,w.y+w.height/2,svgedit.math.transformListToTransform(c).matrix);n=u*Math.PI/180;d=Math.abs(n)>1.0E-10?Math.sin(n)/(1-Math.cos(n)):2/n;for(n=0;n<c.numberOfItems;++n){i=c.getItem(n);if(i.type==4){i=
i.matrix;e.y=(d*i.e+i.f)/2;e.x=(i.e-d*i.f)/2;c.removeItem(n);break}}}n=0;r=c.numberOfItems;if(!svgedit.browser.isWebkit())if((v=q.getAttribute("fill"))&&v.indexOf("url(")===0){v=getRefElem(v);T="pattern";if(v.tagName!==T)T="gradient";if(v.getAttribute(T+"Units")==="userSpaceOnUse"){i=svgedit.math.transformListToTransform(c).matrix;w=svgedit.transformlist.getTransformList(v);w=svgedit.math.transformListToTransform(w).matrix;i=svgedit.math.matrixMultiply(i,w);w="matrix("+[i.a,i.b,i.c,i.d,i.e,i.f].join(",")+
")";v.setAttribute(T+"Transform",w)}}if(r>=3&&c.getItem(r-2).type==3&&c.getItem(r-3).type==2&&c.getItem(r-1).type==2){n=3;i=svgedit.math.transformListToTransform(c,r-3,r-1).matrix;c.removeItem(r-1);c.removeItem(r-2);c.removeItem(r-3)}else if(r==4&&c.getItem(r-1).type==1){n=3;i=svgedit.math.transformListToTransform(c).matrix;ba=j.createSVGTransform();ba.setMatrix(i);c.clear();c.appendItem(ba);i=j.createSVGMatrix()}else if((r==1||r>1&&c.getItem(1).type!=3)&&c.getItem(0).type==2){n=2;v=c.getItem(0).matrix;
T=svgedit.math.transformListToTransform(c,1).matrix;w=T.inverse();i=svgedit.math.matrixMultiply(w,v,T);c.removeItem(0)}else if(r==1&&c.getItem(0).type==1&&!u){i=svgedit.math.transformListToTransform(c).matrix;switch(q.tagName){case "line":K=$(q).attr(["x1","y1","x2","y2"]);case "polyline":case "polygon":K.points=q.getAttribute("points");if(K.points){w=q.points;d=w.numberOfItems;K.points=Array(d);for(n=0;n<d;++n){f=w.getItem(n);K.points[n]={x:f.x,y:f.y}}}case "path":K.d=q.getAttribute("d");n=1;c.clear()}}else{n=
4;if(u){j=j.createSVGTransform();j.setRotate(u,m.x,m.y);c.numberOfItems?c.insertItemBefore(j,0):c.appendItem(j)}c.numberOfItems==0&&q.removeAttribute("transform");return null}if(n==1||n==2||n==3)svgedit.coords.remapElement(q,K,i);if(n==2){if(u){svgedit.math.hasMatrixTransform(c)||(m={x:e.x+i.e,y:e.y+i.f});j=j.createSVGTransform();j.setRotate(u,m.x,m.y);c.numberOfItems?c.insertItemBefore(j,0):c.appendItem(j)}if(q.tagName=="text"){d=q.childNodes;for(f=d.length;f--;){L=d.item(f);if(L.tagName=="tspan"){j=
{x:$(L).attr("x")||0,y:$(L).attr("y")||0};svgedit.coords.remapElement(L,j,i)}}}}else if(n==3&&u){i=svgedit.math.transformListToTransform(c).matrix;v=j.createSVGTransform();v.setRotate(u,e.x,e.y);v=v.matrix;e=j.createSVGTransform();e.setRotate(u,m.x,m.y);m=e.matrix.inverse();T=i.inverse();m=svgedit.math.matrixMultiply(T,m,v,i);svgedit.coords.remapElement(q,K,m);if(u)c.numberOfItems?c.insertItemBefore(e,0):c.appendItem(e)}}c.numberOfItems==0&&q.removeAttribute("transform");k.addSubCommand(new svgedit.history.ChangeElementCommand(q,
B));return k}})();(function(){if(!svgedit.select)svgedit.select={};var g,s,q,j=svgedit.browser.isTouch()?10:4;svgedit.select.Selector=function(c,k,i){this.id=c;this.selectedElement=k;this.locked=true;this.selectorGroup=g.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}});this.selectorRect=this.selectorGroup.appendChild(g.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}}));this.gripCoords=
{nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.reset(this.selectedElement,i)};svgedit.select.Selector.prototype.reset=function(c,k){this.locked=true;this.selectedElement=c;this.resize(k);this.selectorGroup.setAttribute("display","inline")};svgedit.select.Selector.prototype.updateGripCursors=function(c){var k,i=[];c=Math.round(c/45);if(c<0)c+=8;for(k in q.selectorGrips)i.push(k);for(;c>0;){i.push(i.shift());c--}c=0;for(k in q.selectorGrips){q.selectorGrips[k].setAttribute("style",
"cursor:"+i[c]+"-resize");c++}};svgedit.select.Selector.prototype.showGrips=function(c){q.selectorGripsGroup.setAttribute("display",c?"inline":"none");var k=this.selectedElement;this.hasGrips=c;if(k&&c){this.selectorGroup.appendChild(q.selectorGripsGroup);this.updateGripCursors(svgedit.utilities.getRotationAngle(k))}};svgedit.select.Selector.prototype.resize=function(c){var k=this.selectorRect,i=q,w=i.selectorGrips,u=this.selectedElement,K=u.getAttribute("stroke-width"),B=g.currentZoom(),d=1/B;if(u.getAttribute("stroke")!==
"none"&&!isNaN(K))d+=K/2;var n=u.tagName;if(n==="text")d+=2/B;K=svgedit.transformlist.getTransformList(u);K=svgedit.math.transformListToTransform(K).matrix;K.e*=B;K.f*=B;c||(c=svgedit.utilities.getBBox(u));if(n==="g"&&!$.data(u,"gsvg"))if(n=g.getStrokedBBox(u.childNodes))c=n;n=c.x;var f=c.y,e=c.width;c=c.height;d*=B;B=svgedit.math.transformBox(n*B,f*B,e*B,c*B,K);c=B.aabox;n=c.x-d;f=c.y-d;var m=c.width+d*2;e=c.height+d*2;c=n+m/2;K=f+e/2;if(u=svgedit.utilities.getRotationAngle(u)){n=g.svgRoot().createSVGTransform();
n.setRotate(-u,c,K);n=n.matrix;B.tl=svgedit.math.transformPoint(B.tl.x,B.tl.y,n);B.tr=svgedit.math.transformPoint(B.tr.x,B.tr.y,n);B.bl=svgedit.math.transformPoint(B.bl.x,B.bl.y,n);B.br=svgedit.math.transformPoint(B.br.x,B.br.y,n);n=B.tl;m=n.x;e=n.y;var r=n.x,v=n.y;n=Math.min;f=Math.max;m=n(m,n(B.tr.x,n(B.bl.x,B.br.x)))-d;e=n(e,n(B.tr.y,n(B.bl.y,B.br.y)))-d;r=f(r,f(B.tr.x,f(B.bl.x,B.br.x)))+d;v=f(v,f(B.tr.y,f(B.bl.y,B.br.y)))+d;n=m;f=e;m=r-m;e=v-e}k.setAttribute("d","M"+n+","+f+" L"+(n+m)+","+f+" "+
(n+m)+","+(f+e)+" "+n+","+(f+e)+"z");this.selectorGroup.setAttribute("transform",u?"rotate("+[u,c,K].join(",")+")":"");this.gripCoords={nw:[n,f],ne:[n+m,f],sw:[n,f+e],se:[n+m,f+e],n:[n+m/2,f],w:[n,f+e/2],e:[n+m,f+e/2],s:[n+m/2,f+e]};for(var t in this.gripCoords){k=this.gripCoords[t];w[t].setAttribute("cx",k[0]);w[t].setAttribute("cy",k[1])}i.rotateGripConnector.setAttribute("x1",n+m/2);i.rotateGripConnector.setAttribute("y1",f);i.rotateGripConnector.setAttribute("x2",n+m/2);i.rotateGripConnector.setAttribute("y2",
f-j*5);i.rotateGrip.setAttribute("cx",n+m/2);i.rotateGrip.setAttribute("cy",f-j*5)};svgedit.select.SelectorManager=function(){this.rubberBandBox=this.selectorParentGroup=null;this.selectors=[];this.selectorMap={};this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.rotateGrip=this.rotateGripConnector=this.selectorGripsGroup=null;this.initGroup()};svgedit.select.SelectorManager.prototype.initGroup=function(){this.selectorParentGroup&&this.selectorParentGroup.parentNode&&
this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup);this.selectorParentGroup=g.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}});this.selectorGripsGroup=g.createSVGElement({element:"g",attr:{display:"none"}});this.selectorParentGroup.appendChild(this.selectorGripsGroup);g.svgRoot().appendChild(this.selectorParentGroup);this.selectorMap={};this.selectors=[];this.rubberBandBox=null;for(var c in this.selectorGrips){var k=g.createSVGElement({element:"circle",attr:{id:"selectorGrip_resize_"+
c,fill:"#22C",r:j,style:"cursor:"+c+"-resize","stroke-width":2,"pointer-events":"all"}});$.data(k,"dir",c);$.data(k,"type","resize");this.selectorGrips[c]=this.selectorGripsGroup.appendChild(k)}this.rotateGripConnector=this.selectorGripsGroup.appendChild(g.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#22C","stroke-width":"1"}}));this.rotateGrip=this.selectorGripsGroup.appendChild(g.createSVGElement({element:"circle",attr:{id:"selectorGrip_rotate",fill:"lime",r:j,
stroke:"#22C","stroke-width":2,style:"cursor:url("+s.imgPath+"rotate.png) 12 12, auto;"}}));$.data(this.rotateGrip,"type","rotate");if(!$("#canvasBackground").length){c=s.dimensions;c=g.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:c[0],height:c[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}});k=g.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});
c.appendChild(k);g.svgRoot().insertBefore(c,g.svgContent())}};svgedit.select.SelectorManager.prototype.requestSelector=function(c,k){if(c==null)return null;var i,w=this.selectors.length;if(typeof this.selectorMap[c.id]=="object"){this.selectorMap[c.id].locked=true;return this.selectorMap[c.id]}for(i=0;i<w;++i)if(this.selectors[i]&&!this.selectors[i].locked){this.selectors[i].locked=true;this.selectors[i].reset(c,k);this.selectorMap[c.id]=this.selectors[i];return this.selectors[i]}this.selectors[w]=
new svgedit.select.Selector(w,c,k);this.selectorParentGroup.appendChild(this.selectors[w].selectorGroup);this.selectorMap[c.id]=this.selectors[w];return this.selectors[w]};svgedit.select.SelectorManager.prototype.releaseSelector=function(c){if(c!=null){var k,i=this.selectors.length,w=this.selectorMap[c.id];w.locked||console.log("WARNING! selector was released but was already unlocked");for(k=0;k<i;++k)if(this.selectors[k]&&this.selectors[k]==w){delete this.selectorMap[c.id];w.locked=false;w.selectedElement=
null;w.showGrips(false);try{w.selectorGroup.setAttribute("display","none")}catch(u){}break}}};svgedit.select.SelectorManager.prototype.getRubberBandBox=function(){if(!this.rubberBandBox)this.rubberBandBox=this.selectorParentGroup.appendChild(g.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":0.15,stroke:"#22C","stroke-width":0.5,display:"none",style:"pointer-events:none"}}));return this.rubberBandBox};svgedit.select.init=function(c,k){s=c;g=k;q=new svgedit.select.SelectorManager};
svgedit.select.getSelectorManager=function(){return q}})();(function(){function g(k){for(var i=1;k.indexOf("Layer "+i)>=0;)i++;return"Layer "+i}if(!svgedit.draw)svgedit.draw={};var s=svgedit.NS,q="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),j={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},c=j.LET_DOCUMENT_DECIDE;svgedit.draw.randomizeIds=function(k,i){c=k===false?j.NEVER_RANDOMIZE:j.ALWAYS_RANDOMIZE;if(c==j.ALWAYS_RANDOMIZE&&!i.getNonce())i.setNonce(Math.floor(Math.random()*100001));
else c==j.NEVER_RANDOMIZE&&i.getNonce()&&i.clearNonce()};svgedit.draw.Drawing=function(k,i){if(!k||!k.tagName||!k.namespaceURI||k.tagName!="svg"||k.namespaceURI!=s.SVG)throw"Error: svgedit.draw.Drawing instance initialized without a <svg> element";this.svgElem_=k;this.obj_num=0;this.idPrefix=i||"svg_";this.releasedNums=[];this.all_layers=[];this.layer_map={};this.current_layer=null;this.nonce_="";var w=this.svgElem_.getAttributeNS(s.SE,"nonce");if(w&&c!=j.NEVER_RANDOMIZE)this.nonce_=w;else c==j.ALWAYS_RANDOMIZE&&
this.setNonce(Math.floor(Math.random()*100001))};svgedit.draw.Drawing.prototype.getElem_=function(k){if(this.svgElem_.querySelector)return this.svgElem_.querySelector("#"+k);return $(this.svgElem_).find("[id="+k+"]")[0]};svgedit.draw.Drawing.prototype.getSvgElem=function(){return this.svgElem_};svgedit.draw.Drawing.prototype.getNonce=function(){return this.nonce_};svgedit.draw.Drawing.prototype.setNonce=function(k){this.svgElem_.setAttributeNS(s.XMLNS,"xmlns:se",s.SE);this.svgElem_.setAttributeNS(s.SE,
"se:nonce",k);this.nonce_=k};svgedit.draw.Drawing.prototype.clearNonce=function(){this.nonce_=""};svgedit.draw.Drawing.prototype.getId=function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num};svgedit.draw.Drawing.prototype.getNextId=function(){var k=this.obj_num,i=false;if(this.releasedNums.length>0){this.obj_num=this.releasedNums.pop();i=true}else this.obj_num++;for(var w=this.getId();this.getElem_(w);){if(i){this.obj_num=k;i=false}this.obj_num++;w=this.getId()}if(i)this.obj_num=
k;return w};svgedit.draw.Drawing.prototype.releaseId=function(k){var i=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if(typeof k!=="string"||k.indexOf(i)!==0)return false;k=parseInt(k.substr(i.length),10);if(typeof k!=="number"||k<=0||this.releasedNums.indexOf(k)!=-1)return false;this.releasedNums.push(k);return true};svgedit.draw.Drawing.prototype.getNumLayers=function(){return this.all_layers.length};svgedit.draw.Drawing.prototype.hasLayer=function(k){return this.layer_map[k]!==undefined};svgedit.draw.Drawing.prototype.getLayerName=
function(k){return k>=0&&k<this.getNumLayers()?this.all_layers[k].getName():""};svgedit.draw.Drawing.prototype.getCurrentLayer=function(){return this.current_layer?this.current_layer.getGroup():null};svgedit.draw.Drawing.prototype.getLayerByName=function(k){return(k=this.layer_map[k])?k.getGroup():null};svgedit.draw.Drawing.prototype.getCurrentLayerName=function(){return this.current_layer?this.current_layer.getName():""};svgedit.draw.Drawing.prototype.setCurrentLayerName=function(k,i){var w=null;
if(this.current_layer){var u=this.current_layer.getName();if(w=this.current_layer.setName(k,i)){delete this.layer_map[u];this.layer_map[w]=this.current_layer}}return w};svgedit.draw.Drawing.prototype.setCurrentLayerPosition=function(k){var i=this.getNumLayers();if(!this.current_layer||k<0||k>=i)return null;var w;for(w=0;w<i;++w)if(this.all_layers[w]==this.current_layer)break;if(w==i)return null;if(w!=k){var u=null,K=this.current_layer.getGroup(),B=K.nextSibling;if(k>w){if(k<i-1)u=this.all_layers[k+
1].getGroup()}else u=this.all_layers[k].getGroup();this.svgElem_.insertBefore(K,u);this.identifyLayers();this.setCurrentLayer(this.getLayerName(k));return{currentGroup:K,oldNextSibling:B}}return null};svgedit.draw.Drawing.prototype.mergeLayer=function(k){var i=this.current_layer.getGroup(),w=$(i).prev()[0];if(w){k.startBatchCommand("Merge Layer");for(k.removeElement(i,i.nextSibling,this.svgElem_);i.firstChild;){var u=i.firstChild;if(u.localName=="title"){k.removeElement(u,u.nextSibling,i);i.removeChild(u)}else{var K=
u.nextSibling;w.appendChild(u);k.moveElement(u,K,i)}}this.current_layer.removeGroup();i=this.all_layers.indexOf(this.current_layer);if(i>0){w=this.current_layer.getName();this.current_layer=this.all_layers[i-1];this.all_layers.splice(i,1);delete this.layer_map[w]}k.endBatchCommand()}};svgedit.draw.Drawing.prototype.mergeAllLayers=function(k){this.current_layer=this.all_layers[this.all_layers.length-1];for(k.startBatchCommand("Merge all Layers");this.all_layers.length>1;)this.mergeLayer(k);k.endBatchCommand()};
svgedit.draw.Drawing.prototype.setCurrentLayer=function(k){if(k=this.layer_map[k]){this.current_layer&&this.current_layer.deactivate();this.current_layer=k;this.current_layer.activate();return true}return false};svgedit.draw.Drawing.prototype.deleteCurrentLayer=function(){if(this.current_layer&&this.getNumLayers()>1){var k=this.current_layer.removeGroup();this.identifyLayers();return k}return null};svgedit.draw.Drawing.prototype.identifyLayers=function(){this.all_layers=[];this.layer_map={};for(var k=
this.svgElem_.childNodes.length,i=[],w=[],u=null,K=false,B=0;B<k;++B){var d=this.svgElem_.childNodes.item(B);if(d&&d.nodeType==1)if(d.tagName=="g"){K=true;var n;n=d;var f=$("title",n).text();if(!f&&svgedit.browser.isOpera()&&n.querySelectorAll)f=$(n.querySelectorAll("title")).text();if(n=f){w.push(n);u=new svgedit.draw.Layer(n,d);this.all_layers.push(u);this.layer_map[n]=u}else i.push(d)}else~q.indexOf(d.nodeName)&&i.push(d)}if(i.length>0||!K){u=new svgedit.draw.Layer(g(w),null,this.svgElem_);u.appendChildren(i);
this.all_layers.push(u);this.layer_map[n]=u}else u.activate();this.current_layer=u};svgedit.draw.Drawing.prototype.createLayer=function(k,i){this.current_layer&&this.current_layer.deactivate();if(k===undefined||k===null||k===""||this.layer_map[k])k=g(Object.keys(this.layer_map));var w=new svgedit.draw.Layer(k,null,this.svgElem_);if(i){i.startBatchCommand("Create Layer");i.insertElement(w.getGroup());i.endBatchCommand()}this.all_layers.push(w);this.current_layer=this.layer_map[k]=w;return w.getGroup()};
svgedit.draw.Drawing.prototype.cloneLayer=function(k,i){if(!this.current_layer)return null;this.current_layer.deactivate();if(k===undefined||k===null||k===""||this.layer_map[k])k=g(Object.keys(this.layer_map));var w=this.current_layer.getGroup(),u=new svgedit.draw.Layer(k,w,this.svgElem_),K=u.getGroup();w=w.childNodes;var B;for(B=0;B<w.length;B++){var d=w[B];d.localName!="title"&&K.appendChild(this.copyElem(d))}if(i){i.startBatchCommand("Duplicate Layer");i.insertElement(K);i.endBatchCommand()}B=
this.all_layers.indexOf(this.current_layer);B>=0?this.all_layers.splice(B+1,0,u):this.all_layers.push(u);this.current_layer=this.layer_map[k]=u;return K};svgedit.draw.Drawing.prototype.getLayerVisibility=function(k){return(k=this.layer_map[k])?k.isVisible():false};svgedit.draw.Drawing.prototype.setLayerVisibility=function(k,i){if(typeof i!=="boolean")return null;var w=this.layer_map[k];if(!w)return null;w.setVisible(i);return w.getGroup()};svgedit.draw.Drawing.prototype.getLayerOpacity=function(k){k=
this.layer_map[k];if(!k)return null;return k.getOpacity()};svgedit.draw.Drawing.prototype.setLayerOpacity=function(k,i){if(!(typeof i!=="number"||i<0||i>1)){var w=this.layer_map[k];w&&w.setOpacity(i)}};svgedit.draw.Drawing.prototype.copyElem=function(k){var i=this;return svgedit.utilities.copyElem(k,function(){return i.getNextId()})}})();(function(){function g(j){var c=j.getAttribute("class");if(c===null||c===undefined||c.length===0)j.setAttribute("class",q.CLASS_NAME);else q.CLASS_REGEX.test(c)||j.setAttribute("class",c+" "+q.CLASS_NAME)}if(!svgedit.draw)svgedit.draw={};var s=svgedit.NS,q=svgedit.draw.Layer=function(j,c,k){this.name_=j;this.group_=k?null:c;if(k){var i=k.ownerDocument;this.group_=i.createElementNS(s.SVG,"g");i=i.createElementNS(s.SVG,"title");i.textContent=j;this.group_.appendChild(i);c?$(c).after(this.group_):k.appendChild(this.group_)}g(this.group_);
svgedit.utilities.walkTree(this.group_,function(w){w.setAttribute("style","pointer-events:inherit")});this.group_.setAttribute("style",k?"pointer-events:all":"pointer-events:none")};q.CLASS_NAME="layer";q.CLASS_REGEX=RegExp("(\\s|^)"+q.CLASS_NAME+"(\\s|$)");q.prototype.getName=function(){return this.name_};q.prototype.getGroup=function(){return this.group_};q.prototype.activate=function(){this.group_.setAttribute("style","pointer-events:all")};q.prototype.deactivate=function(){this.group_.setAttribute("style",
"pointer-events:none")};q.prototype.setVisible=function(j){j=j===undefined||j?"inline":"none";this.group_.getAttribute("display")!==j&&this.group_.setAttribute("display",j)};q.prototype.isVisible=function(){return this.group_.getAttribute("display")!=="none"};q.prototype.getOpacity=function(){var j=this.group_.getAttribute("opacity");if(j===null||j===undefined)return 1;return parseFloat(j)};q.prototype.setOpacity=function(j){typeof j==="number"&&j>=0&&j<=1&&this.group_.setAttribute("opacity",j)};
q.prototype.appendChildren=function(j){for(var c=0;c<j.length;++c)this.group_.appendChild(j[c])};q.prototype.getTitleElement=function(){for(var j=this.group_.childNodes.length,c=0;c<j;++c){var k=this.group_.childNodes.item(c);if(k&&k.tagName==="title")return k}return null};q.prototype.setName=function(j,c){var k=this.name_;j=svgedit.utilities.toXml(j);var i=this.getTitleElement();if(i){for(;i.firstChild;)i.removeChild(i.firstChild);this.name_=i.textContent=j;c&&c.changeElement(i,{"#text":k});return this.name_}return null};
q.prototype.removeGroup=function(){var j=this.group_.parentNode.removeChild(this.group_);this.group_=undefined;return j}})();(function(){if(!svgedit.path)svgedit.path={};var g=svgedit.NS,s={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},q={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},j=[],c=true,k={};svgedit.path.setLinkControlPoints=function(f){c=f};var i=svgedit.path.path=null;
svgedit.path.init=function(f){i=f;j=[0,"ClosePath"];$.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(e,m){j.push(m+"Abs");j.push(m+"Rel")})};svgedit.path.insertItemBefore=function(f,e,m){f=f.pathSegList;if(svgedit.browser.supportsPathInsertItemBefore())f.insertItemBefore(e,m);else{var r=f.numberOfItems,v=[],t;for(t=0;t<r;t++){var O=f.getItem(t);v.push(O)}f.clear();for(t=0;t<r;t++){t==m&&f.appendItem(e);
f.appendItem(v[t])}}};svgedit.path.ptObjToArr=function(f,e){var m=q[f],r=m.length,v,t=[];for(v=0;v<r;v++)t[v]=e[m[v]];return t};svgedit.path.getGripPt=function(f,e){var m={x:e?e.x:f.item.x,y:e?e.y:f.item.y},r=f.path;if(r.matrix)m=svgedit.math.transformPoint(m.x,m.y,r.matrix);m.x*=i.getCurrentZoom();m.y*=i.getCurrentZoom();return m};svgedit.path.getPointFromGrip=function(f,e){var m={x:f.x,y:f.y};if(e.matrix){f=svgedit.math.transformPoint(m.x,m.y,e.imatrix);m.x=f.x;m.y=f.y}m.x/=i.getCurrentZoom();m.y/=
i.getCurrentZoom();return m};svgedit.path.addPointGrip=function(f,e,m){var r=svgedit.path.getGripContainer(),v=svgedit.utilities.getElem("pathpointgrip_"+f);if(!v){v=document.createElementNS(g.SVG,"circle");svgedit.utilities.assignAttributes(v,{id:"pathpointgrip_"+f,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":s.pathNodeTooltip});v=r.appendChild(v);$("#pathpointgrip_"+f).dblclick(function(){svgedit.path.path&&svgedit.path.path.setSegType()})}e&&
m&&svgedit.utilities.assignAttributes(v,{cx:e,cy:m,display:"inline"});return v};svgedit.path.getGripContainer=function(){var f=svgedit.utilities.getElem("pathpointgrip_container");if(!f){f=svgedit.utilities.getElem("selectorParentGroup").appendChild(document.createElementNS(g.SVG,"g"));f.id="pathpointgrip_container"}return f};svgedit.path.addCtrlGrip=function(f){var e=svgedit.utilities.getElem("ctrlpointgrip_"+f);if(e)return e;e=document.createElementNS(g.SVG,"circle");svgedit.utilities.assignAttributes(e,
{id:"ctrlpointgrip_"+f,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":s.pathCtrlPtTooltip});svgedit.path.getGripContainer().appendChild(e);return e};svgedit.path.getCtrlLine=function(f){var e=svgedit.utilities.getElem("ctrlLine_"+f);if(e)return e;e=document.createElementNS(g.SVG,"line");svgedit.utilities.assignAttributes(e,{id:"ctrlLine_"+f,stroke:"#555","stroke-width":1,style:"pointer-events:none"});svgedit.path.getGripContainer().appendChild(e);
return e};svgedit.path.getPointGrip=function(f,e){var m=svgedit.path.addPointGrip(f.index);if(e){var r=svgedit.path.getGripPt(f);svgedit.utilities.assignAttributes(m,{cx:r.x,cy:r.y,display:"inline"})}return m};svgedit.path.getControlPoints=function(f){var e=f.item,m=f.index;if(!("x1"in e)||!("x2"in e))return null;var r={};svgedit.path.getGripContainer();var v=[svgedit.path.path.segs[m-1].item,e],t;for(t=1;t<3;t++){var O=m+"c"+t,Q=r["c"+t+"_line"]=svgedit.path.getCtrlLine(O),L=svgedit.path.getGripPt(f,
{x:e["x"+t],y:e["y"+t]}),N=svgedit.path.getGripPt(f,{x:v[t-1].x,y:v[t-1].y});svgedit.utilities.assignAttributes(Q,{x1:L.x,y1:L.y,x2:N.x,y2:N.y,display:"inline"});r["c"+t+"_line"]=Q;O=r["c"+t]=svgedit.path.addCtrlGrip(O);svgedit.utilities.assignAttributes(O,{cx:L.x,cy:L.y,display:"inline"});r["c"+t]=O}return r};svgedit.path.replacePathSeg=function(f,e,m,r){r=r||svgedit.path.path.elem;f=r["createSVGPathSeg"+j[f]].apply(r,m);if(svgedit.browser.supportsPathReplaceItem())r.pathSegList.replaceItem(f,e);
else{m=r.pathSegList;r=m.numberOfItems;var v=[],t;for(t=0;t<r;t++){var O=m.getItem(t);v.push(O)}m.clear();for(t=0;t<r;t++)t==e?m.appendItem(f):m.appendItem(v[t])}};svgedit.path.getSegSelector=function(f,e){var m=f.index,r=svgedit.utilities.getElem("segline_"+m);if(!r){var v=svgedit.path.getGripContainer();r=document.createElementNS(g.SVG,"path");svgedit.utilities.assignAttributes(r,{id:"segline_"+m,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"});
v.appendChild(r)}if(e){m=f.prev;if(!m){r.setAttribute("display","none");return r}m=svgedit.path.getGripPt(m);svgedit.path.replacePathSeg(2,0,[m.x,m.y],r);v=svgedit.path.ptObjToArr(f.type,f.item,true);var t;for(t=0;t<v.length;t+=2){m=svgedit.path.getGripPt(f,{x:v[t],y:v[t+1]});v[t]=m.x;v[t+1]=m.y}svgedit.path.replacePathSeg(f.type,1,v,r)}return r};svgedit.path.smoothControlPoints=function(f,e,m){var r=f.x-m.x,v=f.y-m.y,t=e.x-m.x,O=e.y-m.y;if((r!=0||v!=0)&&(t!=0||O!=0)){f=Math.atan2(v,r);e=Math.atan2(O,
t);r=Math.sqrt(r*r+v*v);t=Math.sqrt(t*t+O*O);v=i.getSVGRoot().createSVGPoint();O=i.getSVGRoot().createSVGPoint();if(f<0)f+=2*Math.PI;if(e<0)e+=2*Math.PI;var Q=Math.abs(f-e),L=Math.abs(Math.PI-Q)/2;if(f-e>0){f=Q<Math.PI?f+L:f-L;e=Q<Math.PI?e-L:e+L}else{f=Q<Math.PI?f-L:f+L;e=Q<Math.PI?e+L:e-L}v.x=r*Math.cos(f)+m.x;v.y=r*Math.sin(f)+m.y;O.x=t*Math.cos(e)+m.x;O.y=t*Math.sin(e)+m.y;return[v,O]}};svgedit.path.Segment=function(f,e){this.selected=false;this.index=f;this.item=e;this.type=e.pathSegType;this.ctrlpts=
[];this.segsel=this.ptgrip=null};svgedit.path.Segment.prototype.showCtrlPts=function(f){for(var e in this.ctrlpts)if(this.ctrlpts.hasOwnProperty(e))this.ctrlpts[e].setAttribute("display",f?"inline":"none")};svgedit.path.Segment.prototype.selectCtrls=function(f){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",f?"#0FF":"#EEE")};svgedit.path.Segment.prototype.show=function(f){if(this.ptgrip){this.ptgrip.setAttribute("display",f?"inline":"none");this.segsel.setAttribute("display",
f?"inline":"none");this.showCtrlPts(f)}};svgedit.path.Segment.prototype.select=function(f){if(this.ptgrip){this.ptgrip.setAttribute("stroke",f?"#0FF":"#00F");this.segsel.setAttribute("display",f?"inline":"none");this.ctrlpts&&this.selectCtrls(f);this.selected=f}};svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,true);this.ctrlpts=svgedit.path.getControlPoints(this,true);this.segsel=svgedit.path.getSegSelector(this,true)};svgedit.path.Segment.prototype.update=
function(f){if(this.ptgrip){var e=svgedit.path.getGripPt(this);svgedit.utilities.assignAttributes(this.ptgrip,{cx:e.x,cy:e.y});svgedit.path.getSegSelector(this,true);if(this.ctrlpts){if(f){this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.type=this.item.pathSegType}svgedit.path.getControlPoints(this)}}};svgedit.path.Segment.prototype.move=function(f,e){var m;m=this.item;m=this.ctrlpts?[m.x+=f,m.y+=e,m.x1,m.y1,m.x2+=f,m.y2+=e]:[m.x+=f,m.y+=e];svgedit.path.replacePathSeg(this.type,
this.index,m);if(this.next&&this.next.ctrlpts){m=this.next.item;m=[m.x,m.y,m.x1+=f,m.y1+=e,m.x2,m.y2];svgedit.path.replacePathSeg(this.next.type,this.next.index,m)}if(this.mate){m=this.mate.item;m=[m.x+=f,m.y+=e];svgedit.path.replacePathSeg(this.mate.type,this.mate.index,m)}this.update(true);this.next&&this.next.update(true)};svgedit.path.Segment.prototype.setLinked=function(f){var e,m,r;if(f==2){m=1;e=this.next;if(!e)return;r=this.item}else{m=2;e=this.prev;if(!e)return;r=e.item}var v=e.item;v["x"+
m]=r.x+(r.x-this.item["x"+f]);v["y"+m]=r.y+(r.y-this.item["y"+f]);svgedit.path.replacePathSeg(e.type,e.index,[v.x,v.y,v.x1,v.y1,v.x2,v.y2]);e.update(true)};svgedit.path.Segment.prototype.moveCtrl=function(f,e,m){var r=this.item;r["x"+f]+=e;r["y"+f]+=m;svgedit.path.replacePathSeg(this.type,this.index,[r.x,r.y,r.x1,r.y1,r.x2,r.y2]);this.update(true)};svgedit.path.Segment.prototype.setType=function(f,e){svgedit.path.replacePathSeg(f,this.index,e);this.type=f;this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);
this.showCtrlPts(f===6);this.ctrlpts=svgedit.path.getControlPoints(this);this.update(true)};svgedit.path.Path=function(f){if(!f||f.tagName!=="path")throw"svgedit.path.Path constructed without a <path> element";this.elem=f;this.segs=[];this.selected_pts=[];svgedit.path.path=this;this.init()};svgedit.path.Path.prototype.init=function(){$(svgedit.path.getGripContainer()).find("*").each(function(){$(this).attr("display","none")});var f=this.elem.pathSegList,e=f.numberOfItems;this.segs=[];this.selected_pts=
[];this.first_seg=null;var m;for(m=0;m<e;m++){var r=f.getItem(m);r=new svgedit.path.Segment(m,r);r.path=this;this.segs.push(r)}f=this.segs;r=null;for(m=0;m<e;m++){var v=f[m],t=m+1>=e?null:f[m+1],O=m-1<0?null:f[m-1];if(v.type===2){if(O&&O.type!==1){t=f[r];t.next=f[r+1];t.next.prev=t;t.addGrip()}r=m}else if(t&&t.type===1){v.next=f[r+1];v.next.prev=v;v.mate=f[r];v.addGrip();if(this.first_seg==null)this.first_seg=v}else if(t){if(v.type!==1){v.addGrip();if(t&&t.type!==2){v.next=t;v.next.prev=v}}}else if(v.type!==
1){t=f[r];t.next=f[r+1];t.next.prev=t;t.addGrip();v.addGrip();if(!this.first_seg)this.first_seg=f[r]}}return this};svgedit.path.Path.prototype.eachSeg=function(f){var e,m=this.segs.length;for(e=0;e<m;e++)if(f.call(this.segs[e],e)===false)break};svgedit.path.Path.prototype.addSeg=function(f){var e=this.segs[f];if(e.prev){var m=e.prev,r,v,t;switch(e.item.pathSegType){case 4:v=(e.item.x+m.item.x)/2;t=(e.item.y+m.item.y)/2;r=this.elem.createSVGPathSegLinetoAbs(v,t);break;case 6:r=(m.item.x+e.item.x1)/
2;var O=(e.item.x1+e.item.x2)/2,Q=(e.item.x2+e.item.x)/2,L=(r+O)/2;O=(O+Q)/2;v=(L+O)/2;var N=(m.item.y+e.item.y1)/2,T=(e.item.y1+e.item.y2)/2;m=(e.item.y2+e.item.y)/2;var ga=(N+T)/2;T=(T+m)/2;t=(ga+T)/2;r=this.elem.createSVGPathSegCurvetoCubicAbs(v,t,r,N,L,ga);svgedit.path.replacePathSeg(e.type,f,[e.item.x,e.item.y,O,T,Q,m])}svgedit.path.insertItemBefore(this.elem,r,f)}};svgedit.path.Path.prototype.deleteSeg=function(f){var e=this.segs[f],m=this.elem.pathSegList;e.show(false);var r=e.next,v;if(e.mate){v=
[r.item.x,r.item.y];svgedit.path.replacePathSeg(2,r.index,v);svgedit.path.replacePathSeg(4,e.index,v);m.removeItem(e.mate.index)}else{if(!e.prev){v=[r.item.x,r.item.y];svgedit.path.replacePathSeg(2,e.next.index,v)}m.removeItem(f)}};svgedit.path.Path.prototype.subpathIsClosed=function(f){var e=false;svgedit.path.path.eachSeg(function(m){if(m<=f)return true;if(this.type===2)return false;if(this.type===1){e=true;return false}});return e};svgedit.path.Path.prototype.removePtFromSelection=function(f){var e=
this.selected_pts.indexOf(f);if(e!=-1){this.segs[f].select(false);this.selected_pts.splice(e,1)}};svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(false)});this.selected_pts=[]};svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")};svgedit.path.Path.prototype.show=function(f){this.eachSeg(function(){this.show(f)});f&&this.selectPt(this.first_seg.index);return this};svgedit.path.Path.prototype.movePts=function(f,e){for(var m=
this.selected_pts.length;m--;)this.segs[this.selected_pts[m]].move(f,e)};svgedit.path.Path.prototype.moveCtrl=function(f,e){var m=this.segs[this.selected_pts[0]];m.moveCtrl(this.dragctrl,f,e);c&&m.setLinked(this.dragctrl)};svgedit.path.Path.prototype.setSegType=function(f){this.storeD();for(var e=this.selected_pts.length,m;e--;){var r=this.segs[this.selected_pts[e]],v=r.prev;if(v){if(!f){m="Toggle Path Segment Type";f=r.type==6?4:6}f=Number(f);var t=r.item.x,O=r.item.y,Q=v.item.x;v=v.item.y;var L;
switch(f){case 6:if(r.olditem){Q=r.olditem;L=[t,O,Q.x1,Q.y1,Q.x2,Q.y2]}else{L=t-Q;var N=O-v;L=[t,O,Q+L/3,v+N/3,t-L/3,O-N/3]}break;case 4:L=[t,O];r.olditem=r.item}r.setType(f,L)}}svgedit.path.path.endChanges(m)};svgedit.path.Path.prototype.selectPt=function(f,e){this.clearSelection();f==null&&this.eachSeg(function(m){if(this.prev)f=m});this.addPtsToSelection(f);if(e){this.dragctrl=e;c&&this.segs[f].setLinked(e)}};svgedit.path.Path.prototype.update=function(){var f=this.elem;if(svgedit.utilities.getRotationAngle(f)){this.matrix=
svgedit.math.getMatrix(f);this.imatrix=this.matrix.inverse()}else this.imatrix=this.matrix=null;this.eachSeg(function(e){this.item=f.pathSegList.getItem(e);this.update()});return this};svgedit.path.getPath_=function(f){var e=k[f.id];e||(e=k[f.id]=new svgedit.path.Path(f));return e};svgedit.path.removePath_=function(f){f in k&&delete k[f]};var w,u,K,B,d,n=function(f,e){var m=f-K,r=e-B,v=Math.sqrt(m*m+r*r);r=Math.atan2(r,m)+d;m=v*Math.cos(r)+K;r=v*Math.sin(r)+B;m-=w;r-=u;v=Math.sqrt(m*m+r*r);r=Math.atan2(r,
m)-d;return{x:v*Math.cos(r)+w,y:v*Math.sin(r)+u}};svgedit.path.recalcRotatedPath=function(){var f=svgedit.path.path.elem;if(d=svgedit.utilities.getRotationAngle(f,true)){var e=svgedit.utilities.getBBox(f),m=svgedit.path.path.oldbbox;K=m.x+m.width/2;B=m.y+m.height/2;w=e.x+e.width/2;u=e.y+e.height/2;m=w-K;var r=u-B;e=Math.sqrt(m*m+r*r);m=Math.atan2(r,m)+d;w=e*Math.cos(m)+K;u=e*Math.sin(m)+B;e=f.pathSegList;for(m=e.numberOfItems;m;){m-=1;var v=e.getItem(m);r=v.pathSegType;if(r!=1){var t=n(v.x,v.y);t=
[t.x,t.y];if(v.x1!=null&&v.x2!=null){var O=n(v.x1,v.y1);v=n(v.x2,v.y2);t.splice(t.length,0,O.x,O.y,v.x,v.y)}svgedit.path.replacePathSeg(r,m,t)}}svgedit.utilities.getBBox(f);e=svgroot.createSVGTransform();f=svgedit.transformlist.getTransformList(f);e.setRotate(d*180/Math.PI,w,u);f.replaceItem(e,0)}};svgedit.path.clearData=function(){k={}}})();(function(){if(!window.console){window.console={};window.console.log=function(){};window.console.dir=function(){}}if(window.opera){window.console.log=function(g){opera.postError(g)};window.console.dir=function(){}}})();
$.SvgCanvas=function(g,s){function q(a){return a?a:new svgedit.history.HistoryRecordingService(u.undoMgr)}function j(){ha();var a=[],h={feGaussianBlur:Ma.exportNoBlur,foreignObject:Ma.exportNoforeignObject,"[stroke-dasharray]":Ma.exportNoDashArray},b=$(d);if(!("font"in $("<canvas>")[0].getContext("2d")))h.text=Ma.exportNoText;$.each(h,function(p,o){b.find(p).length&&a.push(o)});return a}function c(a,h){var b,p=svgedit.utilities.getBBox(a);for(b=0;b<2;b++){var o=b===0?"fill":"stroke",C=a.getAttribute(o);
if(C&&C.indexOf("url(")===0){C=svgedit.utilities.getRefElem(C);if(C.tagName==="linearGradient"){var l=C.getAttribute("x1")||0,z=C.getAttribute("y1")||0,A=C.getAttribute("x2")||1,E=C.getAttribute("y2")||0;l=p.width*l+p.x;z=p.height*z+p.y;A=p.width*A+p.x;E=p.height*E+p.y;l=svgedit.math.transformPoint(l,z,h);E=svgedit.math.transformPoint(A,E,h);A={};A.x1=(l.x-p.x)/p.width;A.y1=(l.y-p.y)/p.height;A.x2=(E.x-p.x)/p.width;A.y2=(E.y-p.y)/p.height;C=C.cloneNode(true);$(C).attr(A);C.id=na();svgedit.utilities.findDefs().appendChild(C);
a.setAttribute(o,"url(#"+C.id+")")}}}}var k=svgedit.NS,i={show_outside_canvas:true,selectNew:true,dimensions:[640,480]};s&&$.extend(i,s);var w=i.dimensions,u=this,K=g.ownerDocument,B=K.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+k.SVG+'" xlinkns="'+k.XLINK+'" width="'+w[0]+'" height="'+w[1]+'" x="'+w[0]+'" y="'+w[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,
true);g.appendChild(B);var d=K.createElementNS(k.SVG,"svg");(u.clearSvgContentElement=function(){for(;d.firstChild;)d.removeChild(d.firstChild);$(d).attr({id:"svgcontent",width:w[0],height:w[1],x:w[0],y:w[1],overflow:i.show_outside_canvas?"visible":"hidden",xmlns:k.SVG,"xmlns:se":k.SE,"xmlns:xlink":k.XLINK}).appendTo(B);var a=K.createComment(" Created with SVG-edit - https://github.com/SVG-Edit/svgedit");d.appendChild(a)})();var n="svg_";u.setIdPrefix=function(a){n=a};u.current_drawing_=new svgedit.draw.Drawing(d,
n);var f=u.getCurrentDrawing=function(){return u.current_drawing_},e=1,m=null,r={shape:{fill:(i.initFill.color=="none"?"":"#")+i.initFill.color,fill_paint:null,fill_opacity:i.initFill.opacity,stroke:"#"+i.initStroke.color,stroke_paint:null,stroke_opacity:i.initStroke.opacity,stroke_width:i.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:i.initOpacity}};r.text=$.extend(true,{},r.shape);$.extend(r.text,{fill:"#000000",stroke_width:i.text.stroke_width,font_size:i.text.font_size,
font_family:i.text.font_family});var v=r.shape,t=[],O=this.addSvgElementFromJson=function(a){if(typeof a=="string")return K.createTextNode(a);var h=svgedit.utilities.getElem(a.attr.id),b=f().getCurrentLayer();if(h&&a.element!=h.tagName){b.removeChild(h);h=null}if(!h){h=K.createElementNS(k.SVG,a.element);if(b)(m||b).appendChild(h)}a.curStyles&&svgedit.utilities.assignAttributes(h,{fill:v.fill,stroke:v.stroke,"stroke-width":v.stroke_width,"stroke-dasharray":v.stroke_dasharray,"stroke-linejoin":v.stroke_linejoin,
"stroke-linecap":v.stroke_linecap,"stroke-opacity":v.stroke_opacity,"fill-opacity":v.fill_opacity,opacity:v.opacity/2,style:"pointer-events:inherit"},100);svgedit.utilities.assignAttributes(h,a.attr,100);svgedit.utilities.cleanupElement(h);a.children&&a.children.forEach(function(p){h.appendChild(O(p))});return h};u.getTransformList=svgedit.transformlist.getTransformList;var Q=svgedit.math.transformPoint,L=u.matrixMultiply=svgedit.math.matrixMultiply,N=u.hasMatrixTransform=svgedit.math.hasMatrixTransform,
T=u.transformListToTransform=svgedit.math.transformListToTransform;svgedit.units.init({getBaseUnit:function(){return i.baseUnit},getElement:svgedit.utilities.getElem,getHeight:function(){return d.getAttribute("height")/e},getWidth:function(){return d.getAttribute("width")/e},getRoundDigits:function(){return Fa.round_digits}});u.convertToNum=svgedit.units.convertToNum;svgedit.utilities.init({getDOMDocument:function(){return K},getDOMContainer:function(){return g},getSVGRoot:function(){return B},getSelectedElements:function(){return t},
getSVGContent:function(){return d},getBaseUnit:function(){return i.baseUnit},getSnappingStep:function(){return i.snappingStep}});var ga=u.findDefs=svgedit.utilities.findDefs,ba=u.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,pa=u.getHref=svgedit.utilities.getHref,ta=u.setHref=svgedit.utilities.setHref,qa=svgedit.utilities.getPathBBox;u.getBBox=svgedit.utilities.getBBox;u.getRotationAngle=svgedit.utilities.getRotationAngle;var Ca=u.getElem=svgedit.utilities.getElem;u.getRefElem=svgedit.utilities.getRefElem;
var La=u.assignAttributes=svgedit.utilities.assignAttributes,nb=this.cleanupElement=svgedit.utilities.cleanupElement;svgedit.coords.init({getDrawing:function(){return f()},getGridSnapping:function(){return i.gridSnapping}});var xb=this.remapElement=svgedit.coords.remapElement;svgedit.recalculate.init({getSVGRoot:function(){return B},getStartTransform:function(){return Ra},setStartTransform:function(a){Ra=a}});var yb=this.recalculateDimensions=svgedit.recalculate.recalculateDimensions,ya=svgedit.getReverseNS(),
zb=u.sanitizeSvg=svgedit.sanitize.sanitizeSvg,ob=svgedit.history.MoveElementCommand,$a=svgedit.history.InsertElementCommand,Sa=svgedit.history.RemoveElementCommand,pb=svgedit.history.ChangeElementCommand,Ab=svgedit.history.BatchCommand,Y;u.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(a,h){var b=svgedit.history.HistoryEventTypes;if(a==b.BEFORE_UNAPPLY||a==b.BEFORE_APPLY)u.clearSelection();else if(a==b.AFTER_APPLY||a==b.AFTER_UNAPPLY){var p=h.elements();u.pathActions.clear();
Y("changed",p);p=h.type();b=a==b.AFTER_APPLY;if(p==ob.type())(b?h.newParent:h.oldParent)==d&&u.identifyLayers();else if(p==$a.type()||p==Sa.type()){h.parent==d&&u.identifyLayers();if(p==$a.type())b&&Ta(h.elem);else b||Ta(h.elem);h.elem.tagName==="use"&&ab(h.elem)}else if(p==pb.type()){h.elem.tagName=="title"&&h.elem.parentNode.parentNode==d&&u.identifyLayers();b=b?h.newValues:h.oldValues;b.stdDeviation&&u.setBlurOffsets(h.elem.parentNode,b.stdDeviation)}}}});var da=function(a){u.undoMgr.addCommandToHistory(a)};
svgedit.select.init(i,{createSVGElement:function(a){return u.addSvgElementFromJson(a)},svgRoot:function(){return B},svgContent:function(){return d},currentZoom:function(){return e},getStrokedBBox:function(a){return u.getStrokedBBox([a])}});var ea=this.selectorManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return e},getSVGRoot:function(){return B}});var Ma={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",
exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},qb=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],Ua=$.data,bb=document.createElementNS(k.SVG,"animate");$(bb).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(B);var Ta=function(a){var h,b=$(a).attr(qb);for(h in b){var p=b[h];if(p&&p.indexOf("url(")===0){p=svgedit.utilities.getUrlFromAttr(p).substr(1);if(!Ca(p)){svgedit.utilities.findDefs().appendChild(cb[p]);
delete cb[p]}}}b=a.getElementsByTagName("*");if(b.length){a=0;for(h=b.length;a<h;a++)Ta(b[a])}},Va={},db=i.imgPath+"logo.png",Wa=[],Fa={round_digits:5},ma=false,Ra=null,fa="select",za="none",Na={},ua=r.text,ra=v,eb=null,ia=null,Ga=[],fb={},gb=null,cb={};u.clipBoard=[];var Ja=this.runExtensions=function(a,h,b){var p=b?[]:false;$.each(fb,function(o,C){if(C&&a in C)if(b)p.push(C[a](h));else p=C[a](h)});return p};this.addExtension=function(a,h){var b;if(a in fb)console.log('Cannot add extension "'+a+
'", an extension by that name already exists.');else{b=$.isFunction(h)?h($.extend(u.getPrivateMethods(),{svgroot:B,svgcontent:d,nonce:f().getNonce(),selectorManager:ea})):h;fb[a]=b;Y("extension_added",b)}};var Oa=this.round=function(a){return parseInt(a*e,10)/e},hb=this.getIntersectionList=function(a){if(ia==null)return null;var h=m||f().getCurrentLayer(),b;if(a){b=d.createSVGRect();b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height}else{b=ia.getBBox();var p;a=d.createSVGRect();for(p in b)a[p]=b[p]/
e;b=a}p=null;if(!svgedit.browser.isIE)if(typeof B.getIntersectionList=="function"){b.x+=parseInt(d.getAttribute("x"),10);b.y+=parseInt(d.getAttribute("y"),10);p=B.getIntersectionList(b,h)}if(p==null||typeof p.item!="function"){p=[];Ga.length||(Ga=Bb(h));for(h=Ga.length;h--;)b.width&&svgedit.math.rectsIntersect(b,Ga[h].bbox)&&p.push(Ga[h].elem)}return p},wa=this.getStrokedBBox=function(a){a||(a=Xa());return svgedit.utilities.getStrokedBBox(a,O,ca)},Xa=this.getVisibleElements=function(a){a||(a=$(d).children());
var h=[];$(a).children().each(function(b,p){p.getBBox&&h.push(p)});return h.reverse()},Bb=this.getVisibleElementsAndBBoxes=function(a){a||(a=$(d).children());var h=[];$(a).children().each(function(b,p){p.getBBox&&h.push({elem:p,bbox:wa([p])})});return h.reverse()},rb=this.groupSvgElem=function(a){var h=document.createElementNS(k.SVG,"g");a.parentNode.replaceChild(h,a);$(h).append(a).data("gsvg",a)[0].id=na()},va,na,oa,ca;(function(a){var h={};va=a.getId=function(){return f().getId()};na=a.getNextId=
function(){return f().getNextId()};Y=a.call=function(b,p){if(h[b])return h[b](this,p)};a.bind=function(b,p){var o=h[b];h[b]=p;return o}})(u);this.prepareSvg=function(a){this.sanitizeSvg(a.documentElement);var h,b,p=a.getElementsByTagNameNS(k.SVG,"path");a=0;for(b=p.length;a<b;++a){h=p[a];h.setAttribute("d",ca.convertPath(h));ca.fixEnd(h)}};var ib=function(a){if(!svgedit.browser.isGecko())return a;var h=a.cloneNode(true);a.parentNode.insertBefore(h,a);a.parentNode.removeChild(a);ea.releaseSelector(a);
t[0]=h;ea.requestSelector(h).showGrips(true);return h};this.setRotationAngle=function(a,h){a=parseFloat(a);var b=t[0],p=b.getAttribute("transform"),o=svgedit.utilities.getBBox(b),C=o.x+o.width/2,l=o.y+o.height/2;o=svgedit.transformlist.getTransformList(b);o.numberOfItems>0&&o.getItem(0).type==4&&o.removeItem(0);if(a!=0){C=svgedit.math.transformPoint(C,l,svgedit.math.transformListToTransform(o).matrix);l=B.createSVGTransform();l.setRotate(a,C.x,C.y);o.numberOfItems?o.insertItemBefore(l,0):o.appendItem(l)}else o.numberOfItems==
0&&b.removeAttribute("transform");if(!h){o=b.getAttribute("transform");b.setAttribute("transform",p);sa("transform",o,t);Y("changed",t)}svgedit.utilities.getElem("pathpointgrip_container");b=ea.requestSelector(t[0]);b.resize();b.updateGripCursors(a)};var jb=this.recalculateAllSelectedDimensions=function(){for(var a=new svgedit.history.BatchCommand(za=="none"?"position":"size"),h=t.length;h--;){var b=svgedit.recalculate.recalculateDimensions(t[h]);b&&a.addSubCommand(b)}if(!a.isEmpty()){da(a);Y("changed",
t)}},Cb=function(a){console.log([a.a,a.b,a.c,a.d,a.e,a.f])},Da=null,ha=this.clearSelection=function(a){if(t[0]!=null){var h,b,p=t.length;for(h=0;h<p;++h){b=t[h];if(b==null)break;ea.releaseSelector(b);t[h]=null}}a||Y("selected",t)},xa=this.addToSelection=function(a,h){if(a.length!=0){for(var b=0;b<t.length;){if(t[b]==null)break;++b}for(var p=a.length;p--;){var o=a[p];if(o){var C=svgedit.utilities.getBBox(o);if(C){if(o.tagName==="a"&&o.childNodes.length===1)o=o.firstChild;if(t.indexOf(o)==-1){t[b]=
o;b++;o=ea.requestSelector(o,C);t.length>1&&o.showGrips(false)}}}}Y("selected",t);h||t.length==1?ea.requestSelector(t[0]).showGrips(true):ea.requestSelector(t[0]).showGrips(false);for(t.sort(function(l,z){if(l&&z&&l.compareDocumentPosition)return 3-(z.compareDocumentPosition(l)&6);if(l==null)return 1});t[0]==null;)t.shift(0)}},Aa=this.selectOnly=function(a,h){ha(true);xa(a,h)};this.removeFromSelection=function(a){if(t[0]!=null)if(a.length!=0){var h,b=0,p=[],o=t.length;p.length=o;for(h=0;h<o;++h){var C=
t[h];if(C)if(a.indexOf(C)==-1){p[b]=C;b++}else ea.releaseSelector(C)}t=p}};this.selectAllInCurrentLayer=function(){var a=f().getCurrentLayer();if(a){fa="select";Aa($(m||a).children())}};var Ya=this.getMouseTarget=function(a){if(a==null)return null;a=a.target;if(a.correspondingUseElement)a=a.correspondingUseElement;if([k.MATH,k.HTML].indexOf(a.namespaceURI)>=0&&a.id!="svgcanvas")for(;a.nodeName!="foreignObject";){a=a.parentNode;if(!a)return B}var h=f().getCurrentLayer();if([B,g,d,h].indexOf(a)>=0)return B;
if($(a).closest("#selectorParentGroup").length)return ea.selectorParentGroup;for(;a.parentNode!==(m||h);)a=a.parentNode;return a};(function(){var a=null,h=null,b=null,p=null,o=null,C={},l={minx:null,miny:null,maxx:null,maxy:null},z=0,A={x:0,y:0},E={x:0,y:0},F={x:0,y:0},J={x:0,y:0},P,R,V={x:0,y:0},W={x:0,y:0},Z=function(M){var H={x:0,y:0},D=A,G=E,I=F,S=J,X=1/6,aa=M*M,la=aa*M,U=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];H.x=X*((D.x*U[0][0]+G.x*U[0][1]+I.x*U[0][2]+S.x*U[0][3])*la+(D.x*U[1][0]+G.x*
U[1][1]+I.x*U[1][2]+S.x*U[1][3])*aa+(D.x*U[2][0]+G.x*U[2][1]+I.x*U[2][2]+S.x*U[2][3])*M+(D.x*U[3][0]+G.x*U[3][1]+I.x*U[3][2]+S.x*U[3][3]));H.y=X*((D.y*U[0][0]+G.y*U[0][1]+I.y*U[0][2]+S.y*U[0][3])*la+(D.y*U[1][0]+G.y*U[1][1]+I.y*U[1][2]+S.y*U[1][3])*aa+(D.y*U[2][0]+G.y*U[2][1]+I.y*U[2][2]+S.y*U[2][3])*M+(D.y*U[3][0]+G.y*U[3][1]+I.y*U[3][2]+S.y*U[3][3]));return{x:H.x,y:H.y}};$(g).mousedown(function(M){if(!(u.spaceKey||M.button===1)){var H=M.button===2;M.altKey&&svgCanvas.cloneSelectedElements(0,0);
Da=$("#svgcontent g")[0].getScreenCTM().inverse();var D=svgedit.math.transformPoint(M.pageX,M.pageY,Da),G=D.x*e,I=D.y*e;M.preventDefault();if(H){fa="select";gb=D}D=G/e;I=I/e;var S=Ya(M);if(S.tagName==="a"&&S.childNodes.length===1)S=S.firstChild;p=h=G=D;var X=I;o=b=I;if(i.gridSnapping){D=svgedit.utilities.snapToGrid(D);I=svgedit.utilities.snapToGrid(I);h=svgedit.utilities.snapToGrid(h);b=svgedit.utilities.snapToGrid(b)}if(S==ea.selectorParentGroup&&t[0]!=null){S=M.target;var aa=Ua(S,"type");if(aa==
"rotate")fa="rotate";else if(aa=="resize"){fa="resize";za=Ua(S,"dir")}S=t[0]}Ra=S.getAttribute("transform");var la;aa=svgedit.transformlist.getTransformList(S);switch(fa){case "select":ma=true;za="none";if(H)ma=false;if(S!=B){if(t.indexOf(S)==-1){M.shiftKey||ha(true);xa([S]);eb=S;ca.clear()}if(!H)for(H=0;H<t.length;++H)if(t[H]!=null){la=svgedit.transformlist.getTransformList(t[H]);la.numberOfItems?la.insertItemBefore(B.createSVGTransform(),0):la.appendItem(B.createSVGTransform())}}else if(!H){ha();
fa="multiselect";if(ia==null)ia=ea.getRubberBandBox();p*=e;o*=e;svgedit.utilities.assignAttributes(ia,{x:p,y:o,width:0,height:0,display:"inline"},100)}break;case "zoom":ma=true;if(ia==null)ia=ea.getRubberBandBox();svgedit.utilities.assignAttributes(ia,{x:G*e,y:G*e,width:0,height:0,display:"inline"},100);break;case "resize":ma=true;h=D;b=I;C=svgedit.utilities.getBBox($("#selectedBox0")[0]);var U={};$.each(C,function(ja,ka){U[ja]=ka/e});C=U;H=svgedit.utilities.getRotationAngle(S)?1:0;if(svgedit.math.hasMatrixTransform(aa)){aa.insertItemBefore(B.createSVGTransform(),
H);aa.insertItemBefore(B.createSVGTransform(),H);aa.insertItemBefore(B.createSVGTransform(),H)}else{aa.appendItem(B.createSVGTransform());aa.appendItem(B.createSVGTransform());aa.appendItem(B.createSVGTransform());if(svgedit.browser.supportsNonScalingStroke()){if(D=svgedit.browser.isWebkit())la=function(ja){var ka=ja.getAttributeNS(null,"stroke");ja.removeAttributeNS(null,"stroke");ka!==null&&setTimeout(function(){ja.setAttributeNS(null,"stroke",ka)},0)};S.style.vectorEffect="non-scaling-stroke";
D&&la(S);I=S.getElementsByTagName("*");G=I.length;for(H=0;H<G;H++){I[H].style.vectorEffect="non-scaling-stroke";D&&la(I[H])}}}break;case "fhellipse":case "fhrect":case "fhpath":F.x=G;F.y=X;ma=true;a=G+","+X+" ";la=v.stroke_width==0?1:v.stroke_width;O({element:"polyline",curStyles:true,attr:{points:a,id:na(),fill:"none",opacity:v.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}});l.minx=G;l.maxx=G;l.miny=X;l.maxy=X;break;case "image":ma=true;la=O({element:"image",attr:{x:D,y:I,width:0,
height:0,id:na(),opacity:v.opacity/2,style:"pointer-events:inherit"}});ta(la,db);svgedit.utilities.preventClickDefault(la);break;case "square":case "rect":ma=true;h=D;b=I;O({element:"rect",curStyles:true,attr:{x:D,y:I,width:0,height:0,id:na(),opacity:v.opacity/2}});break;case "line":ma=true;la=v.stroke_width==0?1:v.stroke_width;O({element:"line",curStyles:true,attr:{x1:D,y1:I,x2:D,y2:I,id:na(),stroke:v.stroke,"stroke-width":la,"stroke-dasharray":v.stroke_dasharray,"stroke-linejoin":v.stroke_linejoin,
"stroke-linecap":v.stroke_linecap,"stroke-opacity":v.stroke_opacity,fill:"none",opacity:v.opacity/2,style:"pointer-events:none"}});break;case "circle":ma=true;O({element:"circle",curStyles:true,attr:{cx:D,cy:I,r:0,id:na(),opacity:v.opacity/2}});break;case "ellipse":ma=true;O({element:"ellipse",curStyles:true,attr:{cx:D,cy:I,rx:0,ry:0,id:na(),opacity:v.opacity/2}});break;case "text":ma=true;O({element:"text",curStyles:true,attr:{x:D,y:I,id:na(),fill:ua.fill,"stroke-width":ua.stroke_width,"font-size":ua.font_size,
"font-family":ua.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:v.opacity}});break;case "path":case "pathedit":h*=e;b*=e;ca.mouseDown(M,S,h,b);ma=true;break;case "textedit":h*=e;b*=e;oa.mouseDown(M,S,h,b);ma=true;break;case "rotate":ma=true;u.undoMgr.beginUndoableChange("transform",t)}M=Ja("mouseDown",{event:M,start_x:h,start_y:b,selectedElements:t},true);$.each(M,function(ja,ka){if(ka&&ka.started)ma=true})}}).mousemove(function(M){if(ma)if(!(M.button===1||u.spaceKey)){var H,D,
G,I,S,X=t[0],aa=svgedit.math.transformPoint(M.pageX,M.pageY,Da),la=aa.x*e;aa=aa.y*e;var U=svgedit.utilities.getElem(va());x=D=la/e;y=I=aa/e;if(i.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}M.preventDefault();switch(fa){case "select":if(t[0]!==null){D=x-h;G=y-b;if(i.gridSnapping){D=svgedit.utilities.snapToGrid(D);G=svgedit.utilities.snapToGrid(G)}if(M.shiftKey){H=svgedit.math.snapToAngle(h,b,x,y);x=H.x;y=H.y}if(D!=0||G!=0){I=t.length;for(H=0;H<I;++H){X=t[H];if(X==
null)break;var ja=B.createSVGTransform();U=svgedit.transformlist.getTransformList(X);ja.setTranslate(D,G);U.numberOfItems?U.replaceItem(ja,0):U.appendItem(ja);ea.requestSelector(X).resize()}Y("transition",t)}}break;case "multiselect":D*=e;I*=e;svgedit.utilities.assignAttributes(ia,{x:Math.min(p,D),y:Math.min(o,I),width:Math.abs(D-p),height:Math.abs(I-o)},100);U=t.slice();D=[];ja=hb();I=ja.length;for(H=0;H<I;++H){G=ja[H];t.indexOf(G)==-1&&D.push(G);G=U.indexOf(G);G!=-1&&U.splice(G,1)}U.length>0&&u.removeFromSelection(U);
D.length>0&&u.addToSelection(D);break;case "resize":U=svgedit.transformlist.getTransformList(X);G=(H=svgedit.math.hasMatrixTransform(U))?C:svgedit.utilities.getBBox(X);I=G.x;ja=G.y;var ka=G.width,Ba=G.height;D=x-h;G=y-b;if(i.gridSnapping){D=svgedit.utilities.snapToGrid(D);G=svgedit.utilities.snapToGrid(G);Ba=svgedit.utilities.snapToGrid(Ba);ka=svgedit.utilities.snapToGrid(ka)}if(S=svgedit.utilities.getRotationAngle(X)){var Ea=Math.sqrt(D*D+G*G);G=Math.atan2(G,D)-S*Math.PI/180;D=Ea*Math.cos(G);G=Ea*
Math.sin(G)}if(za.indexOf("n")==-1&&za.indexOf("s")==-1)G=0;if(za.indexOf("e")==-1&&za.indexOf("w")==-1)D=0;var Pa=Ea=0,Za=Ba?(Ba+G)/Ba:1,Qa=ka?(ka+D)/ka:1;if(za.indexOf("n")>=0){Za=Ba?(Ba-G)/Ba:1;Pa=Ba}if(za.indexOf("w")>=0){Qa=ka?(ka-D)/ka:1;Ea=ka}D=B.createSVGTransform();G=B.createSVGTransform();ka=B.createSVGTransform();if(i.gridSnapping){I=svgedit.utilities.snapToGrid(I);Ea=svgedit.utilities.snapToGrid(Ea);ja=svgedit.utilities.snapToGrid(ja);Pa=svgedit.utilities.snapToGrid(Pa)}D.setTranslate(-(I+
Ea),-(ja+Pa));if(M.shiftKey)if(Qa==1)Qa=Za;else Za=Qa;G.setScale(Qa,Za);ka.setTranslate(I+Ea,ja+Pa);if(H){H=S?1:0;U.replaceItem(D,2+H);U.replaceItem(G,1+H);U.replaceItem(ka,Number(H))}else{H=U.numberOfItems;U.replaceItem(ka,H-3);U.replaceItem(G,H-2);U.replaceItem(D,H-1)}ea.requestSelector(X).resize();Y("transition",t);break;case "zoom":D*=e;I*=e;svgedit.utilities.assignAttributes(ia,{x:Math.min(p*e,D),y:Math.min(o*e,I),width:Math.abs(D-p*e),height:Math.abs(I-o*e)},100);break;case "text":svgedit.utilities.assignAttributes(U,
{x:x,y:y},1E3);break;case "line":if(i.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}D=x;H=y;if(M.shiftKey){H=svgedit.math.snapToAngle(h,b,D,H);D=H.x;H=H.y}U.setAttributeNS(null,"x2",D);U.setAttributeNS(null,"y2",H);break;case "foreignObject":case "square":case "rect":case "image":D=Math.abs(x-h);H=Math.abs(y-b);if(fa=="square"||M.shiftKey){D=H=Math.max(D,H);I=h<x?h:h-D;ja=b<y?b:b-H}else{I=Math.min(h,x);ja=Math.min(b,y)}if(i.gridSnapping){D=svgedit.utilities.snapToGrid(D);
H=svgedit.utilities.snapToGrid(H);I=svgedit.utilities.snapToGrid(I);ja=svgedit.utilities.snapToGrid(ja)}svgedit.utilities.assignAttributes(U,{width:D,height:H,x:I,y:ja},1E3);break;case "circle":H=$(U).attr(["cx","cy"]);D=H.cx;H=H.cy;D=Math.sqrt((x-D)*(x-D)+(y-H)*(y-H));if(i.gridSnapping)D=svgedit.utilities.snapToGrid(D);U.setAttributeNS(null,"r",D);break;case "ellipse":H=$(U).attr(["cx","cy"]);D=H.cx;H=H.cy;if(i.gridSnapping){x=svgedit.utilities.snapToGrid(x);D=svgedit.utilities.snapToGrid(D);y=svgedit.utilities.snapToGrid(y);
H=svgedit.utilities.snapToGrid(H)}U.setAttributeNS(null,"rx",Math.abs(x-D));U.setAttributeNS(null,"ry",Math.abs(M.shiftKey?x-D:y-H));break;case "fhellipse":case "fhrect":l.minx=Math.min(D,l.minx);l.maxx=Math.max(D,l.maxx);l.miny=Math.min(I,l.miny);l.maxy=Math.max(I,l.maxy);case "fhpath":J.x=D;J.y=I;if(A.x&&A.y)for(H=0;H<9;H++){P=H/10;R=(H+1)/10;W=V=Z(R);V=Z(P);z+=Math.sqrt((W.x-V.x)*(W.x-V.x)+(W.y-V.y)*(W.y-V.y));if(z>0.8){a+=+V.x+","+V.y+" ";U.setAttributeNS(null,"points",a);z-=0.8}}A={x:E.x,y:E.y};
E={x:F.x,y:F.y};F={x:J.x,y:J.y};break;case "path":case "pathedit":x*=e;y*=e;if(i.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y);h=svgedit.utilities.snapToGrid(h);b=svgedit.utilities.snapToGrid(b)}if(M.shiftKey){if(H=svgedit.path.path){U=H.dragging?H.dragging[0]:h;H=H.dragging?H.dragging[1]:b}else{U=h;H=b}H=svgedit.math.snapToAngle(U,H,x,y);x=H.x;y=H.y}if(ia&&ia.getAttribute("display")!=="none"){D*=e;I*=e;svgedit.utilities.assignAttributes(ia,{x:Math.min(p*e,D),y:Math.min(o*
e,I),width:Math.abs(D-p*e),height:Math.abs(I-o*e)},100)}ca.mouseMove(x,y);break;case "textedit":x*=e;y*=e;oa.mouseMove(la,aa);break;case "rotate":G=svgedit.utilities.getBBox(X);D=G.x+G.width/2;H=G.y+G.height/2;U=svgedit.math.getMatrix(X);U=svgedit.math.transformPoint(D,H,U);D=U.x;H=U.y;S=(Math.atan2(H-y,D-x)*(180/Math.PI)-90)%360;if(i.gridSnapping)S=svgedit.utilities.snapToGrid(S);if(M.shiftKey)S=Math.round(S/45)*45;u.setRotationAngle(S<-180?360+S:S,true);Y("transition",t)}Ja("mouseMove",{event:M,
mouse_x:la,mouse_y:aa,selected:X})}}).click(function(M){M.preventDefault();return false}).dblclick(function(M){var H=M.target.parentNode;if(H!==m){var D=Ya(M),G=D.tagName;if(G==="text"&&fa!=="textedit"){M=svgedit.math.transformPoint(M.pageX,M.pageY,Da);oa.select(D,M.x,M.y)}if((G==="g"||G==="a")&&svgedit.utilities.getRotationAngle(D)){kb(D);D=t[0];ha(true)}m&&Ha();H.tagName!=="g"&&H.tagName!=="a"||H===f().getCurrentLayer()||D===ea.selectorParentGroup||Db(D)}}).mouseup(function(M){if(M.button!==2){var H=
eb;eb=null;if(ma){var D=svgedit.math.transformPoint(M.pageX,M.pageY,Da),G=D.x*e;D=D.y*e;var I=G/e,S=D/e,X=svgedit.utilities.getElem(va()),aa=false;ma=false;switch(fa){case "resize":case "multiselect":if(ia!=null){ia.setAttribute("display","none");Ga=[]}fa="select";case "select":if(t[0]!=null){if(t[1]==null){G=t[0];switch(G.tagName){case "g":case "use":case "image":case "foreignObject":break;default:ra.fill=G.getAttribute("fill");ra.fill_opacity=G.getAttribute("fill-opacity");ra.stroke=G.getAttribute("stroke");
ra.stroke_opacity=G.getAttribute("stroke-opacity");ra.stroke_width=G.getAttribute("stroke-width");ra.stroke_dasharray=G.getAttribute("stroke-dasharray");ra.stroke_linejoin=G.getAttribute("stroke-linejoin");ra.stroke_linecap=G.getAttribute("stroke-linecap")}if(G.tagName=="text"){ua.font_size=G.getAttribute("font-size");ua.font_family=G.getAttribute("font-family")}ea.requestSelector(G).showGrips(true)}jb();if(I!=p||S!=o){G=t.length;for(M=0;M<G;++M){if(t[M]==null)break;t[M].firstChild||ea.requestSelector(t[M]).resize()}}else{G=
M.target;if(t[0].nodeName==="path"&&t[1]==null)ca.select(t[0]);else M.shiftKey&&H!=G&&u.removeFromSelection([G])}if(svgedit.browser.supportsNonScalingStroke())if(M=t[0]){M.removeAttribute("style");svgedit.utilities.walkTree(M,function(ja){ja.removeAttribute("style")})}}return;case "zoom":ia!=null&&ia.setAttribute("display","none");Y("zoomed",{x:Math.min(p,I),y:Math.min(o,S),width:Math.abs(I-p),height:Math.abs(S-o),factor:M.shiftKey?0.5:2});return;case "fhpath":z=0;A={x:0,y:0};E={x:0,y:0};F={x:0,y:0};
J={x:0,y:0};H=X.getAttribute("points");I=H.indexOf(",");if(aa=I>=0?H.indexOf(",",I+1)>=0:H.indexOf(" ",H.indexOf(" ")+1)>=0)X=ca.smoothPolylineIntoPath(X);break;case "line":H=$(X).attr(["x1","x2","y1","y2"]);aa=H.x1!=H.x2||H.y1!=H.y2;break;case "foreignObject":case "square":case "rect":case "image":H=$(X).attr(["width","height"]);aa=H.width!=0||H.height!=0||fa==="image";break;case "circle":aa=X.getAttribute("r")!=0;break;case "ellipse":H=$(X).attr(["rx","ry"]);aa=H.rx!=null||H.ry!=null;break;case "fhellipse":if(l.maxx-
l.minx>0&&l.maxy-l.miny>0){X=O({element:"ellipse",curStyles:true,attr:{cx:(l.minx+l.maxx)/2,cy:(l.miny+l.maxy)/2,rx:(l.maxx-l.minx)/2,ry:(l.maxy-l.miny)/2,id:va()}});Y("changed",[X]);aa=true}break;case "fhrect":if(l.maxx-l.minx>0&&l.maxy-l.miny>0){X=O({element:"rect",curStyles:true,attr:{x:l.minx,y:l.miny,width:l.maxx-l.minx,height:l.maxy-l.miny,id:va()}});Y("changed",[X]);aa=true}break;case "text":aa=true;Aa([X]);oa.start(X);break;case "path":X=null;ma=true;H=ca.mouseUp(M,X,G,D);X=H.element;aa=H.keep;
break;case "pathedit":aa=true;X=null;ca.mouseUp(M);break;case "textedit":aa=false;X=null;oa.mouseUp(M,G,D);break;case "rotate":aa=true;X=null;fa="select";H=u.undoMgr.finishUndoableChange();H.isEmpty()||da(H);jb();Y("changed",t)}G=Ja("mouseUp",{event:M,mouse_x:G,mouse_y:D},true);$.each(G,function(ja,ka){if(ka){aa=ka.keep||aa;X=ka.element;ma=ka.started||ma}});if(!aa&&X!=null){f().releaseId(va());X.parentNode.removeChild(X);X=null;for(G=M.target;G.parentNode.parentNode.tagName=="g";)G=G.parentNode;if((fa!=
"path"||!drawn_path)&&G.parentNode.id!="selectorParentGroup"&&G.id!="svgcanvas"&&G.id!="svgroot"){u.setMode("select");Aa([G],true)}}else if(X!=null){u.addedNew=true;M=0.2;var la;if(bb.beginElement&&X.getAttribute("opacity")!=v.opacity){la=$(bb).clone().attr({to:v.opacity,dur:M}).appendTo(X);try{la[0].beginElement()}catch(U){}}else M=0;setTimeout(function(){la&&la.remove();X.setAttribute("opacity",v.opacity);X.setAttribute("style","pointer-events:inherit");nb(X);if(fa==="path")ca.toEditMode(X);else i.selectNew&&
Aa([X],true);da(new svgedit.history.InsertElementCommand(X));Y("changed",[X])},M*1E3)}Ra=null}}});$(g).bind("mousewheel DOMMouseScroll",function(M){M.preventDefault();M=M.originalEvent;Da=$("#svgcontent g")[0].getScreenCTM().inverse();var H=svgedit.math.transformPoint(M.pageX,M.pageY,Da);H={x:H.x,y:H.y,width:0,height:0};if(M=M.wheelDelta?M.wheelDelta:M.detail?-M.detail:0){H.factor=Math.max(0.75,Math.min(4/3,M));Y("zoomed",H)}})})();oa=u.textActions=function(){function a(D){var G=E.value==="";$(E).focus();
if(!arguments.length)if(G)D=0;else{if(E.selectionEnd!==E.selectionStart)return;D=E.selectionEnd}var I;I=R[D];G||E.setSelectionRange(D,D);F=svgedit.utilities.getElem("text_cursor");if(!F){F=document.createElementNS(k.SVG,"line");svgedit.utilities.assignAttributes(F,{id:"text_cursor",stroke:"#333","stroke-width":1});F=svgedit.utilities.getElem("selectorParentGroup").appendChild(F)}P||(P=setInterval(function(){var S=F.getAttribute("display")==="none";F.setAttribute("display",S?"inline":"none")},600));
G=C(I.x,V.y);I=C(I.x,V.y+V.height);svgedit.utilities.assignAttributes(F,{x1:G.x,y1:G.y,x2:I.x,y2:I.y,visibility:"visible",display:"inline"});J&&J.setAttribute("d","")}function h(D,G,I){if(D===G)a(G);else{I||E.setSelectionRange(D,G);J=svgedit.utilities.getElem("text_selectblock");if(!J){J=document.createElementNS(k.SVG,"path");svgedit.utilities.assignAttributes(J,{id:"text_selectblock",fill:"green",opacity:0.5,style:"pointer-events:none"});svgedit.utilities.getElem("selectorParentGroup").appendChild(J)}D=
R[D];var S=R[G];F.setAttribute("visibility","hidden");G=C(D.x,V.y);I=C(D.x+(S.x-D.x),V.y);var X=C(D.x,V.y+V.height);D=C(D.x+(S.x-D.x),V.y+V.height);svgedit.utilities.assignAttributes(J,{d:"M"+G.x+","+G.y+" L"+I.x+","+I.y+" "+D.x+","+D.y+" "+X.x+","+X.y+"z",display:"inline"})}}function b(D,G){var I=B.createSVGPoint();I.x=D;I.y=G;if(R.length==1)return 0;I=A.getCharNumAtPosition(I);if(I<0){I=R.length-2;if(D<=R[0].x)I=0}else if(I>=R.length-2)I=R.length-2;var S=R[I];D>S.x+S.width/2&&I++;return I}function p(D,
G,I){var S=E.selectionStart;D=b(D,G);h(Math.min(S,D),Math.max(S,D),!I)}function o(D,G){var I={x:D,y:G};I.x/=e;I.y/=e;if(W){var S=svgedit.math.transformPoint(I.x,I.y,W.inverse());I.x=S.x;I.y=S.y}return I}function C(D,G){var I={x:D,y:G};if(W){var S=svgedit.math.transformPoint(I.x,I.y,W);I.x=S.x;I.y=S.y}I.x*=e;I.y*=e;return I}function l(D){h(0,A.textContent.length);$(this).unbind(D)}function z(D){if(H&&A){var G=svgedit.math.transformPoint(D.pageX,D.pageY,Da);G=o(G.x*e,G.y*e);G=b(G.x,G.y);var I=A.textContent,
S=I.substr(0,G).replace(/[a-z0-9]+$/i,"").length;I=I.substr(G).match(/^[a-z0-9]+/i);h(S,(I?I[0].length:0)+G);$(D.target).click(l);setTimeout(function(){$(D.target).unbind("click",l)},300)}}var A,E,F,J,P,R=[],V,W,Z,M,H;return{select:function(D,G,I){A=D;oa.toEditMode(G,I)},start:function(D){A=D;oa.toEditMode()},mouseDown:function(D,G,I,S){D=o(I,S);E.focus();a(b(D.x,D.y));Z=I;M=S},mouseMove:function(D,G){var I=o(D,G);p(I.x,I.y)},mouseUp:function(D,G,I){var S=o(G,I);p(S.x,S.y,true);D.target!==A&&G<Z+
2&&G>Z-2&&I<M+2&&I>M-2&&oa.toSelectMode(true)},setCursor:a,toEditMode:function(D,G){H=false;fa="textedit";ea.requestSelector(A).showGrips(false);ea.requestSelector(A);oa.init();$(A).css("cursor","text");if(arguments.length){var I=o(D,G);a(b(I.x,I.y))}else a();setTimeout(function(){H=true},300)},toSelectMode:function(D){fa="select";clearInterval(P);P=null;J&&$(J).attr("display","none");F&&$(F).attr("visibility","hidden");$(A).css("cursor","move");if(D){ha();$(A).css("cursor","move");Y("selected",[A]);
xa([A],true)}A&&!A.textContent.length&&u.deleteSelectedElements();$(E).blur();A=false},setInputElem:function(D){E=D},clear:function(){fa=="textedit"&&oa.toSelectMode()},init:function(){if(A){var D,G;if(!A.parentNode){A=t[0];ea.requestSelector(A).showGrips(false)}var I=A.textContent.length;D=A.getAttribute("transform");V=svgedit.utilities.getBBox(A);W=D?svgedit.math.getMatrix(A):null;R=[];R.length=I;E.focus();$(A).unbind("dblclick",z).dblclick(z);I||(G={x:V.x+V.width/2,width:0});for(D=0;D<I;D++){var S=
A.getStartPositionOfChar(D);G=A.getEndPositionOfChar(D);if(!svgedit.browser.supportsGoodTextCharPos()){var X=u.contentW*e;S.x-=X;G.x-=X;S.x/=e;G.x/=e}R[D]={x:S.x,y:V.y,width:G.x-S.x,height:V.height}}R.push({x:G.x,width:0});h(E.selectionStart,E.selectionEnd,true)}}}}();ca=u.pathActions=function(){var a=false,h,b,p;svgedit.path.Path.prototype.endChanges=function(l){if(svgedit.browser.isWebkit()){var z=this.elem;z.setAttribute("d",ca.convertPath(z))}l=new svgedit.history.ChangeElementCommand(this.elem,
{d:this.last_d},l);da(l);Y("changed",[this.elem])};svgedit.path.Path.prototype.addPtsToSelection=function(l){var z,A;$.isArray(l)||(l=[l]);for(z=0;z<l.length;z++){var E=l[z];A=this.segs[E];A.ptgrip&&this.selected_pts.indexOf(E)==-1&&E>=0&&this.selected_pts.push(E)}this.selected_pts.sort();z=this.selected_pts.length;l=[];for(l.length=z;z--;){A=this.segs[this.selected_pts[z]];A.select(true);l[z]=A.ptgrip}ca.canDeleteNodes=true;ca.closed_subpath=this.subpathIsClosed(this.selected_pts[0]);Y("selected",
l)};var o=h=null,C=false;return{mouseDown:function(l,z,A,E){var F;if(fa==="path"){mouse_x=A;mouse_y=E;E=mouse_x/e;z=mouse_y/e;A=svgedit.utilities.getElem("path_stretch_line");b=[E,z];if(i.gridSnapping){E=svgedit.utilities.snapToGrid(E);z=svgedit.utilities.snapToGrid(z);mouse_x=svgedit.utilities.snapToGrid(mouse_x);mouse_y=svgedit.utilities.snapToGrid(mouse_y)}if(!A){A=document.createElementNS(k.SVG,"path");svgedit.utilities.assignAttributes(A,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",
fill:"none"});A=svgedit.utilities.getElem("selectorParentGroup").appendChild(A)}A.setAttribute("display","inline");var J=null;if(o){J=o.pathSegList;var P=J.numberOfItems;F=6/e;for(var R=false;P;){P--;var V=J.getItem(P),W=V.x;V=V.y;if(E>=W-F&&E<=W+F&&z>=V-F&&z<=V+F){R=true;break}}F=va();svgedit.path.removePath_(F);F=svgedit.utilities.getElem(F);W=J.numberOfItems;if(R){if(P<=1&&W>=2){E=J.getItem(0).x;z=J.getItem(0).y;l=A.pathSegList.getItem(1);l=l.pathSegType===4?o.createSVGPathSegLinetoAbs(E,z):o.createSVGPathSegCurvetoCubicAbs(E,
z,l.x1/e,l.y1/e,E,z);E=o.createSVGPathSegClosePath();J.appendItem(l);J.appendItem(E)}else if(W<3)return J=false;$(A).remove();element=F;o=null;ma=false;if(a){svgedit.path.path.matrix&&svgedit.coords.remapElement(F,{},svgedit.path.path.matrix.inverse());A=F.getAttribute("d");l=$(svgedit.path.path.elem).attr("d");$(svgedit.path.path.elem).attr("d",l+A);$(F).remove();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();svgedit.path.path.init();ca.toEditMode(svgedit.path.path.elem);svgedit.path.path.selectPt();
return false}}else{if(!$.contains(g,Ya(l))){console.log("Clicked outside canvas");return false}J=o.pathSegList.numberOfItems;P=o.pathSegList.getItem(J-1);F=P.x;P=P.y;if(l.shiftKey){l=svgedit.math.snapToAngle(F,P,E,z);E=l.x;z=l.y}l=A.pathSegList.getItem(1);l=l.pathSegType===4?o.createSVGPathSegLinetoAbs(Oa(E),Oa(z)):o.createSVGPathSegCurvetoCubicAbs(Oa(E),Oa(z),l.x1/e,l.y1/e,l.x2/e,l.y2/e);o.pathSegList.appendItem(l);E*=e;z*=e;A.setAttribute("d",["M",E,z,E,z].join(" "));A=J;if(a)A+=svgedit.path.path.segs.length;
svgedit.path.addPointGrip(A,E,z)}}else{d_attr="M"+E+","+z+" ";o=O({element:"path",curStyles:true,attr:{d:d_attr,id:na(),opacity:v.opacity/2}});A.setAttribute("d",["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" "));A=a?svgedit.path.path.segs.length:0;svgedit.path.addPointGrip(A,mouse_x,mouse_y)}}else if(svgedit.path.path){svgedit.path.path.storeD();F=l.target.id;if(F.substr(0,14)=="pathpointgrip_"){z=svgedit.path.path.cur_pt=parseInt(F.substr(14));svgedit.path.path.dragging=[A,E];J=svgedit.path.path.segs[z];
if(l.shiftKey)J.selected?svgedit.path.path.removePtFromSelection(z):svgedit.path.path.addPtsToSelection(z);else{if(svgedit.path.path.selected_pts.length<=1||!J.selected)svgedit.path.path.clearSelection();svgedit.path.path.addPtsToSelection(z)}}else if(F.indexOf("ctrlpointgrip_")==0){svgedit.path.path.dragging=[A,E];l=F.split("_")[1].split("c");z=Number(l[0]);svgedit.path.path.selectPt(z,Number(l[1]))}if(!svgedit.path.path.dragging){if(ia==null)ia=ea.getRubberBandBox();svgedit.utilities.assignAttributes(ia,
{x:A*e,y:E*e,width:0,height:0,display:"inline"},100)}}},mouseMove:function(l,z){C=true;if(fa==="path"){if(o){var A=o.pathSegList,E=A.numberOfItems-1;if(b){var F=svgedit.path.addCtrlGrip("1c1"),J=svgedit.path.addCtrlGrip("0c2");F.setAttribute("cx",l);F.setAttribute("cy",z);F.setAttribute("display","inline");F=b[0];var P=b[1];A.getItem(E);var R=F+(F-l/e),V=P+(P-z/e);J.setAttribute("cx",R*e);J.setAttribute("cy",V*e);J.setAttribute("display","inline");J=svgedit.path.getCtrlLine(1);svgedit.utilities.assignAttributes(J,
{x1:l,y1:z,x2:R*e,y2:V*e,display:"inline"});if(E===0)p=[l,z];else{A=A.getItem(E-1);J=A.x;var W=A.y;if(A.pathSegType===6){J+=J-A.x2;W+=W-A.y2}else if(p){J=p[0]/e;W=p[1]/e}svgedit.path.replacePathSeg(6,E,[F,P,J,W,R,V],o)}}else if(F=svgedit.utilities.getElem("path_stretch_line")){E=A.getItem(E);if(E.pathSegType===6)svgedit.path.replacePathSeg(6,1,[l,z,(E.x+(E.x-E.x2))*e,(E.y+(E.y-E.y2))*e,l,z],F);else p?svgedit.path.replacePathSeg(6,1,[l,z,p[0],p[1],l,z],F):svgedit.path.replacePathSeg(4,1,[l,z],F)}}}else if(svgedit.path.path.dragging){F=
svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},svgedit.path.path);P=svgedit.path.getPointFromGrip({x:l,y:z},svgedit.path.path);E=P.x-F.x;F=P.y-F.y;svgedit.path.path.dragging=[l,z];svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(E,F):svgedit.path.path.movePts(E,F)}else{svgedit.path.path.selected_pts=[];svgedit.path.path.eachSeg(function(){if(this.next||this.prev){var Z=ia.getBBox(),M=svgedit.path.getGripPt(this);Z=svgedit.math.rectsIntersect(Z,
{x:M.x,y:M.y,width:0,height:0});this.select(Z);Z&&svgedit.path.path.selected_pts.push(this.index)}})}},mouseUp:function(l,z){if(fa==="path"){b=null;if(!o){z=svgedit.utilities.getElem(va());ma=false;p=null}return{keep:true,element:z}}if(svgedit.path.path.dragging){var A=svgedit.path.path.cur_pt;svgedit.path.path.dragging=false;svgedit.path.path.dragctrl=false;svgedit.path.path.update();C&&svgedit.path.path.endChanges("Move path point(s)");!l.shiftKey&&!C&&svgedit.path.path.selectPt(A)}else if(ia&&
ia.getAttribute("display")!="none"){ia.setAttribute("display","none");ia.getAttribute("width")<=2&&ia.getAttribute("height")<=2&&ca.toSelectMode(l.target)}else ca.toSelectMode(l.target);C=false},toEditMode:function(l){svgedit.path.path=svgedit.path.getPath_(l);fa="pathedit";ha();svgedit.path.path.show(true).update();svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem);a=false},toSelectMode:function(l){var z=l==svgedit.path.path.elem;fa="select";svgedit.path.path.show(false);
h=false;ha();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();if(z){Y("selected",[l]);xa([l],true)}},addSubPath:function(l){if(l){fa="path";a=true}else{ca.clear(true);ca.toEditMode(svgedit.path.path.elem)}},select:function(l){if(h===l){ca.toEditMode(l);fa="pathedit"}else h=l},reorient:function(){var l=t[0];if(l)if(svgedit.utilities.getRotationAngle(l)!=0){var z=new svgedit.history.BatchCommand("Reorient path"),A={d:l.getAttribute("d"),transform:l.getAttribute("transform")};z.addSubCommand(new svgedit.history.ChangeElementCommand(l,
A));ha();this.resetOrientation(l);da(z);svgedit.path.getPath_(l).show(false).matrix=null;this.clear();xa([l],true);Y("changed",t)}},clear:function(){h=null;if(o){var l=svgedit.utilities.getElem(va());$(svgedit.utilities.getElem("path_stretch_line")).remove();$(l).remove();$(svgedit.utilities.getElem("pathpointgrip_container")).find("*").attr("display","none");o=p=null;ma=false}else fa=="pathedit"&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(false)},resetOrientation:function(l){if(l==
null||l.nodeName!="path")return false;var z=svgedit.transformlist.getTransformList(l),A=svgedit.math.transformListToTransform(z).matrix;z.clear();l.removeAttribute("transform");z=l.pathSegList;var E=z.numberOfItems,F;for(F=0;F<E;++F){var J=z.getItem(F),P=J.pathSegType;if(P!=1){var R=[];$.each(["",1,2],function(V,W){var Z=J["x"+W],M=J["y"+W];if(Z!==undefined&&M!==undefined){Z=svgedit.math.transformPoint(Z,M,A);R.splice(R.length,0,Z.x,Z.y)}});svgedit.path.replacePathSeg(P,F,R,l)}}c(l,A)},zoomChange:function(){fa==
"pathedit"&&svgedit.path.path.update()},getNodePoint:function(){var l=svgedit.path.path.segs[svgedit.path.path.selected_pts.length?svgedit.path.path.selected_pts[0]:1];return{x:l.item.x,y:l.item.y,type:l.type}},linkControlPoints:function(l){svgedit.path.setLinkControlPoints(l)},clonePathNode:function(){svgedit.path.path.storeD();for(var l=svgedit.path.path.selected_pts,z=l.length,A=[];z--;){var E=l[z];svgedit.path.path.addSeg(E);A.push(E+z);A.push(E+z+1)}svgedit.path.path.init().addPtsToSelection(A);
svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var l=svgedit.path.path.selected_pts;if(l.length===1){var z=svgedit.path.path.elem,A=z.pathSegList,E=l[0],F=null,J=null;svgedit.path.path.eachSeg(function(W){if(this.type===2&&W<=E)J=this.item;if(W<=E)return true;if(this.type===2){F=W;return false}if(this.type===1)return F=false});if(F==null)F=svgedit.path.path.segs.length-1;if(F!==false){var P=z.createSVGPathSegLinetoAbs(J.x,J.y),R=z.createSVGPathSegClosePath();if(F==
svgedit.path.path.segs.length-1){A.appendItem(P);A.appendItem(R)}else{svgedit.path.insertItemBefore(z,R,F);svgedit.path.insertItemBefore(z,P,F)}svgedit.path.path.init().selectPt(F+1)}else if(svgedit.path.path.segs[E].mate){A.removeItem(E);A.removeItem(E);svgedit.path.path.init().selectPt(E-1)}else{for(l=0;l<A.numberOfItems;l++){var V=A.getItem(l);if(V.pathSegType===2)P=l;else if(l===E)A.removeItem(P);else if(V.pathSegType===1&&E<l){R=l-1;A.removeItem(l);break}}for(l=E-P-1;l--;)svgedit.path.insertItemBefore(z,
A.getItem(P),R);z=A.getItem(P);svgedit.path.replacePathSeg(2,P,[z.x,z.y]);l=E;svgedit.path.path.init().selectPt(0)}}},deletePathNode:function(){if(ca.canDeleteNodes){svgedit.path.path.storeD();for(var l=svgedit.path.path.selected_pts,z=l.length;z--;)svgedit.path.path.deleteSeg(l[z]);var A=function(){var E=svgedit.path.path.elem.pathSegList,F=E.numberOfItems,J=function(V,W){for(;W--;)E.removeItem(V)};if(F<=1)return true;for(;F--;){var P=E.getItem(F);if(P.pathSegType===1){P=E.getItem(F-1);var R=E.getItem(F-
2);if(P.pathSegType===2){J(F-1,2);A();break}else if(R.pathSegType===2){J(F-2,3);A();break}}else if(P.pathSegType===2)if(F>0){P=E.getItem(F-1).pathSegType;if(P===2){J(F-1,1);A();break}else if(P===1&&E.numberOfItems-1===F){J(F,1);A();break}}}return false};A();if(svgedit.path.path.elem.pathSegList.numberOfItems<=1){ca.toSelectMode(svgedit.path.path.elem);u.deleteSelectedElements()}else{svgedit.path.path.init();svgedit.path.path.clearSelection();if(window.opera){l=$(svgedit.path.path.elem);l.attr("d",
l.attr("d"))}svgedit.path.path.endChanges("Delete path node(s)")}}},smoothPolylineIntoPath:function(l){var z=l.points,A=z.numberOfItems;if(A>=4){var E=z.getItem(0),F=null,J=[];J.push(["M",E.x,",",E.y," C"].join(""));for(l=1;l<=A-4;l+=3){var P=z.getItem(l),R=z.getItem(l+1),V=z.getItem(l+2);if(F)if((E=svgedit.path.smoothControlPoints(F,P,E))&&E.length==2){P=J[J.length-1].split(",");P[2]=E[0].x;P[3]=E[0].y;J[J.length-1]=P.join(",");P=E[1]}J.push([P.x,P.y,R.x,R.y,V.x,V.y].join(","));E=V;F=R}for(J.push("L");l<
A;){R=z.getItem(l);J.push([R.x,R.y].join(","));l++}J=J.join(" ");l=O({element:"path",curStyles:true,attr:{id:va(),d:J,fill:"none"}})}return l},setSegType:function(l){svgedit.path.path.setSegType(l)},moveNode:function(l,z){var A=svgedit.path.path.selected_pts;if(A.length){svgedit.path.path.storeD();A=svgedit.path.path.segs[A[0]];var E={x:0,y:0};E[l]=z-A.item[l];A.move(E.x,E.y);svgedit.path.path.endChanges("Move path point")}},fixEnd:function(l){var z=l.pathSegList,A=z.numberOfItems,E,F;for(E=0;E<A;++E){var J=
z.getItem(E);if(J.pathSegType===2)F=J;if(J.pathSegType===1){J=z.getItem(E-1);if(J.x!=F.x||J.y!=F.y){z=l.createSVGPathSegLinetoAbs(F.x,F.y);svgedit.path.insertItemBefore(l,z,E);ca.fixEnd(l);break}}}svgedit.browser.isWebkit()&&l.setAttribute("d",ca.convertPath(l))},convertPath:svgedit.utilities.convertPath}}();var sb=this.removeUnusedDefElems=function(){var a=d.getElementsByTagNameNS(k.SVG,"defs");if(!a||!a.length)return 0;var h=[],b=0,p=["fill","stroke","filter","marker-start","marker-mid","marker-end"],
o=p.length,C=d.getElementsByTagNameNS(k.SVG,"*"),l=C.length,z,A;for(z=0;z<l;z++){var E=C[z];for(A=0;A<o;A++){var F=svgedit.utilities.getUrlFromAttr(E.getAttribute(p[A]));F&&h.push(F.substr(1))}(A=pa(E))&&A.indexOf("#")===0&&h.push(A.substr(1))}a=$(a).find("linearGradient, radialGradient, filter, marker, svg, symbol");for(z=a.length;z--;){p=a[z];o=p.id;if(h.indexOf(o)<0){cb[o]=p;p.parentNode.removeChild(p);b++}}return b};this.svgCanvasToString=function(){for(;sb()>0;);ca.clear(true);$.each(d.childNodes,
function(b,p){b&&p.nodeType===8&&p.data.indexOf("Created with")>=0&&d.insertBefore(p,d.firstChild)});if(m){Ha();Aa([m])}var a=[];$(d).find("g:data(gsvg)").each(function(){var b=this.attributes,p=b.length,o;for(o=0;o<p;o++)if(b[o].nodeName=="id"||b[o].nodeName=="style")p--;if(p<=0){b=this.firstChild;a.push(b);$(this).replaceWith(b)}});var h=this.svgToString(d,0);a.length&&$(a).each(function(){rb(this)});return h};this.svgToString=function(a,h){var b=[],p=svgedit.utilities.toXml,o=i.baseUnit,C=RegExp("^-?[\\d\\.]+"+
o+"$");if(a){nb(a);var l=a.attributes,z,A,E=a.childNodes;for(A=0;A<h;A++)b.push(" ");b.push("<");b.push(a.nodeName);if(a.id==="svgcontent"){A=Ia();if(o!=="px"){A.w=svgedit.units.convertUnit(A.w,o)+o;A.h=svgedit.units.convertUnit(A.h,o)+o}b.push(' width="'+A.w+'" height="'+A.h+'" xmlns="'+k.SVG+'"');var F={};$(a).find("*").andSelf().each(function(){var V=this.namespaceURI;if(V&&!F[V]&&ya[V]&&ya[V]!=="xmlns"&&ya[V]!=="xml"){F[V]=true;b.push(" xmlns:"+ya[V]+'="'+V+'"')}$.each(this.attributes,function(W,
Z){var M=Z.namespaceURI;if(M&&!F[M]&&ya[M]!=="xmlns"&&ya[M]!=="xml"){F[M]=true;b.push(" xmlns:"+ya[M]+'="'+M+'"')}})});A=l.length;for(o=["width","height","xmlns","x","y","viewBox","id","overflow"];A--;){z=l.item(A);var J=p(z.value);if(z.nodeName.indexOf("xmlns:")!==0)if(J!=""&&o.indexOf(z.localName)==-1)if(!z.namespaceURI||ya[z.namespaceURI]){b.push(" ");b.push(z.nodeName);b.push('="');b.push(J);b.push('"')}}}else{if(a.nodeName==="defs"&&!a.firstChild)return;var P=["-moz-math-font-style","_moz-math-font-style"];
for(A=l.length-1;A>=0;A--){z=l.item(A);J=p(z.value);if(!(P.indexOf(z.localName)>=0))if(J!="")if(J.indexOf("pointer-events")!==0)if(!(z.localName==="class"&&J.indexOf("se_")===0)){b.push(" ");if(z.localName==="d")J=u.pathActions.convertPath(a).replace(/,/g," ").toUpperCase();if(isNaN(J)){if(C.test(J))J=svgedit.units.shortFloat(J)+o}else J=svgedit.units.shortFloat(J);if(Fa.apply&&a.nodeName==="image"&&z.localName==="href"&&Fa.images&&Fa.images==="embed"){var R=Va[J];if(R)J=R}if(!z.namespaceURI||z.namespaceURI==
k.SVG||ya[z.namespaceURI]){b.push(z.nodeName);b.push('="');b.push(J);b.push('"')}}}}if(a.hasChildNodes()){b.push(">");h++;l=false;for(A=0;A<E.length;A++){o=E.item(A);switch(o.nodeType){case 1:b.push("\n");b.push(this.svgToString(E.item(A),h));break;case 3:o=o.nodeValue.replace(/^\s+|\s+$/g,"");if(o!=""){l=true;b.push(String(p(o)))}break;case 4:b.push("\n");b.push(Array(h+1).join(" "));b.push("<![CDATA[");b.push(o.nodeValue);b.push("]]\>");break;case 8:b.push("\n");b.push(Array(h+1).join(" "));b.push("<!--");
b.push(o.data);b.push("--\>")}}h--;if(!l){b.push("\n");for(A=0;A<h;A++)b.push(" ")}b.push("</");b.push(a.nodeName);b.push(">")}else b.push("/>")}return b.join("")};this.embedImage=function(a,h){$(new Image).load(function(){var b=document.createElement("canvas");b.width=this.width;b.height=this.height;b.getContext("2d").drawImage(this,0,0);try{var p=";svgedit_url="+encodeURIComponent(a);p=b.toDataURL().replace(";base64",p+";base64");Va[a]=p}catch(o){Va[a]=false}db=a;h&&h(Va[a])}).attr("src",a)};this.setGoodImage=
function(a){db=a};this.open=function(){};this.save=function(a){ha();a&&$.extend(Fa,a);Fa.apply=true;a=this.svgCanvasToString();Y("saved",a)};this.rasterExport=function(a,h,b){var p="image/"+a.toLowerCase(),o=j(),C=this.svgCanvasToString();svgedit.utilities.buildCanvgCallback(function(){var l=a||"PNG";$("#export_canvas").length||$("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var z=$("#export_canvas")[0];z.width=svgCanvas.contentW;z.height=svgCanvas.contentH;canvg(z,C,{renderCallback:function(){var A=
(l==="ICO"?"BMP":l).toLowerCase();A=h?z.toDataURL("image/"+A,h):z.toDataURL("image/"+A);Y("exported",{datauri:A,svg:C,issues:o,type:a,mimeType:p,quality:h,exportWindowName:b})}})})()};this.exportPDF=function(a,h){var b=this;svgedit.utilities.buildJSPDFCallback(function(){var p=Ia();p=jsPDF({orientation:p.w>p.h?"landscape":"portrait",unit:"pt",format:[p.w,p.h]});var o=Eb();p.setProperties({title:o});o=j();var C=b.svgCanvasToString();p.addSVG(C,0,0);o={svg:C,issues:o,exportWindowName:a};C=h||"dataurlstring";
o[C]=p.output(C);Y("exportedPDF",o)})()};this.getSvgString=function(){Fa.apply=false;return this.svgCanvasToString()};this.randomizeIds=function(a){arguments.length>0&&a==false?svgedit.draw.randomizeIds(false,f()):svgedit.draw.randomizeIds(true,f())};var lb=this.uniquifyElems=function(a){var h={},b=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];svgedit.utilities.walkTree(a,function(z){if(z.nodeType==1){if(z.id){z.id in h||(h[z.id]={elem:null,attrs:[],hrefs:[]});h[z.id].elem=
z}$.each(qb,function(E,F){var J=z.getAttributeNode(F);if(J){var P=svgedit.utilities.getUrlFromAttr(J.value);if(P=P?P.substr(1):null){P in h||(h[P]={elem:null,attrs:[],hrefs:[]});h[P].attrs.push(J)}}});var A=svgedit.utilities.getHref(z);if(A&&b.indexOf(z.nodeName)>=0)if(A=A.substr(1)){A in h||(h[A]={elem:null,attrs:[],hrefs:[]});h[A].hrefs.push(z)}}});for(var p in h)if(p){var o=h[p].elem;if(o){a=na();o.id=a;o=h[p].attrs;for(var C=o.length;C--;){var l=o[C];l.ownerElement.setAttribute(l.name,"url(#"+
a+")")}o=h[p].hrefs;for(C=o.length;C--;)svgedit.utilities.setHref(o[C],"#"+a)}}},ab=this.setUseData=function(a){var h=$(a);if(a.tagName!=="use")h=h.find("use");h.each(function(){var b=pa(this).substr(1);if(b=svgedit.utilities.getElem(b)){$(this).data("ref",b);if(b.tagName=="symbol"||b.tagName=="svg")$(this).data("symbol",b).data("ref",b)}})},mb=this.convertGradients=function(a){var h=$(a).find("linearGradient, radialGradient");if(!h.length&&svgedit.browser.isWebkit())h=$(a).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=
0});h.each(function(){if($(this).attr("gradientUnits")==="userSpaceOnUse"){var b=$(d).find('[fill="url(#'+this.id+')"],[stroke="url(#'+this.id+')"]');if(b.length)if(b=svgedit.utilities.getBBox(b[0]))if(this.tagName==="linearGradient"){var p=$(this).attr(["x1","y1","x2","y2"]),o=this.gradientTransform.baseVal;if(o&&o.numberOfItems>0){var C=svgedit.math.transformListToTransform(o).matrix;o=svgedit.math.transformPoint(p.x1,p.y1,C);C=svgedit.math.transformPoint(p.x2,p.y2,C);p.x1=o.x;p.y1=o.y;p.x2=C.x;
p.y2=C.y;this.removeAttribute("gradientTransform")}$(this).attr({x1:(p.x1-b.x)/b.width,y1:(p.y1-b.y)/b.height,x2:(p.x2-b.x)/b.width,y2:(p.y2-b.y)/b.height});this.removeAttribute("gradientUnits")}}})},tb=this.convertToGroup=function(a){a||(a=t[0]);var h=$(a),b=new svgedit.history.BatchCommand,p;if(h.data("gsvg")){b=$(a.firstChild).attr(["x","y"]);$(a.firstChild.firstChild).unwrap();$(a).removeData("gsvg");p=svgedit.transformlist.getTransformList(a);var o=B.createSVGTransform();o.setTranslate(b.x,b.y);
p.appendItem(o);svgedit.recalculate.recalculateDimensions(a);Y("selected",[a])}else if(h.data("symbol")){a=h.data("symbol");p=h.attr("transform");o=h.attr(["x","y"]);var C=a.getAttribute("viewBox");if(C){C=C.split(" ");o.x-=+C[0];o.y-=+C[1]}p+=" translate("+(o.x||0)+","+(o.y||0)+")";o=h.prev();b.addSubCommand(new svgedit.history.RemoveElementCommand(h[0],h[0].nextSibling,h[0].parentNode));h.remove();C=$(d).find("use:data(symbol)").length;h=K.createElementNS(k.SVG,"g");var l=a.childNodes,z;for(z=0;z<
l.length;z++)h.appendChild(l[z].cloneNode(true));if(svgedit.browser.isGecko()){l=$(svgedit.utilities.findDefs()).children("linearGradient,radialGradient,pattern").clone();$(h).append(l)}p&&h.setAttribute("transform",p);p=a.parentNode;lb(h);svgedit.browser.isGecko()&&$(ga()).append($(h).find("linearGradient,radialGradient,pattern"));h.id=na();o.after(h);if(p){if(!C){o=a.nextSibling;p.removeChild(a);b.addSubCommand(new svgedit.history.RemoveElementCommand(a,o,p))}b.addSubCommand(new svgedit.history.InsertElementCommand(h))}ab(h);
svgedit.browser.isGecko()?mb(svgedit.utilities.findDefs()):mb(h);svgedit.utilities.walkTreePost(h,function(A){try{svgedit.recalculate.recalculateDimensions(A)}catch(E){console.log(E)}});$(h).find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=na()});Aa([h]);(a=kb(h,true))&&b.addSubCommand(a);da(b)}else console.log("Unexpected element to ungroup:",a)};this.setSvgString=function(a){try{var h=svgedit.utilities.text2xml(a);
this.prepareSvg(h);var b=new svgedit.history.BatchCommand("Change Source"),p=d.nextSibling,o=B.removeChild(d);b.addSubCommand(new svgedit.history.RemoveElementCommand(o,p,B));d=K.adoptNode?K.adoptNode(h.documentElement):K.importNode(h.documentElement,true);B.appendChild(d);var C=$(d);u.current_drawing_=new svgedit.draw.Drawing(d,n);var l=f().getNonce();l?Y("setnonce",l):Y("unsetnonce");C.find("image").each(function(){var R=this;svgedit.utilities.preventClickDefault(R);var V=pa(this);if(V){if(V.indexOf("data:")===
0){var W=V.match(/svgedit_url=(.*?);/);if(W){var Z=decodeURIComponent(W[1]);$(new Image).load(function(){R.setAttributeNS(k.XLINK,"xlink:href",Z)}).attr("src",Z)}}u.embedImage(V)}});C.find("svg").each(function(){if(!$(this).closest("defs").length){lb(this);var R=this.parentNode;if(R.childNodes.length===1&&R.nodeName==="g"){$(R).data("gsvg",this);R.id=R.id||na()}else rb(this)}});svgedit.browser.isGecko()&&C.find("linearGradient, radialGradient, pattern").appendTo(svgedit.utilities.findDefs());ab(C);
mb(C[0]);var z={id:"svgcontent",overflow:i.show_outside_canvas?"visible":"hidden"},A=false;if(C.attr("viewBox")){var E=C.attr("viewBox").split(" ");z.width=E[2];z.height=E[3]}else $.each(["width","height"],function(R,V){var W=C.attr(V);W||(W="100%");if(String(W).substr(-1)==="%")A=true;else z[V]=svgedit.units.convertToNum(V,W)});ub();C.children().find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=na()});if(A){var F=
wa();z.width=F.width+F.x;z.height=F.height+F.y}if(z.width<=0)z.width=100;if(z.height<=0)z.height=100;C.attr(z);this.contentW=z.width;this.contentH=z.height;b.addSubCommand(new svgedit.history.InsertElementCommand(d));var J=C.attr(["width","height"]);b.addSubCommand(new svgedit.history.ChangeElementCommand(B,J));e=1;svgedit.transformlist.resetListMap();ha();svgedit.path.clearData();B.appendChild(ea.selectorParentGroup);da(b);Y("changed",[d])}catch(P){console.log(P);return false}return true};this.importSvgString=
function(a){var h,b;try{var p=svgedit.utilities.encode64(a.length+a).substr(0,32),o=false;if(Na[p])if($(Na[p].symbol).parents("#svgroot").length)o=true;var C=new svgedit.history.BatchCommand("Import Image"),l;if(o){l=Na[p].symbol;b=Na[p].xform}else{var z=svgedit.utilities.text2xml(a);this.prepareSvg(z);var A;A=K.adoptNode?K.adoptNode(z.documentElement):K.importNode(z.documentElement,true);lb(A);var E=svgedit.units.convertToNum("width",A.getAttribute("width")),F=svgedit.units.convertToNum("height",
A.getAttribute("height")),J=A.getAttribute("viewBox"),P=J?J.split(" "):[0,0,E,F];for(h=0;h<4;++h)P[h]=+P[h];d.getAttribute("width");var R=+d.getAttribute("height");b=F>E?"scale("+R/3/P[3]+")":"scale("+R/3/P[2]+")";b="translate(0) "+b+" translate(0)";l=K.createElementNS(k.SVG,"symbol");var V=svgedit.utilities.findDefs();for(svgedit.browser.isGecko()&&$(A).find("linearGradient, radialGradient, pattern").appendTo(V);A.firstChild;)l.appendChild(A.firstChild);var W=A.attributes,Z;for(Z=0;Z<W.length;Z++){var M=
W[Z];l.setAttribute(M.nodeName,M.value)}l.id=na();Na[p]={symbol:l,xform:b};svgedit.utilities.findDefs().appendChild(l);C.addSubCommand(new svgedit.history.InsertElementCommand(l))}var H=K.createElementNS(k.SVG,"use");H.id=na();ta(H,"#"+l.id);(m||f().getCurrentLayer()).appendChild(H);C.addSubCommand(new svgedit.history.InsertElementCommand(H));ha();H.setAttribute("transform",b);svgedit.recalculate.recalculateDimensions(H);$(H).data("symbol",l).data("ref",l);xa([H]);da(C);Y("changed",[d])}catch(D){console.log(D);
return null}return H};var ub=u.identifyLayers=function(){Ha();f().identifyLayers()};this.createLayer=function(a,h){var b=f().createLayer(a,q(h));ha();Y("changed",[b])};this.cloneLayer=function(a,h){var b=f().cloneLayer(a,q(h));ha();Ha();Y("changed",[b])};this.deleteCurrentLayer=function(){var a=f().getCurrentLayer(),h=a.nextSibling,b=a.parentNode;if(a=f().deleteCurrentLayer()){var p=new svgedit.history.BatchCommand("Delete Layer");p.addSubCommand(new svgedit.history.RemoveElementCommand(a,h,b));da(p);
ha();Y("changed",[b]);return true}return false};this.setCurrentLayer=function(a){(a=f().setCurrentLayer(svgedit.utilities.toXml(a)))&&ha();return a};this.renameCurrentLayer=function(a){var h=f(),b=h.getCurrentLayer();if(b)if(h.setCurrentLayerName(a,q())){Y("changed",[b]);return true}return false};this.setCurrentLayerPosition=function(a){if(a=f().setCurrentLayerPosition(a)){da(new svgedit.history.MoveElementCommand(a.currentGroup,a.oldNextSibling,d));return true}return false};this.setLayerVisibility=
function(a,h){var b=f(),p=b.getLayerVisibility(a),o=b.setLayerVisibility(a,h);if(o)da(new svgedit.history.ChangeElementCommand(o,{display:p?"inline":"none"},"Layer Visibility"));else return false;if(o==b.getCurrentLayer()){ha();ca.clear()}return true};this.moveSelectedToLayer=function(a){var h=f().getLayerByName(a);if(!h)return false;var b=new svgedit.history.BatchCommand("Move Elements to Layer"),p=t;for(a=p.length;a--;){var o=p[a];if(o){var C=o.nextSibling,l=o.parentNode;h.appendChild(o);b.addSubCommand(new svgedit.history.MoveElementCommand(o,
C,l))}}da(b);return true};this.mergeLayer=function(a){f().mergeLayer(q(a));ha();Ha();Y("changed",[d])};this.mergeAllLayers=function(a){f().mergeAllLayers(q(a));ha();Ha();Y("changed",[d])};var Ha=this.leaveContext=function(){var a,h=Wa.length;if(h){for(a=0;a<h;a++){var b=Wa[a],p=Ua(b,"orig_opac");p!==1?b.setAttribute("opacity",p):b.removeAttribute("opacity");b.setAttribute("style","pointer-events: inherit")}Wa=[];ha(true);Y("contextset",null)}m=null},Db=this.setContext=function(a){Ha();if(typeof a===
"string")a=svgedit.utilities.getElem(a);m=a;$(a).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var h=this.getAttribute("opacity")||1;Ua(this,"orig_opac",h);this.setAttribute("opacity",h*0.33);this.setAttribute("style","pointer-events: none");Wa.push(this)});ha();Y("contextset",m)};this.clear=function(){ca.clear();ha();u.clearSvgContentElement();u.current_drawing_=new svgedit.draw.Drawing(d);u.createLayer("Layer 1");u.undoMgr.resetUndoStack();ea.initGroup();ia=ea.getRubberBandBox();
Y("cleared")};this.linkControlPoints=ca.linkControlPoints;this.getContentElem=function(){return d};this.getRootElem=function(){return B};this.getSelectedElems=function(){return t};var Ia=this.getResolution=function(){var a=d.getAttribute("width")/e,h=d.getAttribute("height")/e;return{w:a,h:h,zoom:e}};this.getZoom=function(){return e};this.getSnapToGrid=function(){return i.gridSnapping};this.getVersion=function(){return"svgcanvas.js ($Rev$)"};this.setUiStrings=function(a){$.extend(Ma,a.notification)};
this.setConfig=function(a){$.extend(i,a)};this.getTitle=function(a){if(a=a||t[0]){a=$(a).data("gsvg")||$(a).data("symbol")||a;var h=a.childNodes;for(a=0;a<h.length;a++)if(h[a].nodeName=="title")return h[a].textContent;return""}};this.setGroupTitle=function(a){var h=t[0];h=$(h).data("gsvg")||h;var b=$(h).children("title"),p=new svgedit.history.BatchCommand("Set Label");if(a.length)if(b.length){b=b[0];p.addSubCommand(new svgedit.history.ChangeElementCommand(b,{"#text":b.textContent}));b.textContent=
a}else{b=K.createElementNS(k.SVG,"title");b.textContent=a;$(h).prepend(b);p.addSubCommand(new svgedit.history.InsertElementCommand(b))}else{p.addSubCommand(new svgedit.history.RemoveElementCommand(b[0],b.nextSibling,h));b.remove()}da(p)};var Eb=this.getDocumentTitle=function(){return u.getTitle(d)};this.setDocumentTitle=function(a){var h,b=d.childNodes,p=false,o="",C=new svgedit.history.BatchCommand("Change Image Title");for(h=0;h<b.length;h++)if(b[h].nodeName=="title"){p=b[h];o=p.textContent;break}if(!p){p=
K.createElementNS(k.SVG,"title");d.insertBefore(p,d.firstChild)}if(a.length)p.textContent=a;else p.parentNode.removeChild(p);C.addSubCommand(new svgedit.history.ChangeElementCommand(p,{"#text":o}));da(C)};this.getEditorNS=function(a){a&&d.setAttribute("xmlns:se",k.SE);return k.SE};this.setResolution=function(a,h){var b=Ia(),p=b.w;b=b.h;var o;if(a=="fit"){var C=wa();if(C){o=new svgedit.history.BatchCommand("Fit Canvas to Content");var l=Xa();xa(l);var z=[],A=[];$.each(l,function(){z.push(C.x*-1);A.push(C.y*
-1)});l=u.moveSelectedElements(z,A,true);o.addSubCommand(l);ha();a=Math.round(C.width);h=Math.round(C.height)}else return false}if(a!=p||h!=b){o||(o=new svgedit.history.BatchCommand("Change Image Dimensions"));a=svgedit.units.convertToNum("width",a);h=svgedit.units.convertToNum("height",h);d.setAttribute("width",a);d.setAttribute("height",h);this.contentW=a;this.contentH=h;o.addSubCommand(new svgedit.history.ChangeElementCommand(d,{width:p,height:b}));d.setAttribute("viewBox",[0,0,a/e,h/e].join(" "));
o.addSubCommand(new svgedit.history.ChangeElementCommand(d,{viewBox:["0 0",p,b].join(" ")}));da(o);Y("changed",[d])}return true};this.getOffset=function(){return $(d).attr(["x","y"])};this.setBBoxZoom=function(a,h,b){var p=0.85,o=function(C){if(!C)return false;var l=Math.min(Math.round(h/C.width*100*p)/100,Math.round(b/C.height*100*p)/100);u.setZoom(l);return{zoom:l,bbox:C}};if(typeof a=="object"){a=a;if(a.width==0||a.height==0){u.setZoom(a.zoom?a.zoom:e*a.factor);return{zoom:e,bbox:a}}return o(a)}switch(a){case "selection":if(!t[0])return;
a=$.map(t,function(C){if(C)return C});a=wa(a);break;case "canvas":a=Ia();p=0.95;a={width:a.w,height:a.h,x:0,y:0};break;case "content":a=wa();break;case "layer":a=wa(Xa(f().getCurrentLayer()));break;default:return}return o(a)};this.setZoom=function(a){var h=Ia();d.setAttribute("viewBox","0 0 "+h.w/a+" "+h.h/a);e=a;$.each(t,function(b,p){p&&ea.requestSelector(p).resize()});ca.zoomChange();Ja("zoomChanged",a)};this.getMode=function(){return fa};this.setMode=function(a){ca.clear(true);oa.clear();ra=t[0]&&
t[0].nodeName=="text"?ua:v;fa=a};this.getColor=function(a){return ra[a]};this.setColor=function(a,h,b){function p(z){z.nodeName!="g"&&o.push(z)}v[a]=h;ra[a+"_paint"]={type:"solidColor"};for(var o=[],C=t.length;C--;){var l=t[C];if(l)if(l.tagName=="g")svgedit.utilities.walkTree(l,p);else if(a=="fill")l.tagName!="polyline"&&l.tagName!="line"&&o.push(l);else o.push(l)}if(o.length>0)if(b)Ka(a,h,o);else{sa(a,h,o);Y("changed",o)}};var wb=this.setGradient=function(a){if(!(!ra[a+"_paint"]||ra[a+"_paint"].type==
"solidColor")){var h=u[a+"Grad"],b=vb(h),p=svgedit.utilities.findDefs();if(b)h=b;else{h=p.appendChild(K.importNode(h,true));h.id=na()}u.setColor(a,"url(#"+h.id+")")}},vb=function(a){var h=svgedit.utilities.findDefs();h=$(h).find("linearGradient, radialGradient");for(var b=h.length,p=["r","cx","cy","fx","fy"];b--;){var o=h[b];if(a.tagName=="linearGradient"){if(a.getAttribute("x1")!=o.getAttribute("x1")||a.getAttribute("y1")!=o.getAttribute("y1")||a.getAttribute("x2")!=o.getAttribute("x2")||a.getAttribute("y2")!=
o.getAttribute("y2"))continue}else{var C=$(a).attr(p),l=$(o).attr(p),z=false;$.each(p,function(R,V){if(C[V]!=l[V])z=true});if(z)continue}var A=a.getElementsByTagNameNS(k.SVG,"stop"),E=o.getElementsByTagNameNS(k.SVG,"stop");if(A.length==E.length){for(var F=A.length;F--;){var J=A[F],P=E[F];if(J.getAttribute("offset")!=P.getAttribute("offset")||J.getAttribute("stop-opacity")!=P.getAttribute("stop-opacity")||J.getAttribute("stop-color")!=P.getAttribute("stop-color"))break}if(F==-1)return o}}return null};
this.setPaint=function(a,h){var b=new $.jGraduate.Paint(h);this.setPaintOpacity(a,b.alpha/100,true);ra[a+"_paint"]=b;switch(b.type){case "solidColor":this.setColor(a,b.solidColor!="none"?"#"+b.solidColor:"none");break;case "linearGradient":case "radialGradient":u[a+"Grad"]=b[b.type];wb(a)}};this.setStrokePaint=function(a){this.setPaint("stroke",a)};this.setFillPaint=function(a){this.setPaint("fill",a)};this.getStrokeWidth=function(){return ra.stroke_width};this.setStrokeWidth=function(a){function h(C){C.nodeName!=
"g"&&b.push(C)}if(a==0&&["line","path"].indexOf(fa)>=0)u.setStrokeWidth(1);else{ra.stroke_width=a;for(var b=[],p=t.length;p--;){var o=t[p];if(o)o.tagName=="g"?svgedit.utilities.walkTree(o,h):b.push(o)}if(b.length>0){sa("stroke-width",a,b);Y("changed",t)}}};this.setStrokeAttr=function(a,h){v[a.replace("-","_")]=h;for(var b=[],p=t.length;p--;){var o=t[p];if(o)o.tagName=="g"?svgedit.utilities.walkTree(o,function(C){C.nodeName!="g"&&b.push(C)}):b.push(o)}if(b.length>0){sa(a,h,b);Y("changed",t)}};this.getStyle=
function(){return v};this.getOpacity=function(){return v.opacity};this.setOpacity=function(a){v.opacity=a;sa("opacity",a)};this.getFillOpacity=function(){return v.fill_opacity};this.getStrokeOpacity=function(){return v.stroke_opacity};this.setPaintOpacity=function(a,h,b){v[a+"_opacity"]=h;b?Ka(a+"-opacity",h):sa(a+"-opacity",h)};this.getPaintOpacity=function(a){return a==="fill"?this.getFillOpacity():this.getStrokeOpacity()};this.getBlur=function(a){var h=0;if(a)if(a.getAttribute("filter"))if(a=svgedit.utilities.getElem(a.id+
"_blur"))h=a.firstChild.getAttribute("stdDeviation");return h};(function(){function a(){var o=u.undoMgr.finishUndoableChange();h.addSubCommand(o);da(h);b=h=null}var h=null,b=null,p=false;u.setBlurNoUndo=function(o){if(b)if(o===0){Ka("filter","");p=true}else{var C=t[0];p&&Ka("filter","url(#"+C.id+"_blur)");if(svgedit.browser.isWebkit()){console.log("e",C);C.removeAttribute("filter");C.setAttribute("filter","url(#"+C.id+"_blur)")}Ka("stdDeviation",o,[b.firstChild]);u.setBlurOffsets(b,o)}else u.setBlur(o)};
u.setBlurOffsets=function(o,C){if(C>3)svgedit.utilities.assignAttributes(o,{x:"-50%",y:"-50%",width:"200%",height:"200%"},100);else if(!svgedit.browser.isWebkit()){o.removeAttribute("x");o.removeAttribute("y");o.removeAttribute("width");o.removeAttribute("height")}};u.setBlur=function(o,C){if(h)a();else{var l=t[0],z=l.id;b=svgedit.utilities.getElem(z+"_blur");o-=0;var A=new svgedit.history.BatchCommand;if(b){if(o===0)b=null}else{var E=O({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:o}});
b=O({element:"filter",attr:{id:z+"_blur"}});b.appendChild(E);svgedit.utilities.findDefs().appendChild(b);A.addSubCommand(new svgedit.history.InsertElementCommand(b))}E={filter:l.getAttribute("filter")};if(o===0){l.removeAttribute("filter");A.addSubCommand(new svgedit.history.ChangeElementCommand(l,E))}else{sa("filter","url(#"+z+"_blur)");A.addSubCommand(new svgedit.history.ChangeElementCommand(l,E));u.setBlurOffsets(b,o);h=A;u.undoMgr.beginUndoableChange("stdDeviation",[b?b.firstChild:null]);if(C){u.setBlurNoUndo(o);
a()}}}}})();this.getBold=function(){var a=t[0];if(a!=null&&a.tagName=="text"&&t[1]==null)return a.getAttribute("font-weight")=="bold";return false};this.setBold=function(a){var h=t[0];if(h!=null&&h.tagName=="text"&&t[1]==null)sa("font-weight",a?"bold":"normal");t[0].textContent||oa.setCursor()};this.getItalic=function(){var a=t[0];if(a!=null&&a.tagName=="text"&&t[1]==null)return a.getAttribute("font-style")=="italic";return false};this.setItalic=function(a){var h=t[0];if(h!=null&&h.tagName=="text"&&
t[1]==null)sa("font-style",a?"italic":"normal");t[0].textContent||oa.setCursor()};this.getFontFamily=function(){return ua.font_family};this.setFontFamily=function(a){ua.font_family=a;sa("font-family",a);t[0]&&!t[0].textContent&&oa.setCursor()};this.setFontColor=function(a){ua.fill=a;sa("fill",a)};this.getFontColor=function(){return ua.fill};this.getFontSize=function(){return ua.font_size};this.setFontSize=function(a){ua.font_size=a;sa("font-size",a);t[0].textContent||oa.setCursor()};this.getText=
function(){var a=t[0];if(a==null)return"";return a.textContent};this.setTextContent=function(a){sa("#text",a);oa.init(a);oa.setCursor()};this.setImageURL=function(a){var h=t[0];if(h){var b=$(h).attr(["width","height"]);b=!b.width||!b.height;var p=pa(h);if(p!==a)b=true;else if(!b)return;var o=new svgedit.history.BatchCommand("Change Image URL");ta(h,a);o.addSubCommand(new svgedit.history.ChangeElementCommand(h,{"#href":p}));b?$(new Image).load(function(){var C=$(h).attr(["width","height"]);$(h).attr({width:this.width,
height:this.height});ea.requestSelector(h).resize();o.addSubCommand(new svgedit.history.ChangeElementCommand(h,C));da(o);Y("changed",[h])}).attr("src",a):da(o)}};this.setLinkURL=function(a){var h=t[0];if(h){if(h.tagName!=="a"){h=$(h).parents("a");if(h.length)h=h[0];else return}var b=pa(h);if(b!==a){var p=new svgedit.history.BatchCommand("Change Link URL");ta(h,a);p.addSubCommand(new svgedit.history.ChangeElementCommand(h,{"#href":b}));da(p)}}};this.setRectRadius=function(a){var h=t[0];if(h!=null&&
h.tagName=="rect"){var b=h.getAttribute("rx");if(b!=a){h.setAttribute("rx",a);h.setAttribute("ry",a);da(new svgedit.history.ChangeElementCommand(h,{rx:b,ry:b},"Radius"));Y("changed",[h])}}};this.makeHyperlink=function(a){u.groupSelectedElements("a",a)};this.removeHyperlink=function(){u.ungroupSelectedElement()};this.setSegType=function(a){ca.setSegType(a)};this.convertToPath=function(a,h){if(a==null)$.each(t,function(b,p){p&&u.convertToPath(p)});else return h?svgedit.utilities.getBBoxOfElementAsPath(a,
O,ca):svgedit.utilities.convertToPath(a,{fill:v.fill,"fill-opacity":v.fill_opacity,stroke:v.stroke,"stroke-width":v.stroke_width,"stroke-dasharray":v.stroke_dasharray,"stroke-linejoin":v.stroke_linejoin,"stroke-linecap":v.stroke_linecap,"stroke-opacity":v.stroke_opacity,opacity:v.opacity,visibility:"hidden"},O,ca,ha,xa,svgedit.history,da)};var Ka=function(a,h,b){fa=="pathedit"&&ca.moveNode(a,h);b=b||t;for(var p=b.length,o=["g","polyline","path"],C=["transform","opacity","filter"];p--;){var l=b[p];
if(l!=null)if((a==="x"||a==="y")&&o.indexOf(l.tagName)>=0){var z=wa([l]);u.moveSelectedElements((a==="x"?h-z.x:0)*e,(a==="y"?h-z.y:0)*e,true)}else{l.tagName==="g"&&C.indexOf(a);z=a==="#text"?l.textContent:l.getAttribute(a);if(z==null)z="";if(z!==String(h)){if(a=="#text"){svgedit.utilities.getBBox(l);l.textContent=h;if(/rotate/.test(l.getAttribute("transform")))l=ib(l)}else a=="#href"?ta(l,h):l.setAttribute(a,h);fa==="textedit"&&a!=="#text"&&l.textContent.length&&oa.toSelectMode(l);if(svgedit.browser.isGecko()&&
l.nodeName==="text"&&/rotate/.test(l.getAttribute("transform")))if(String(h).indexOf("url")===0||["font-size","font-family","x","y"].indexOf(a)>=0&&l.textContent)l=ib(l);t.indexOf(l)>=0&&setTimeout(function(){l.parentNode&&ea.requestSelector(l).resize()},0);z=svgedit.utilities.getRotationAngle(l);if(z!=0&&a!="transform")for(var A=svgedit.transformlist.getTransformList(l),E=A.numberOfItems;E--;)if(A.getItem(E).type==4){A.removeItem(E);var F=svgedit.utilities.getBBox(l),J=svgedit.math.transformPoint(F.x+
F.width/2,F.y+F.height/2,svgedit.math.transformListToTransform(A).matrix);F=J.x;J=J.y;var P=B.createSVGTransform();P.setRotate(z,F,J);A.insertItemBefore(P,E);break}}}}},sa=this.changeSelectedAttribute=function(a,h,b){b=b||t;u.undoMgr.beginUndoableChange(a,b);Ka(a,h,b);a=u.undoMgr.finishUndoableChange();a.isEmpty()||da(a)};this.deleteSelectedElements=function(){var a,h=new svgedit.history.BatchCommand("Delete Elements"),b=t.length,p=[];for(a=0;a<b;++a){var o=t[a];if(o==null)break;var C=o.parentNode,
l=o;ea.releaseSelector(l);svgedit.path.removePath_(l.id);if(C.tagName==="a"&&C.childNodes.length===1){l=C;C=C.parentNode}var z=l.nextSibling;l=C.removeChild(l);p.push(o);t[a]=null;h.addSubCommand(new Sa(l,z,C))}h.isEmpty()||da(h);Y("changed",p);ha()};this.cutSelectedElements=function(){var a,h=new svgedit.history.BatchCommand("Cut Elements"),b=t.length,p=[];for(a=0;a<b;++a){var o=t[a];if(o==null)break;var C=o.parentNode,l=o;ea.releaseSelector(l);svgedit.path.removePath_(l.id);var z=l.nextSibling;
l=C.removeChild(l);p.push(o);t[a]=null;h.addSubCommand(new Sa(l,z,C))}h.isEmpty()||da(h);Y("changed",p);ha();u.clipBoard=p};this.copySelectedElements=function(){u.clipBoard=$.merge([],t)};this.pasteElements=function(a,h,b){var p=u.clipBoard,o=p.length;if(o){for(var C=[],l=new svgedit.history.BatchCommand("Paste elements"),z=f();o--;){var A=p[o];if(A){var E=z.copyElem(A);if(!svgedit.utilities.getElem(A.id))E.id=A.id;C.push(E);(m||z.getCurrentLayer()).appendChild(E);l.addSubCommand(new svgedit.history.InsertElementCommand(E));
Ta(E)}}Aa(C);if(a!=="in_place"){var F,J;if(a){if(a==="point"){F=h;J=b}}else{F=gb.x;J=gb.y}a=wa(C);var P=F-(a.x+a.width/2),R=J-(a.y+a.height/2),V=[],W=[];$.each(C,function(){V.push(P);W.push(R)});F=u.moveSelectedElements(V,W,false);l.addSubCommand(F)}da(l);Y("changed",C)}};this.groupSelectedElements=function(a,h){a||(a="g");var b="";switch(a){case "a":b="Make hyperlink";var p="";if(arguments.length>1)p=h;break;default:a="g";b="Group Elements"}b=new svgedit.history.BatchCommand(b);var o=O({element:a,
attr:{id:na()}});a==="a"&&ta(o,p);b.addSubCommand(new svgedit.history.InsertElementCommand(o));for(p=t.length;p--;){var C=t[p];if(C!=null){if(C.parentNode.tagName==="a"&&C.parentNode.childNodes.length===1)C=C.parentNode;var l=C.nextSibling,z=C.parentNode;o.appendChild(C);b.addSubCommand(new svgedit.history.MoveElementCommand(C,l,z))}}b.isEmpty()||da(b);Aa([o],true)};var kb=this.pushGroupProperties=function(a,h){var b=a.childNodes,p=b.length,o=a.getAttribute("transform"),C=svgedit.transformlist.getTransformList(a),
l=svgedit.math.transformListToTransform(C).matrix,z=new svgedit.history.BatchCommand("Push group properties"),A=0,E=svgedit.utilities.getRotationAngle(a),F=$(a).attr(["filter","opacity"]),J,P,R,V=f();for(A=0;A<p;A++){var W=b[A];if(W.nodeType===1){if(F.opacity!==null&&F.opacity!==1){W.getAttribute("opacity");var Z=Math.round((W.getAttribute("opacity")||1)*F.opacity*100)/100;sa("opacity",Z,[W])}if(F.filter){R=Z=this.getBlur(W);P||(P=this.getBlur(a));if(Z)Z=Number(P)+Number(Z);else if(Z===0)Z=P;if(R)J=
svgedit.utilities.getRefElem(W.getAttribute("filter"));else if(J){J=V.copyElem(J);svgedit.utilities.findDefs().appendChild(J)}else J=svgedit.utilities.getRefElem(F.filter);J.id=W.id+"_"+(J.firstChild.tagName==="feGaussianBlur"?"blur":"filter");sa("filter","url(#"+J.id+")",[W]);if(Z){sa("stdDeviation",Z,[J.firstChild]);u.setBlurOffsets(J,Z)}}Z=svgedit.transformlist.getTransformList(W);if(~W.tagName.indexOf("Gradient"))Z=null;if(Z)if(W.tagName!=="defs")if(C.numberOfItems){if(E&&C.numberOfItems==1){var M=
C.getItem(0).matrix,H=B.createSVGMatrix();if(R=svgedit.utilities.getRotationAngle(W))H=Z.getItem(0).matrix;var D=svgedit.utilities.getBBox(W),G=svgedit.math.transformListToTransform(Z).matrix,I=svgedit.math.transformPoint(D.x+D.width/2,D.y+D.height/2,G);D=E+R;G=B.createSVGTransform();G.setRotate(D,I.x,I.y);M=svgedit.math.matrixMultiply(M,H,G.matrix.inverse());R&&Z.removeItem(0);if(D)Z.numberOfItems?Z.insertItemBefore(G,0):Z.appendItem(G);if(M.e||M.f){R=B.createSVGTransform();R.setTranslate(M.e,M.f);
Z.numberOfItems?Z.insertItemBefore(R,0):Z.appendItem(R)}}else{M=W.getAttribute("transform");R={};R.transform=M||"";R=B.createSVGTransform();M=svgedit.math.transformListToTransform(Z).matrix;H=M.inverse();M=svgedit.math.matrixMultiply(H,l,M);R.setMatrix(M);Z.appendItem(R)}(W=svgedit.recalculate.recalculateDimensions(W))&&z.addSubCommand(W)}}}if(o){R={};R.transform=o;a.setAttribute("transform","");a.removeAttribute("transform");z.addSubCommand(new svgedit.history.ChangeElementCommand(a,R))}if(h&&!z.isEmpty())return z};
this.ungroupSelectedElement=function(){var a=t[0];if(a)if($(a).data("gsvg")||$(a).data("symbol"))tb(a);else if(a.tagName==="use"){var h=svgedit.utilities.getElem(pa(a).substr(1));$(a).data("symbol",h).data("ref",h);tb(a)}else{h=$(a).parents("a");if(h.length)a=h[0];if(a.tagName==="g"||a.tagName==="a"){h=new svgedit.history.BatchCommand("Ungroup Elements");var b=kb(a,true);b&&h.addSubCommand(b);b=a.parentNode;for(var p=a.nextSibling,o=Array(a.childNodes.length),C=0;a.firstChild;){var l=a.firstChild,
z=l.nextSibling,A=l.parentNode;if(l.tagName==="title"){h.addSubCommand(new svgedit.history.RemoveElementCommand(l,l.nextSibling,A));A.removeChild(l)}else{o[C++]=l=b.insertBefore(l,p);h.addSubCommand(new svgedit.history.MoveElementCommand(l,z,A))}}ha();p=a.nextSibling;a=b.removeChild(a);h.addSubCommand(new svgedit.history.RemoveElementCommand(a,p,b));h.isEmpty()||da(h);xa(o)}}};this.moveToTopSelectedElement=function(){var a=t[0];if(a!=null){a=a;var h=a.parentNode,b=a.nextSibling;a=a.parentNode.appendChild(a);
if(b!=a.nextSibling){da(new svgedit.history.MoveElementCommand(a,b,h,"top"));Y("changed",[a])}}};this.moveToBottomSelectedElement=function(){var a=t[0];if(a!=null){a=a;var h=a.parentNode,b=a.nextSibling,p=a.parentNode.firstChild;if(p.tagName=="title")p=p.nextSibling;if(p.tagName=="defs")p=p.nextSibling;a=a.parentNode.insertBefore(a,p);if(b!=a.nextSibling){da(new svgedit.history.MoveElementCommand(a,b,h,"bottom"));Y("changed",[a])}}};this.moveUpDownSelected=function(a){var h=t[0];if(h){Ga=[];var b,
p,o=$(hb(wa([h]))).toArray();a=="Down"&&o.reverse();$.each(o,function(){if(p){b=this;return false}else if(this==h)p=true});if(b){o=h.parentNode;var C=h.nextSibling;$(b)[a=="Down"?"before":"after"](h);if(C!=h.nextSibling){da(new svgedit.history.MoveElementCommand(h,C,o,"Move "+a));Y("changed",[h])}}}};this.moveSelectedElements=function(a,h,b){if(a.constructor!=Array){a/=e;h/=e}b=b||true;for(var p=new svgedit.history.BatchCommand("position"),o=t.length;o--;){var C=t[o];if(C!=null){var l=B.createSVGTransform(),
z=svgedit.transformlist.getTransformList(C);a.constructor==Array?l.setTranslate(a[o],h[o]):l.setTranslate(a,h);z.numberOfItems?z.insertItemBefore(l,0):z.appendItem(l);(l=svgedit.recalculate.recalculateDimensions(C))&&p.addSubCommand(l);ea.requestSelector(C).resize()}}if(!p.isEmpty()){b&&da(p);Y("changed",t);return p}};this.cloneSelectedElements=function(a,h){var b,p,o=new svgedit.history.BatchCommand("Clone Elements"),C=t.length;t.sort(function(z,A){return $(A).index()-$(z).index()});for(b=0;b<C;++b){p=
t[b];if(p==null)break}C=t.slice(0,b);this.clearSelection(true);var l=f();for(b=C.length;b--;){p=C[b]=l.copyElem(C[b]);(m||l.getCurrentLayer()).appendChild(p);o.addSubCommand(new svgedit.history.InsertElementCommand(p))}if(!o.isEmpty()){xa(C.reverse());this.moveSelectedElements(a,h,false);da(o)}};this.alignSelectedElements=function(a,h){var b,p,o=[],C=Number.MAX_VALUE,l=Number.MIN_VALUE,z=Number.MAX_VALUE,A=Number.MIN_VALUE,E=Number.MIN_VALUE,F=Number.MIN_VALUE,J=t.length;if(J){for(b=0;b<J;++b){if(t[b]==
null)break;p=t[b];o[b]=wa([p]);switch(h){case "smallest":if((a=="l"||a=="c"||a=="r")&&(E==Number.MIN_VALUE||E>o[b].width)||(a=="t"||a=="m"||a=="b")&&(F==Number.MIN_VALUE||F>o[b].height)){C=o[b].x;z=o[b].y;l=o[b].x+o[b].width;A=o[b].y+o[b].height;E=o[b].width;F=o[b].height}break;case "largest":if((a=="l"||a=="c"||a=="r")&&(E==Number.MIN_VALUE||E<o[b].width)||(a=="t"||a=="m"||a=="b")&&(F==Number.MIN_VALUE||F<o[b].height)){C=o[b].x;z=o[b].y;l=o[b].x+o[b].width;A=o[b].y+o[b].height;E=o[b].width;F=o[b].height}break;
default:if(o[b].x<C)C=o[b].x;if(o[b].y<z)z=o[b].y;if(o[b].x+o[b].width>l)l=o[b].x+o[b].width;if(o[b].y+o[b].height>A)A=o[b].y+o[b].height}}if(h=="page"){z=C=0;l=u.contentW;A=u.contentH}p=Array(J);E=Array(J);for(b=0;b<J;++b){if(t[b]==null)break;F=o[b];p[b]=0;E[b]=0;switch(a){case "l":p[b]=C-F.x;break;case "c":p[b]=(C+l)/2-(F.x+F.width/2);break;case "r":p[b]=l-(F.x+F.width);break;case "t":E[b]=z-F.y;break;case "m":E[b]=(z+A)/2-(F.y+F.height/2);break;case "b":E[b]=A-(F.y+F.height)}}this.moveSelectedElements(p,
E)}};this.contentW=Ia().w;this.contentH=Ia().h;this.updateCanvas=function(a,h){B.setAttribute("width",a);B.setAttribute("height",h);var b=$("#canvasBackground")[0],p=d.getAttribute("x"),o=d.getAttribute("y"),C=a/2-this.contentW*e/2,l=h/2-this.contentH*e/2;svgedit.utilities.assignAttributes(d,{width:this.contentW*e,height:this.contentH*e,x:C,y:l,viewBox:"0 0 "+this.contentW+" "+this.contentH});svgedit.utilities.assignAttributes(b,{width:d.getAttribute("width"),height:d.getAttribute("height"),x:C,y:l});
(b=svgedit.utilities.getElem("background_image"))&&svgedit.utilities.assignAttributes(b,{width:"100%",height:"100%"});ea.selectorParentGroup.setAttribute("transform","translate("+C+","+l+")");Ja("canvasUpdated",{new_x:C,new_y:l,old_x:p,old_y:o,d_x:C-p,d_y:l-o});return{x:C,y:l,old_x:p,old_y:o,d_x:C-p,d_y:l-o}};this.setBackground=function(a,h){var b=svgedit.utilities.getElem("canvasBackground"),p=$(b).find("rect")[0],o=svgedit.utilities.getElem("background_image");p.setAttribute("fill",a);if(h){if(!o){o=
K.createElementNS(k.SVG,"image");svgedit.utilities.assignAttributes(o,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})}ta(o,h);b.appendChild(o)}else o&&o.parentNode.removeChild(o)};this.cycleElement=function(a){var h=t[0],b=false,p=Xa(m||f().getCurrentLayer());if(p.length){if(h==null){a=a?p.length-1:0;b=p[a]}else for(var o=p.length;o--;)if(p[o]==h){a=a?o-1:o+1;if(a>=p.length)a=0;else if(a<0)a=p.length-1;b=p[a];break}Aa([b],true);Y("selected",
t)}};this.clear();this.getPrivateMethods=function(){return{addCommandToHistory:da,setGradient:wb,addSvgElementFromJson:O,assignAttributes:La,BatchCommand:Ab,call:Y,ChangeElementCommand:pb,copyElem:function(a){return f().copyElem(a)},ffClone:ib,findDefs:ga,findDuplicateGradient:vb,getElem:Ca,getId:va,getIntersectionList:hb,getMouseTarget:Ya,getNextId:na,getPathBBox:qa,getUrlFromAttr:ba,hasMatrixTransform:N,identifyLayers:ub,InsertElementCommand:$a,isIdentity:svgedit.math.isIdentity,logMatrix:Cb,matrixMultiply:L,
MoveElementCommand:ob,preventClickDefault:svgedit.utilities.preventClickDefault,recalculateAllSelectedDimensions:jb,recalculateDimensions:yb,remapElement:xb,RemoveElementCommand:Sa,removeUnusedDefElems:sb,round:Oa,runExtensions:Ja,sanitizeSvg:zb,SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,transformBox:svgedit.math.transformBox,transformListToTransform:T,transformPoint:Q,walkTree:svgedit.utilities.walkTree}}};;module.exports = svgedit; }());
